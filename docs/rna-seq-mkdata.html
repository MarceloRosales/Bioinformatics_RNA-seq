<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 RNA-Seq-MKdata | Bioinformatics_RNA-seq</title>
  <meta name="description" content="RNA-seq notes and trials" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 RNA-Seq-MKdata | Bioinformatics_RNA-seq" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="RNA-seq notes and trials" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 RNA-Seq-MKdata | Bioinformatics_RNA-seq" />
  
  <meta name="twitter:description" content="RNA-seq notes and trials" />
  

<meta name="author" content="J. Marcelo Rosales R." />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"/>
<link rel="next" href="wgcna-rna-seq-blog.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Bioinformatics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to RNA sequencing (RNA_seq)</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#downloading-and-setting-up-conda-environments."><i class="fa fa-check"></i><b>1.1</b> Downloading and setting up conda environments.</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#install-miniconda-or-anaconda."><i class="fa fa-check"></i><b>1.2</b> Install Miniconda, or Anaconda.</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#conda-terminal-commands."><i class="fa fa-check"></i><b>1.2.1</b> Conda terminal commands.</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#anacondaminiconda-install-summary-of-steps."><i class="fa fa-check"></i><b>1.2.2</b> Anaconda/Miniconda install Summary of Steps.</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#conda-activate-error"><i class="fa fa-check"></i><b>1.2.3</b> Conda activate error</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#alignment-procedures-and-files."><i class="fa fa-check"></i><b>1.3</b> Alignment Procedures and files.</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#using-tophat-early-version"><i class="fa fa-check"></i><b>1.3.1</b> Using Tophat (early version)</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#using-tophat"><i class="fa fa-check"></i><b>1.3.2</b> Using Tophat</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#using-star"><i class="fa fa-check"></i><b>1.3.3</b> Using STAR</a></li>
<li class="chapter" data-level="1.3.4" data-path="index.html"><a href="index.html#Mus-musculus-NCBI-build37-2"><i class="fa fa-check"></i><b>1.3.4</b> Custom/personal way to Download the Mus_musculus_NCBI_build37.2.tar.gz file.</a></li>
<li class="chapter" data-level="1.3.5" data-path="index.html"><a href="index.html#get-the-sample-files."><i class="fa fa-check"></i><b>1.3.5</b> Get the Sample files.</a></li>
<li class="chapter" data-level="1.3.6" data-path="index.html"><a href="index.html#starting-to-analize-fastq.gz-files"><i class="fa fa-check"></i><b>1.3.6</b> Starting to analize fastq.gz files</a></li>
<li class="chapter" data-level="1.3.7" data-path="index.html"><a href="index.html#trimming-with-trimmomatic"><i class="fa fa-check"></i><b>1.3.7</b> Trimming with Trimmomatic</a></li>
<li class="chapter" data-level="1.3.8" data-path="index.html"><a href="index.html#using-star-to-map-genes"><i class="fa fa-check"></i><b>1.3.8</b> Using STAR to map genes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="file-download-or-sra-qc-and-trimming.html"><a href="file-download-or-sra-qc-and-trimming.html"><i class="fa fa-check"></i><b>2</b> File Download (or SRA), QC, and Trimming</a>
<ul>
<li class="chapter" data-level="2.1" data-path="file-download-or-sra-qc-and-trimming.html"><a href="file-download-or-sra-qc-and-trimming.html#trimmomatic"><i class="fa fa-check"></i><b>2.1</b> Trimmomatic</a></li>
<li class="chapter" data-level="2.2" data-path="file-download-or-sra-qc-and-trimming.html"><a href="file-download-or-sra-qc-and-trimming.html#indexing-with-star"><i class="fa fa-check"></i><b>2.2</b> Indexing with STAR</a></li>
<li class="chapter" data-level="2.3" data-path="file-download-or-sra-qc-and-trimming.html"><a href="file-download-or-sra-qc-and-trimming.html#microbial-contamination"><i class="fa fa-check"></i><b>2.3</b> Microbial contamination</a></li>
<li class="chapter" data-level="2.4" data-path="file-download-or-sra-qc-and-trimming.html"><a href="file-download-or-sra-qc-and-trimming.html#feature-counts."><i class="fa fa-check"></i><b>2.4</b> Feature counts.</a></li>
<li class="chapter" data-level="2.5" data-path="file-download-or-sra-qc-and-trimming.html"><a href="file-download-or-sra-qc-and-trimming.html#setting-r-environment."><i class="fa fa-check"></i><b>2.5</b> Setting R environment.</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>3</b> Methods</a></li>
<li class="chapter" data-level="4" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><i class="fa fa-check"></i><b>4</b> RNA Seq Differentially Expressed, GO Enrichment, and Pathway analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#background"><i class="fa fa-check"></i><b>4.1</b> <strong>Background</strong></a></li>
<li class="chapter" data-level="4.2" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#cleaning-data"><i class="fa fa-check"></i><b>4.2</b> <strong>Cleaning Data</strong></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#programs-used"><i class="fa fa-check"></i><b>4.2.1</b> Programs used?</a></li>
<li class="chapter" data-level="4.2.2" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#acquiring-sequences"><i class="fa fa-check"></i><b>4.2.2</b> Acquiring sequences</a></li>
<li class="chapter" data-level="4.2.3" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#fastqc"><i class="fa fa-check"></i><b>4.2.3</b> FastQC</a></li>
<li class="chapter" data-level="4.2.4" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#trimming-with-trimmomatic-1"><i class="fa fa-check"></i><b>4.2.4</b> Trimming with Trimmomatic</a></li>
<li class="chapter" data-level="4.2.5" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#alignment"><i class="fa fa-check"></i><b>4.2.5</b> Alignment</a></li>
<li class="chapter" data-level="4.2.6" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#assembling-transcripts-with-cufflinks"><i class="fa fa-check"></i><b>4.2.6</b> Assembling transcripts with Cufflinks</a></li>
<li class="chapter" data-level="4.2.7" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#checking-for-contamination"><i class="fa fa-check"></i><b>4.2.7</b> Checking for Contamination</a></li>
<li class="chapter" data-level="4.2.8" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#counting-transcripts"><i class="fa fa-check"></i><b>4.2.8</b> Counting Transcripts</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#differentially-expressed-sequence-identification"><i class="fa fa-check"></i><b>4.3</b> <strong>Differentially Expressed Sequence Identification</strong></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#analyzing-reads-counts"><i class="fa fa-check"></i><b>4.3.1</b> Analyzing Reads Counts</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#interactions-cause-a-difference-between-the-lfc-betwen-pooled-data-e.g.-p53-control-and-ir-and-p53---control-and-ir"><i class="fa fa-check"></i><b>4.4</b> Interactions cause a difference between the lfc betwen pooled data, e.g. p53+/+ (control and IR) and p53-/- (control and IR)</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>4.4.1</b> Exploratory Data Analysis</a></li>
<li class="chapter" data-level="4.4.2" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#identification-of-differentially-expressed-genes"><i class="fa fa-check"></i><b>4.4.2</b> Identification of Differentially Expressed Genes</a></li>
<li class="chapter" data-level="4.4.3" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#gene-annotations"><i class="fa fa-check"></i><b>4.4.3</b> Gene Annotations</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#go-enrichment-analysis-using-gostats"><i class="fa fa-check"></i><b>4.5</b> 7. GO Enrichment analysis using GOstats</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#go-enrichment-analysis-of-downregulated-genes"><i class="fa fa-check"></i><b>4.5.1</b> GO Enrichment analysis of downregulated genes</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#pathway-analysis-using-expression-data"><i class="fa fa-check"></i><b>4.6</b> 8. Pathway analysis using expression data</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#prepare-data"><i class="fa fa-check"></i><b>4.6.1</b> Prepare data</a></li>
<li class="chapter" data-level="4.6.2" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#kegg-pathways"><i class="fa fa-check"></i><b>4.6.2</b> KEGG pathways</a></li>
<li class="chapter" data-level="4.6.3" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#pathway-and-regulation-of-genes-for-oxidative-phosphorylation."><i class="fa fa-check"></i><b>4.6.3</b> Pathway and regulation of genes for Oxidative phosphorylation.</a></li>
<li class="chapter" data-level="4.6.4" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#pathway-and-regulation-of-genes-for-glycosylphosphatidylinositolgpi-anchor-biosynthesis."><i class="fa fa-check"></i><b>4.6.4</b> Pathway and regulation of genes for Glycosylphosphatidylinositol(GPI)-anchor biosynthesis.</a></li>
<li class="chapter" data-level="4.6.5" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#pathway-and-regulation-of-genes-for-rna-polymerase."><i class="fa fa-check"></i><b>4.6.5</b> Pathway and regulation of genes for RNA polymerase.</a></li>
<li class="chapter" data-level="4.6.6" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#pathway-and-regulation-of-genes-for-nucleotide-excision-repair."><i class="fa fa-check"></i><b>4.6.6</b> Pathway and regulation of genes for Nucleotide excision repair.</a></li>
<li class="chapter" data-level="4.6.7" data-path="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html"><a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html#pathway-and-regulation-of-genes-for-non-homologous-end-joining."><i class="fa fa-check"></i><b>4.6.7</b> Pathway and regulation of genes for Non-homologous end-joining.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rna-seq-mkdata.html"><a href="rna-seq-mkdata.html"><i class="fa fa-check"></i><b>5</b> RNA-Seq-MKdata</a></li>
<li class="chapter" data-level="6" data-path="wgcna-rna-seq-blog.html"><a href="wgcna-rna-seq-blog.html"><i class="fa fa-check"></i><b>6</b> WGCNA RNA-seq Blog</a>
<ul>
<li class="chapter" data-level="6.1" data-path="wgcna-rna-seq-blog.html"><a href="wgcna-rna-seq-blog.html#WGCNA"><i class="fa fa-check"></i><b>6.1</b> Introduction to the WGCNA Rpackage</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="wgcna-rna-seq-blog.html"><a href="wgcna-rna-seq-blog.html#wgcna-rpackage-installation-procedure."><i class="fa fa-check"></i><b>6.1.1</b> WGCNA Rpackage Installation procedure.</a></li>
<li class="chapter" data-level="6.1.2" data-path="wgcna-rna-seq-blog.html"><a href="wgcna-rna-seq-blog.html#final-installation-workflow"><i class="fa fa-check"></i><b>6.1.2</b> Final installation workflow:</a></li>
<li class="chapter" data-level="6.1.3" data-path="wgcna-rna-seq-blog.html"><a href="wgcna-rna-seq-blog.html#wgcna-tutorial."><i class="fa fa-check"></i><b>6.1.3</b> WGCNA tutorial.</a></li>
<li class="chapter" data-level="6.1.4" data-path="wgcna-rna-seq-blog.html"><a href="wgcna-rna-seq-blog.html#gene-expression-analysis"><i class="fa fa-check"></i><b>6.1.4</b> 3.4 Gene expression analysis</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="wgcna-rna-seq-blog.html"><a href="wgcna-rna-seq-blog.html#rna-seq-analisys-with-kakus-data-sample."><i class="fa fa-check"></i><b>6.2</b> RNA-seq Analisys with Kaku’s Data sample.</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="wgcna-rna-seq-blog.html"><a href="wgcna-rna-seq-blog.html#data-analysis."><i class="fa fa-check"></i><b>6.2.1</b> Data Analysis.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="youtube-references-.html"><a href="youtube-references-.html"><i class="fa fa-check"></i><b>7</b> Youtube references.</a>
<ul>
<li class="chapter" data-level="7.1" data-path="youtube-references-.html"><a href="youtube-references-.html#anaconda-set-up-robust-data-science-environment-with-miniconda-and-conda-forge."><i class="fa fa-check"></i><b>7.1</b> Anaconda set up, Robust Data Science Environment with Miniconda and Conda-Forge.</a></li>
<li class="chapter" data-level="7.2" data-path="youtube-references-.html"><a href="youtube-references-.html#quality-control-preprocessing-of-raw-reads"><i class="fa fa-check"></i><b>7.2</b> Quality control &amp; preprocessing of raw reads</a></li>
<li class="chapter" data-level="7.3" data-path="youtube-references-.html"><a href="youtube-references-.html#trimmomatic."><i class="fa fa-check"></i><b>7.3</b> Trimmomatic.</a></li>
<li class="chapter" data-level="7.4" data-path="youtube-references-.html"><a href="youtube-references-.html#building-genome-index-and-aligning-with-star"><i class="fa fa-check"></i><b>7.4</b> Building Genome Index and Aligning with STAR</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="external-ref.html"><a href="external-ref.html"><i class="fa fa-check"></i><b>8</b> External Ref</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bioinformatics_RNA-seq</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rna-seq-mkdata" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> RNA-Seq-MKdata</h1>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="rna-seq-mkdata.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA of Raw count file</span></span>
<span id="cb174-2"><a href="rna-seq-mkdata.html#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data file (count) --------</span></span>
<span id="cb174-3"><a href="rna-seq-mkdata.html#cb174-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-4"><a href="rna-seq-mkdata.html#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="co"># all_tpmCSV &lt;- read.csv (&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/all.tpm02.csv&quot;, header = T, row.names=1)</span></span>
<span id="cb174-5"><a href="rna-seq-mkdata.html#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb174-6"><a href="rna-seq-mkdata.html#cb174-6" aria-hidden="true" tabindex="-1"></a>all_raw_count <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/all.raw.count.xlsx&quot;</span>)</span>
<span id="cb174-7"><a href="rna-seq-mkdata.html#cb174-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-8"><a href="rna-seq-mkdata.html#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_raw_count)</span>
<span id="cb174-9"><a href="rna-seq-mkdata.html#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(all_raw_count)</span>
<span id="cb174-10"><a href="rna-seq-mkdata.html#cb174-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(all_raw_count)</span>
<span id="cb174-11"><a href="rna-seq-mkdata.html#cb174-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-12"><a href="rna-seq-mkdata.html#cb174-12" aria-hidden="true" tabindex="-1"></a>all_raw_count00 <span class="ot">&lt;-</span> all_raw_count <span class="sc">%&gt;%</span> <span class="fu">column_to_rownames</span>(<span class="at">var=</span><span class="st">&quot;GeneID&quot;</span>) </span>
<span id="cb174-13"><a href="rna-seq-mkdata.html#cb174-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-14"><a href="rna-seq-mkdata.html#cb174-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-15"><a href="rna-seq-mkdata.html#cb174-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract column names.</span></span>
<span id="cb174-16"><a href="rna-seq-mkdata.html#cb174-16" aria-hidden="true" tabindex="-1"></a>colnames <span class="ot">&lt;-</span> <span class="fu">colnames</span>(all_raw_count)</span>
<span id="cb174-17"><a href="rna-seq-mkdata.html#cb174-17" aria-hidden="true" tabindex="-1"></a>colnames</span>
<span id="cb174-18"><a href="rna-seq-mkdata.html#cb174-18" aria-hidden="true" tabindex="-1"></a><span class="co"># “r convert list to comma separated string”</span></span>
<span id="cb174-19"><a href="rna-seq-mkdata.html#cb174-19" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">shQuote</span>(colnames), <span class="at">collapse=</span><span class="st">&quot;, &quot;</span>) <span class="co"># with quotes.</span></span>
<span id="cb174-20"><a href="rna-seq-mkdata.html#cb174-20" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(colnames, <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>) <span class="co"># without quotes. </span></span>
<span id="cb174-21"><a href="rna-seq-mkdata.html#cb174-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-22"><a href="rna-seq-mkdata.html#cb174-22" aria-hidden="true" tabindex="-1"></a>excluded_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GeneName&quot;</span>, <span class="st">&quot;Chr&quot;</span>, <span class="st">&quot;Start&quot;</span>, <span class="st">&quot;End&quot;</span>, <span class="st">&quot;Strand&quot;</span>, <span class="st">&quot;Length&quot;</span> )</span>
<span id="cb174-23"><a href="rna-seq-mkdata.html#cb174-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-24"><a href="rna-seq-mkdata.html#cb174-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># for select function</span></span>
<span id="cb174-25"><a href="rna-seq-mkdata.html#cb174-25" aria-hidden="true" tabindex="-1"></a>all_raw_count01 <span class="ot">&lt;-</span> <span class="fu">select</span>(all_raw_count, <span class="sc">-</span>excluded_vars) <span class="co"># it works, but... better use:</span></span>
<span id="cb174-26"><a href="rna-seq-mkdata.html#cb174-26" aria-hidden="true" tabindex="-1"></a>all_raw_count01 <span class="ot">&lt;-</span> <span class="fu">select</span>(all_raw_count, <span class="sc">-</span><span class="fu">all_of</span>(excluded_vars)) <span class="co">#exclude all variables in excluded_vars</span></span>
<span id="cb174-27"><a href="rna-seq-mkdata.html#cb174-27" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_raw_count01)</span>
<span id="cb174-28"><a href="rna-seq-mkdata.html#cb174-28" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(all_raw_count01)</span>
<span id="cb174-29"><a href="rna-seq-mkdata.html#cb174-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-30"><a href="rna-seq-mkdata.html#cb174-30" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(all_raw_count01)</span>
<span id="cb174-31"><a href="rna-seq-mkdata.html#cb174-31" aria-hidden="true" tabindex="-1"></a><span class="co"># data.frame</span></span>
<span id="cb174-32"><a href="rna-seq-mkdata.html#cb174-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-33"><a href="rna-seq-mkdata.html#cb174-33" aria-hidden="true" tabindex="-1"></a><span class="co"># df preparation --------</span></span>
<span id="cb174-34"><a href="rna-seq-mkdata.html#cb174-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert values of a column into row names in a df. Source: https://stackoverflow.com/questions/5555408/convert-the-values-in-a-column-into-row-names-in-an-existing-data-frame</span></span>
<span id="cb174-35"><a href="rna-seq-mkdata.html#cb174-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb174-36"><a href="rna-seq-mkdata.html#cb174-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-37"><a href="rna-seq-mkdata.html#cb174-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Method01 </span></span>
<span id="cb174-38"><a href="rna-seq-mkdata.html#cb174-38" aria-hidden="true" tabindex="-1"></a><span class="co"># rownames(all_raw_count01) &lt;- all_raw_count01[,1] # Converting first column into row names.* Column will still remain. </span></span>
<span id="cb174-39"><a href="rna-seq-mkdata.html#cb174-39" aria-hidden="true" tabindex="-1"></a><span class="co"># all_raw_count01[,1] &lt;- NULL # Erasing 1st column. </span></span>
<span id="cb174-40"><a href="rna-seq-mkdata.html#cb174-40" aria-hidden="true" tabindex="-1"></a><span class="co"># all_raw_count01</span></span>
<span id="cb174-41"><a href="rna-seq-mkdata.html#cb174-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-42"><a href="rna-seq-mkdata.html#cb174-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Method03: #Worked!!</span></span>
<span id="cb174-43"><a href="rna-seq-mkdata.html#cb174-43" aria-hidden="true" tabindex="-1"></a>all_raw_count01 <span class="ot">&lt;-</span> all_raw_count01 <span class="sc">%&gt;%</span> <span class="fu">column_to_rownames</span>(<span class="at">var=</span><span class="st">&quot;GeneID&quot;</span>) </span>
<span id="cb174-44"><a href="rna-seq-mkdata.html#cb174-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Source: https://www.geeksforgeeks.org/convert-values-in-column-into-row-names-of-dataframe-in-r/</span></span>
<span id="cb174-45"><a href="rna-seq-mkdata.html#cb174-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-46"><a href="rna-seq-mkdata.html#cb174-46" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_raw_count01 [,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb174-47"><a href="rna-seq-mkdata.html#cb174-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-48"><a href="rna-seq-mkdata.html#cb174-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick exploration of the data ----------</span></span>
<span id="cb174-49"><a href="rna-seq-mkdata.html#cb174-49" aria-hidden="true" tabindex="-1"></a>all_raw_count01 <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(all_raw_count01) <span class="co"># delete all rows with NA</span></span>
<span id="cb174-50"><a href="rna-seq-mkdata.html#cb174-50" aria-hidden="true" tabindex="-1"></a><span class="co"># all_raw_count01_matrix &lt;- as.matrix(all_raw_count01) #convert df into matrix. </span></span>
<span id="cb174-51"><a href="rna-seq-mkdata.html#cb174-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-52"><a href="rna-seq-mkdata.html#cb174-52" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(all_raw_count01, <span class="at">las=</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">&quot;Count raw 47&quot;</span>)  <span class="co"># To many outlier and variation, better work with the log scale. </span></span>
<span id="cb174-53"><a href="rna-seq-mkdata.html#cb174-53" aria-hidden="true" tabindex="-1"></a>all_raw_count01_log <span class="ot">&lt;-</span> <span class="fu">log</span>(all_raw_count01<span class="sc">+</span><span class="dv">1</span>) <span class="co">#here log +1 because the log of 0 = infinity and we will not be able to see the data.</span></span>
<span id="cb174-54"><a href="rna-seq-mkdata.html#cb174-54" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(all_raw_count01_log, <span class="at">las =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">15</span>), <span class="at">main =</span> <span class="st">&quot;Count raw log 49&quot;</span>) <span class="co"># las =2 to make the x labels vertically aligned.</span></span>
<span id="cb174-55"><a href="rna-seq-mkdata.html#cb174-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-56"><a href="rna-seq-mkdata.html#cb174-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms of especific samples.</span></span>
<span id="cb174-57"><a href="rna-seq-mkdata.html#cb174-57" aria-hidden="true" tabindex="-1"></a>mPDL_RNA14D_Ko1 <span class="ot">&lt;-</span> all_raw_count01_log[,<span class="dv">1</span>]</span>
<span id="cb174-58"><a href="rna-seq-mkdata.html#cb174-58" aria-hidden="true" tabindex="-1"></a>mPDL_RNA14D_Ko2 <span class="ot">&lt;-</span> all_raw_count01_log[,<span class="dv">2</span>]</span>
<span id="cb174-59"><a href="rna-seq-mkdata.html#cb174-59" aria-hidden="true" tabindex="-1"></a>mPDL_RNA14D_WT1 <span class="ot">&lt;-</span> all_raw_count01_log[,<span class="dv">5</span>]</span>
<span id="cb174-60"><a href="rna-seq-mkdata.html#cb174-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-61"><a href="rna-seq-mkdata.html#cb174-61" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mPDL_RNA14D_Ko1, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb174-62"><a href="rna-seq-mkdata.html#cb174-62" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mPDL_RNA14D_Ko2, <span class="at">col =</span> <span class="st">&quot;yellow&quot;</span>)</span>
<span id="cb174-63"><a href="rna-seq-mkdata.html#cb174-63" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mPDL_RNA14D_WT1, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;Count raw 14Ko1, 14Ko2, 14Wt1 54&quot;</span>), <span class="at">add=</span>T)</span>
<span id="cb174-64"><a href="rna-seq-mkdata.html#cb174-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-65"><a href="rna-seq-mkdata.html#cb174-65" aria-hidden="true" tabindex="-1"></a><span class="co"># df clean/filter of non expresed genes ------------------</span></span>
<span id="cb174-66"><a href="rna-seq-mkdata.html#cb174-66" aria-hidden="true" tabindex="-1"></a><span class="co"># If Center and Scale needed, remove all rows containing all 0 values.</span></span>
<span id="cb174-67"><a href="rna-seq-mkdata.html#cb174-67" aria-hidden="true" tabindex="-1"></a><span class="co"># df1[rowSums(df1[])&gt;0,]</span></span>
<span id="cb174-68"><a href="rna-seq-mkdata.html#cb174-68" aria-hidden="true" tabindex="-1"></a>all_raw_count02 <span class="ot">&lt;-</span> all_raw_count01[<span class="fu">rowSums</span>(all_raw_count01[])<span class="sc">&gt;</span><span class="dv">0</span>,] </span>
<span id="cb174-69"><a href="rna-seq-mkdata.html#cb174-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-70"><a href="rna-seq-mkdata.html#cb174-70" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_raw_count02 [,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb174-71"><a href="rna-seq-mkdata.html#cb174-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-72"><a href="rna-seq-mkdata.html#cb174-72" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(all_raw_count02, <span class="at">las=</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">&quot;Count raw no 0 :67&quot;</span>)</span>
<span id="cb174-73"><a href="rna-seq-mkdata.html#cb174-73" aria-hidden="true" tabindex="-1"></a>all_raw_count02_log <span class="ot">&lt;-</span> <span class="fu">log</span>(all_raw_count02<span class="sc">+</span><span class="dv">1</span>) <span class="co">#here log +1 because the log of 0 = infinity and we will not be able to see the data.</span></span>
<span id="cb174-74"><a href="rna-seq-mkdata.html#cb174-74" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(all_raw_count02_log, <span class="at">las =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">15</span>), <span class="at">main =</span> <span class="st">&quot;Count raw no 0 log :69&quot;</span>) <span class="co"># las =2 to make the x labels vertically aligned.</span></span>
<span id="cb174-75"><a href="rna-seq-mkdata.html#cb174-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-76"><a href="rna-seq-mkdata.html#cb174-76" aria-hidden="true" tabindex="-1"></a>mPDL_RNA14D_Ko1_02 <span class="ot">&lt;-</span> all_raw_count02_log[,<span class="dv">1</span>]</span>
<span id="cb174-77"><a href="rna-seq-mkdata.html#cb174-77" aria-hidden="true" tabindex="-1"></a>mPDL_RNA14D_Ko2_02 <span class="ot">&lt;-</span> all_raw_count02_log[,<span class="dv">2</span>]</span>
<span id="cb174-78"><a href="rna-seq-mkdata.html#cb174-78" aria-hidden="true" tabindex="-1"></a>mPDL_RNA14D_WT1_02 <span class="ot">&lt;-</span> all_raw_count02_log[,<span class="dv">5</span>]</span>
<span id="cb174-79"><a href="rna-seq-mkdata.html#cb174-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-80"><a href="rna-seq-mkdata.html#cb174-80" aria-hidden="true" tabindex="-1"></a>col1 <span class="ot">&lt;-</span> <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>, <span class="fl">0.5</span>) <span class="co"># red</span></span>
<span id="cb174-81"><a href="rna-seq-mkdata.html#cb174-81" aria-hidden="true" tabindex="-1"></a>col2 <span class="ot">&lt;-</span> <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>, <span class="fl">0.5</span>) <span class="co"># yellow</span></span>
<span id="cb174-82"><a href="rna-seq-mkdata.html#cb174-82" aria-hidden="true" tabindex="-1"></a>col3 <span class="ot">&lt;-</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>, <span class="fl">0.5</span>) <span class="co"># blue</span></span>
<span id="cb174-83"><a href="rna-seq-mkdata.html#cb174-83" aria-hidden="true" tabindex="-1"></a>col4 <span class="ot">&lt;-</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>, <span class="fl">0.5</span>) <span class="co"># green</span></span>
<span id="cb174-84"><a href="rna-seq-mkdata.html#cb174-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-85"><a href="rna-seq-mkdata.html#cb174-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Histograms</span></span>
<span id="cb174-86"><a href="rna-seq-mkdata.html#cb174-86" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mPDL_RNA14D_Ko1_02, <span class="at">col =</span> col1, <span class="at">breaks =</span> <span class="dv">40</span>)</span>
<span id="cb174-87"><a href="rna-seq-mkdata.html#cb174-87" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mPDL_RNA14D_Ko2_02, <span class="at">col =</span> col2, <span class="at">breaks =</span> <span class="dv">40</span>)</span>
<span id="cb174-88"><a href="rna-seq-mkdata.html#cb174-88" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mPDL_RNA14D_WT1_02, <span class="at">col =</span> col3, <span class="at">breaks =</span> <span class="dv">40</span>, <span class="at">add=</span>T)</span>
<span id="cb174-89"><a href="rna-seq-mkdata.html#cb174-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-90"><a href="rna-seq-mkdata.html#cb174-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Density Plots. </span></span>
<span id="cb174-91"><a href="rna-seq-mkdata.html#cb174-91" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">density</span>(mPDL_RNA14D_Ko1_02)</span>
<span id="cb174-92"><a href="rna-seq-mkdata.html#cb174-92" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">density</span>(mPDL_RNA14D_Ko2_02)</span>
<span id="cb174-93"><a href="rna-seq-mkdata.html#cb174-93" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">density</span>(mPDL_RNA14D_WT1_02)</span>
<span id="cb174-94"><a href="rna-seq-mkdata.html#cb174-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-95"><a href="rna-seq-mkdata.html#cb174-95" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d1, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb174-96"><a href="rna-seq-mkdata.html#cb174-96" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(d1, <span class="at">col =</span> col1, <span class="at">border =</span> <span class="st">&quot;red&quot;</span>) <span class="co"># add color and border to d1</span></span>
<span id="cb174-97"><a href="rna-seq-mkdata.html#cb174-97" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(d2, <span class="at">col=</span><span class="st">&quot;yellow&quot;</span>) <span class="co"># add a new line to the density plot created above. </span></span>
<span id="cb174-98"><a href="rna-seq-mkdata.html#cb174-98" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(d2, <span class="at">col =</span> col2, <span class="at">border =</span> <span class="st">&quot;green&quot;</span>) <span class="co"># add color and border to d2</span></span>
<span id="cb174-99"><a href="rna-seq-mkdata.html#cb174-99" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(d3, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>) <span class="co"># add one more line to the density plot. </span></span>
<span id="cb174-100"><a href="rna-seq-mkdata.html#cb174-100" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(d3, <span class="at">col =</span> col3, <span class="at">border =</span> <span class="st">&quot;blue&quot;</span>) <span class="co"># add color and border to d2</span></span>
<span id="cb174-101"><a href="rna-seq-mkdata.html#cb174-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-102"><a href="rna-seq-mkdata.html#cb174-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-103"><a href="rna-seq-mkdata.html#cb174-103" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA using prcomp --------------- </span></span>
<span id="cb174-104"><a href="rna-seq-mkdata.html#cb174-104" aria-hidden="true" tabindex="-1"></a><span class="co"># https://youtu.be/0Jp4gsfOLMs</span></span>
<span id="cb174-105"><a href="rna-seq-mkdata.html#cb174-105" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_raw_count02 [,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>])</span>
<span id="cb174-106"><a href="rna-seq-mkdata.html#cb174-106" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(<span class="fu">t</span>(all_raw_count02), <span class="at">center =</span> T, <span class="at">scale. =</span> T) <span class="co"># 1. Scale = false because there are 0 values. # 2. table was transpose t(), because prcomp() expects samples in rows and genes in columns. 3. The data is not centered... does this make a difference?... No... read here: https://stats.stackexchange.com/questions/189822/how-does-centering-make-a-difference-in-pca-for-svd-and-eigen-decomposition. Searrched with: variables should be shifted to be zero centered. </span></span>
<span id="cb174-107"><a href="rna-seq-mkdata.html#cb174-107" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x[,<span class="dv">1</span>], pca<span class="sc">$</span>x[,<span class="dv">2</span>], <span class="at">main =</span> <span class="st">&quot;Plot PCA C1 v C2 :101&quot;</span>)</span>
<span id="cb174-108"><a href="rna-seq-mkdata.html#cb174-108" aria-hidden="true" tabindex="-1"></a>pca.var <span class="ot">&lt;-</span>  pca<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span> <span class="co"># To see how much variation PC1 accounts for. </span></span>
<span id="cb174-109"><a href="rna-seq-mkdata.html#cb174-109" aria-hidden="true" tabindex="-1"></a>pca.var.per <span class="ot">&lt;-</span> <span class="fu">round</span>(pca.var<span class="sc">/</span><span class="fu">sum</span>(pca.var)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>) <span class="co"># % of variations that each PC accounts for is more useful than the value, calculate %.</span></span>
<span id="cb174-110"><a href="rna-seq-mkdata.html#cb174-110" aria-hidden="true" tabindex="-1"></a>pca.var.per</span>
<span id="cb174-111"><a href="rna-seq-mkdata.html#cb174-111" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(pca.var.per, <span class="at">main =</span> <span class="st">&quot;PCA Scree Plot :104&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Principal component&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Percent Variation&quot;</span>)</span>
<span id="cb174-112"><a href="rna-seq-mkdata.html#cb174-112" aria-hidden="true" tabindex="-1"></a><span class="co"># PC1 accounts for 73.8% of the variation, PC2 15.6%, PC3 5.4% and so on..</span></span>
<span id="cb174-113"><a href="rna-seq-mkdata.html#cb174-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-114"><a href="rna-seq-mkdata.html#cb174-114" aria-hidden="true" tabindex="-1"></a><span class="co">#***************************************</span></span>
<span id="cb174-115"><a href="rna-seq-mkdata.html#cb174-115" aria-hidden="true" tabindex="-1"></a><span class="co"># prcomp returns  3 Things:</span></span>
<span id="cb174-116"><a href="rna-seq-mkdata.html#cb174-116" aria-hidden="true" tabindex="-1"></a><span class="co"># x &lt;- Contains all the principal components )PCs) for drawing a graph. We use the first 2 columns [,1] and [,2] or PC1 and PC2.In this analysis we have 16 samples, therfore we obtain 16 PCs. PC1 accounts for the most variation in data, PC2 accounts for the second most variation and so on. </span></span>
<span id="cb174-117"><a href="rna-seq-mkdata.html#cb174-117" aria-hidden="true" tabindex="-1"></a><span class="co"># sdev &lt;- Standard deviation shows how much variation exists between exh sample. </span></span>
<span id="cb174-118"><a href="rna-seq-mkdata.html#cb174-118" aria-hidden="true" tabindex="-1"></a><span class="co"># rotation &lt;- prcom calls &quot;loading&quot; scores &quot;rotation&quot;. There are loading scores for each PC.  </span></span>
<span id="cb174-119"><a href="rna-seq-mkdata.html#cb174-119" aria-hidden="true" tabindex="-1"></a><span class="co">#****************************************</span></span>
<span id="cb174-120"><a href="rna-seq-mkdata.html#cb174-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-121"><a href="rna-seq-mkdata.html#cb174-121" aria-hidden="true" tabindex="-1"></a><span class="co"># In ggplot</span></span>
<span id="cb174-122"><a href="rna-seq-mkdata.html#cb174-122" aria-hidden="true" tabindex="-1"></a>  <span class="co"># construct the df for the ggplot </span></span>
<span id="cb174-123"><a href="rna-seq-mkdata.html#cb174-123" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb174-124"><a href="rna-seq-mkdata.html#cb174-124" aria-hidden="true" tabindex="-1"></a>pca.data_count <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Sample=</span><span class="fu">rownames</span>(pca<span class="sc">$</span>x), </span>
<span id="cb174-125"><a href="rna-seq-mkdata.html#cb174-125" aria-hidden="true" tabindex="-1"></a>                             <span class="at">X=</span>pca<span class="sc">$</span>x[,<span class="dv">1</span>],</span>
<span id="cb174-126"><a href="rna-seq-mkdata.html#cb174-126" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Y=</span>pca<span class="sc">$</span>x[,<span class="dv">2</span>])</span>
<span id="cb174-127"><a href="rna-seq-mkdata.html#cb174-127" aria-hidden="true" tabindex="-1"></a>pca.data_count</span>
<span id="cb174-128"><a href="rna-seq-mkdata.html#cb174-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-129"><a href="rna-seq-mkdata.html#cb174-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-130"><a href="rna-seq-mkdata.html#cb174-130" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel) <span class="co"># for the repel function. </span></span>
<span id="cb174-131"><a href="rna-seq-mkdata.html#cb174-131" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> pca.data_count, <span class="fu">aes</span>(<span class="at">x=</span>X, <span class="at">y=</span>Y, <span class="at">label=</span>Sample, <span class="at">color=</span>Sample, <span class="at">fill=</span>Sample)) <span class="sc">+</span></span>
<span id="cb174-132"><a href="rna-seq-mkdata.html#cb174-132" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_text(size = 3.5) +</span></span>
<span id="cb174-133"><a href="rna-seq-mkdata.html#cb174-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb174-134"><a href="rna-seq-mkdata.html#cb174-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">rownames</span>(pca.data_count)), <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb174-135"><a href="rna-seq-mkdata.html#cb174-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste</span>(<span class="st">&quot;PC1 - &quot;</span>, pca.var.per[<span class="dv">1</span>], <span class="st">&quot;%&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb174-136"><a href="rna-seq-mkdata.html#cb174-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste</span>(<span class="st">&quot;PC2 - &quot;</span>, pca.var.per[<span class="dv">2</span>], <span class="st">&quot;%&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb174-137"><a href="rna-seq-mkdata.html#cb174-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;PCA Graph prcomp center scaled :120&quot;</span>)</span>
<span id="cb174-138"><a href="rna-seq-mkdata.html#cb174-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-139"><a href="rna-seq-mkdata.html#cb174-139" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 genes expresion ------------</span></span>
<span id="cb174-140"><a href="rna-seq-mkdata.html#cb174-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets look at how to use loading scores to determine which genes have the largest effect on where samples are plotted in the PCA plot</span></span>
<span id="cb174-141"><a href="rna-seq-mkdata.html#cb174-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-142"><a href="rna-seq-mkdata.html#cb174-142" aria-hidden="true" tabindex="-1"></a><span class="co"># PC1</span></span>
<span id="cb174-143"><a href="rna-seq-mkdata.html#cb174-143" aria-hidden="true" tabindex="-1"></a>loading_scores <span class="ot">&lt;-</span> pca<span class="sc">$</span>rotation[,<span class="dv">1</span>]　<span class="co"># Loading score of PC!</span></span>
<span id="cb174-144"><a href="rna-seq-mkdata.html#cb174-144" aria-hidden="true" tabindex="-1"></a>gene_scores <span class="ot">&lt;-</span> <span class="fu">abs</span>(loading_scores) <span class="co"># abs() to sort based on the numbers of magnitude rather than from high to low. </span></span>
<span id="cb174-145"><a href="rna-seq-mkdata.html#cb174-145" aria-hidden="true" tabindex="-1"></a>gene_scores_ranked <span class="ot">&lt;-</span>  <span class="fu">sort</span>(gene_scores, <span class="at">decreasing =</span> T) <span class="co"># Sort the magnitudes of loading scores from high to low. </span></span>
<span id="cb174-146"><a href="rna-seq-mkdata.html#cb174-146" aria-hidden="true" tabindex="-1"></a>top10_genes <span class="ot">&lt;-</span> <span class="fu">names</span>(gene_scores_ranked[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]) <span class="co"># Get the names of the top 10 genes with the largest loading scores magnitude. </span></span>
<span id="cb174-147"><a href="rna-seq-mkdata.html#cb174-147" aria-hidden="true" tabindex="-1"></a>top10_genes</span>
<span id="cb174-148"><a href="rna-seq-mkdata.html#cb174-148" aria-hidden="true" tabindex="-1"></a>pca<span class="sc">$</span>rotation[top10_genes,<span class="dv">1</span>] <span class="co"># show the scores (and +/-)</span></span>
<span id="cb174-149"><a href="rna-seq-mkdata.html#cb174-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-150"><a href="rna-seq-mkdata.html#cb174-150" aria-hidden="true" tabindex="-1"></a>PC1top10.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PC1=</span> pca<span class="sc">$</span>rotation[top10_genes,<span class="dv">1</span>],</span>
<span id="cb174-151"><a href="rna-seq-mkdata.html#cb174-151" aria-hidden="true" tabindex="-1"></a>                       <span class="at">PC2=</span> pca<span class="sc">$</span>rotation[top10_genes,<span class="dv">2</span>])  <span class="co"># Careful This is not top 10 of PC2</span></span>
<span id="cb174-152"><a href="rna-seq-mkdata.html#cb174-152" aria-hidden="true" tabindex="-1"></a>PC1top10.df <span class="co"># Remove PC2</span></span>
<span id="cb174-153"><a href="rna-seq-mkdata.html#cb174-153" aria-hidden="true" tabindex="-1"></a>PC1top10.df[,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb174-154"><a href="rna-seq-mkdata.html#cb174-154" aria-hidden="true" tabindex="-1"></a>PC1top10.df</span>
<span id="cb174-155"><a href="rna-seq-mkdata.html#cb174-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-156"><a href="rna-seq-mkdata.html#cb174-156" aria-hidden="true" tabindex="-1"></a><span class="co">#PC2</span></span>
<span id="cb174-157"><a href="rna-seq-mkdata.html#cb174-157" aria-hidden="true" tabindex="-1"></a>loading_scores <span class="ot">&lt;-</span> pca<span class="sc">$</span>rotation[,<span class="dv">2</span>]　<span class="co"># Loading score of PC</span></span>
<span id="cb174-158"><a href="rna-seq-mkdata.html#cb174-158" aria-hidden="true" tabindex="-1"></a>gene_scores <span class="ot">&lt;-</span> <span class="fu">abs</span>(loading_scores) <span class="co"># abs() to sort based on the numbers of magnitude rather than from high to low. </span></span>
<span id="cb174-159"><a href="rna-seq-mkdata.html#cb174-159" aria-hidden="true" tabindex="-1"></a>gene_scores_ranked <span class="ot">&lt;-</span>  <span class="fu">sort</span>(gene_scores, <span class="at">decreasing =</span> T) <span class="co"># Sort the magnitudes of loading scores from high to low. </span></span>
<span id="cb174-160"><a href="rna-seq-mkdata.html#cb174-160" aria-hidden="true" tabindex="-1"></a>top10_genes <span class="ot">&lt;-</span> <span class="fu">names</span>(gene_scores_ranked[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]) <span class="co"># Get the names of the top 10 genes with the largest loading scores magnitude. </span></span>
<span id="cb174-161"><a href="rna-seq-mkdata.html#cb174-161" aria-hidden="true" tabindex="-1"></a>top10_genes <span class="co"># **I am saving using the same name as the others, so this will change for each  component. </span></span>
<span id="cb174-162"><a href="rna-seq-mkdata.html#cb174-162" aria-hidden="true" tabindex="-1"></a>pca<span class="sc">$</span>rotation[top10_genes,<span class="dv">2</span>] <span class="co"># show the scores (and +/-)</span></span>
<span id="cb174-163"><a href="rna-seq-mkdata.html#cb174-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-164"><a href="rna-seq-mkdata.html#cb174-164" aria-hidden="true" tabindex="-1"></a>PC2top10.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PC2=</span> pca<span class="sc">$</span>rotation[top10_genes,<span class="dv">2</span>])</span>
<span id="cb174-165"><a href="rna-seq-mkdata.html#cb174-165" aria-hidden="true" tabindex="-1"></a>PC2top10.df</span>
<span id="cb174-166"><a href="rna-seq-mkdata.html#cb174-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-167"><a href="rna-seq-mkdata.html#cb174-167" aria-hidden="true" tabindex="-1"></a>Top10DEgenes_prcomp <span class="ot">&lt;-</span> <span class="fu">merge</span>(PC1top10.df, PC2top10.df, <span class="at">by=</span><span class="dv">0</span>, <span class="at">all=</span>T)</span>
<span id="cb174-168"><a href="rna-seq-mkdata.html#cb174-168" aria-hidden="true" tabindex="-1"></a>Top10DEgenes_prcomp</span>
<span id="cb174-169"><a href="rna-seq-mkdata.html#cb174-169" aria-hidden="true" tabindex="-1"></a>Top100DEgenes_prcomp <span class="ot">&lt;-</span> <span class="fu">merge</span>(PC1top10.df, PC2top10.df, <span class="at">by=</span><span class="dv">0</span>, <span class="at">all=</span>T) <span class="co"># Change code above from 10  to 100.</span></span>
<span id="cb174-170"><a href="rna-seq-mkdata.html#cb174-170" aria-hidden="true" tabindex="-1"></a>Top100DEgenes_prcomp</span>
<span id="cb174-171"><a href="rna-seq-mkdata.html#cb174-171" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(TopDEgenes)</span>
<span id="cb174-172"><a href="rna-seq-mkdata.html#cb174-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-173"><a href="rna-seq-mkdata.html#cb174-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-174"><a href="rna-seq-mkdata.html#cb174-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Save DE genes table in a file. --------</span></span>
<span id="cb174-175"><a href="rna-seq-mkdata.html#cb174-175" aria-hidden="true" tabindex="-1"></a><span class="co"># .csv file. </span></span>
<span id="cb174-176"><a href="rna-seq-mkdata.html#cb174-176" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(Top10DEgenes_prcomp, <span class="at">file =</span>  <span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/TopDEgenes_prcomp.csv&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="at">row.names =</span> F)</span>
<span id="cb174-177"><a href="rna-seq-mkdata.html#cb174-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-178"><a href="rna-seq-mkdata.html#cb174-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-179"><a href="rna-seq-mkdata.html#cb174-179" aria-hidden="true" tabindex="-1"></a><span class="co">#Excel file. Source: http://www.sthda.com/english/wiki/writing-data-from-r-to-excel-files-xls-xlsx</span></span>
<span id="cb174-180"><a href="rna-seq-mkdata.html#cb174-180" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;xlsx&quot;</span>)</span>
<span id="cb174-181"><a href="rna-seq-mkdata.html#cb174-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the first data set in a new workbook</span></span>
<span id="cb174-182"><a href="rna-seq-mkdata.html#cb174-182" aria-hidden="true" tabindex="-1"></a><span class="fu">write.xlsx</span>(Top10DEgenes_prcomp, <span class="at">file =</span> <span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Top10DEgenes_prcomp.xlsx&quot;</span>,</span>
<span id="cb174-183"><a href="rna-seq-mkdata.html#cb174-183" aria-hidden="true" tabindex="-1"></a>           <span class="at">sheetName =</span> <span class="st">&quot;top10&quot;</span>, <span class="at">row.names =</span> F, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb174-184"><a href="rna-seq-mkdata.html#cb174-184" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a second data set in a new worksheet</span></span>
<span id="cb174-185"><a href="rna-seq-mkdata.html#cb174-185" aria-hidden="true" tabindex="-1"></a><span class="fu">write.xlsx</span>(Top100DEgenes_prcomp, <span class="at">file =</span> <span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Top10DEgenes_prcomp.xlsx&quot;</span>,</span>
<span id="cb174-186"><a href="rna-seq-mkdata.html#cb174-186" aria-hidden="true" tabindex="-1"></a>           <span class="at">sheetName =</span> <span class="st">&quot;top100&quot;</span>, <span class="at">row.names =</span> F, <span class="at">append =</span> <span class="cn">TRUE</span>) <span class="co"># to add as a new sheet.</span></span>
<span id="cb174-187"><a href="rna-seq-mkdata.html#cb174-187" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a third data set.....</span></span>
<span id="cb174-188"><a href="rna-seq-mkdata.html#cb174-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-189"><a href="rna-seq-mkdata.html#cb174-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-190"><a href="rna-seq-mkdata.html#cb174-190" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;writexl&quot;)</span></span>
<span id="cb174-191"><a href="rna-seq-mkdata.html#cb174-191" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;writexl&quot;</span>)</span>
<span id="cb174-192"><a href="rna-seq-mkdata.html#cb174-192" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(TopDEgenes_prcomp, <span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/all_raw_count01.xlsx&quot;</span>, <span class="at">sheet=</span> top10_genes)</span>
<span id="cb174-193"><a href="rna-seq-mkdata.html#cb174-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-194"><a href="rna-seq-mkdata.html#cb174-194" aria-hidden="true" tabindex="-1"></a><span class="co">#  RNA-seq (ScienceparkSG) ****** -----------------</span></span>
<span id="cb174-195"><a href="rna-seq-mkdata.html#cb174-195" aria-hidden="true" tabindex="-1"></a><span class="co"># Metadata table construction -----------------</span></span>
<span id="cb174-196"><a href="rna-seq-mkdata.html#cb174-196" aria-hidden="true" tabindex="-1"></a><span class="co"># experimental metadata., metadata, cold data file construction.</span></span>
<span id="cb174-197"><a href="rna-seq-mkdata.html#cb174-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract column names.</span></span>
<span id="cb174-198"><a href="rna-seq-mkdata.html#cb174-198" aria-hidden="true" tabindex="-1"></a>colnames <span class="ot">&lt;-</span> <span class="fu">colnames</span>(df)</span>
<span id="cb174-199"><a href="rna-seq-mkdata.html#cb174-199" aria-hidden="true" tabindex="-1"></a><span class="co"># “r convert list to comma separated string”</span></span>
<span id="cb174-200"><a href="rna-seq-mkdata.html#cb174-200" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">shQuote</span>(df), <span class="at">collapse=</span><span class="st">&quot;, &quot;</span>) <span class="co"># with quotes.</span></span>
<span id="cb174-201"><a href="rna-seq-mkdata.html#cb174-201" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(df, <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>) <span class="co"># without quotes. </span></span>
<span id="cb174-202"><a href="rna-seq-mkdata.html#cb174-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-203"><a href="rna-seq-mkdata.html#cb174-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Excel </span></span>
<span id="cb174-204"><a href="rna-seq-mkdata.html#cb174-204" aria-hidden="true" tabindex="-1"></a><span class="co">#Copy/paste list to excel &gt; Data &gt; Text to columns &gt; coma separated &gt; Transpose. To delete quotes: Find/replace &#39; to nothing. </span></span>
<span id="cb174-205"><a href="rna-seq-mkdata.html#cb174-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct rest of the table in excel (it&#39;s faster) then import to R. </span></span>
<span id="cb174-206"><a href="rna-seq-mkdata.html#cb174-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-207"><a href="rna-seq-mkdata.html#cb174-207" aria-hidden="true" tabindex="-1"></a>all_raw_count02_colnames <span class="ot">&lt;-</span> <span class="fu">colnames</span>(all_raw_count02)</span>
<span id="cb174-208"><a href="rna-seq-mkdata.html#cb174-208" aria-hidden="true" tabindex="-1"></a>all_raw_count02_colnames</span>
<span id="cb174-209"><a href="rna-seq-mkdata.html#cb174-209" aria-hidden="true" tabindex="-1"></a>all_raw_count02_colnames2 <span class="ot">&lt;-</span>  <span class="fu">paste</span>(<span class="fu">shQuote</span>(all_raw_count02_colnames), <span class="at">collapse=</span><span class="st">&quot;, &quot;</span>) <span class="co"># with quotes. </span></span>
<span id="cb174-210"><a href="rna-seq-mkdata.html#cb174-210" aria-hidden="true" tabindex="-1"></a>all_raw_count02_colnames2 <span class="ot">&lt;-</span>  <span class="fu">paste</span>(all_raw_count02_colnames, <span class="at">collapse=</span><span class="st">&quot;, &quot;</span>) <span class="co"># without quotes. </span></span>
<span id="cb174-211"><a href="rna-seq-mkdata.html#cb174-211" aria-hidden="true" tabindex="-1"></a>all_raw_count02_colnames2</span>
<span id="cb174-212"><a href="rna-seq-mkdata.html#cb174-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-213"><a href="rna-seq-mkdata.html#cb174-213" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb174-214"><a href="rna-seq-mkdata.html#cb174-214" aria-hidden="true" tabindex="-1"></a>Metadata <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Notes.xlsx&quot;</span>, </span>
<span id="cb174-215"><a href="rna-seq-mkdata.html#cb174-215" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sheet =</span> <span class="st">&quot;MetaData&quot;</span>)</span>
<span id="cb174-216"><a href="rna-seq-mkdata.html#cb174-216" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Metadata)</span>
<span id="cb174-217"><a href="rna-seq-mkdata.html#cb174-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-218"><a href="rna-seq-mkdata.html#cb174-218" aria-hidden="true" tabindex="-1"></a><span class="co"># Order Metadata as you want to appear in the graphs. </span></span>
<span id="cb174-219"><a href="rna-seq-mkdata.html#cb174-219" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb174-220"><a href="rna-seq-mkdata.html#cb174-220" aria-hidden="true" tabindex="-1"></a>Metadata2 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Notes.xlsx&quot;</span>, </span>
<span id="cb174-221"><a href="rna-seq-mkdata.html#cb174-221" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sheet =</span> <span class="st">&quot;MetaData2&quot;</span>)</span>
<span id="cb174-222"><a href="rna-seq-mkdata.html#cb174-222" aria-hidden="true" tabindex="-1"></a>Metadata2</span>
<span id="cb174-223"><a href="rna-seq-mkdata.html#cb174-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-224"><a href="rna-seq-mkdata.html#cb174-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-225"><a href="rna-seq-mkdata.html#cb174-225" aria-hidden="true" tabindex="-1"></a><span class="co"># Or construct directly in R. </span></span>
<span id="cb174-226"><a href="rna-seq-mkdata.html#cb174-226" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert data.frame column to a vector?</span></span>
<span id="cb174-227"><a href="rna-seq-mkdata.html#cb174-227" aria-hidden="true" tabindex="-1"></a>vector <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(df[<span class="st">&#39;colName&#39;</span>]) <span class="co"># Op1 As a Tibble. </span></span>
<span id="cb174-228"><a href="rna-seq-mkdata.html#cb174-228" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(vector) </span>
<span id="cb174-229"><a href="rna-seq-mkdata.html#cb174-229" aria-hidden="true" tabindex="-1"></a>vector2 <span class="ot">&lt;-</span> df[[<span class="st">&#39;colName&#39;</span>]] <span class="co">#Opt2 As a Tibble. </span></span>
<span id="cb174-230"><a href="rna-seq-mkdata.html#cb174-230" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(vector)</span>
<span id="cb174-231"><a href="rna-seq-mkdata.html#cb174-231" aria-hidden="true" tabindex="-1"></a>vector3 <span class="ot">&lt;-</span> df[,<span class="dv">2</span>] <span class="co">#Opt.3 As a Tibble. </span></span>
<span id="cb174-232"><a href="rna-seq-mkdata.html#cb174-232" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(avector)</span>
<span id="cb174-233"><a href="rna-seq-mkdata.html#cb174-233" aria-hidden="true" tabindex="-1"></a>vector4 <span class="ot">&lt;-</span> df<span class="sc">$</span>colName   <span class="co">#Opt.4 as string?...</span></span>
<span id="cb174-234"><a href="rna-seq-mkdata.html#cb174-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-235"><a href="rna-seq-mkdata.html#cb174-235" aria-hidden="true" tabindex="-1"></a>GenotypeVec <span class="ot">&lt;-</span> Metadata[,<span class="dv">2</span>]</span>
<span id="cb174-236"><a href="rna-seq-mkdata.html#cb174-236" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(GenotypeVec) </span>
<span id="cb174-237"><a href="rna-seq-mkdata.html#cb174-237" aria-hidden="true" tabindex="-1"></a>GenotypeVec</span>
<span id="cb174-238"><a href="rna-seq-mkdata.html#cb174-238" aria-hidden="true" tabindex="-1"></a>GenotypeVec <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(Metadata[<span class="st">&#39;Genotype&#39;</span>])</span>
<span id="cb174-239"><a href="rna-seq-mkdata.html#cb174-239" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(GenotypeVec) </span>
<span id="cb174-240"><a href="rna-seq-mkdata.html#cb174-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-241"><a href="rna-seq-mkdata.html#cb174-241" aria-hidden="true" tabindex="-1"></a>GenotypeVec <span class="ot">&lt;-</span> Metadata<span class="sc">$</span>Genotype</span>
<span id="cb174-242"><a href="rna-seq-mkdata.html#cb174-242" aria-hidden="true" tabindex="-1"></a>GenotypeVec</span>
<span id="cb174-243"><a href="rna-seq-mkdata.html#cb174-243" aria-hidden="true" tabindex="-1"></a>GenotypeVec <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">shQuote</span>(Genotype), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>) <span class="co"># copy/paste result in c().</span></span>
<span id="cb174-244"><a href="rna-seq-mkdata.html#cb174-244" aria-hidden="true" tabindex="-1"></a>Genotype <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>)</span>
<span id="cb174-245"><a href="rna-seq-mkdata.html#cb174-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-246"><a href="rna-seq-mkdata.html#cb174-246" aria-hidden="true" tabindex="-1"></a>TimeVect <span class="ot">&lt;-</span> Metadata<span class="sc">$</span>Time</span>
<span id="cb174-247"><a href="rna-seq-mkdata.html#cb174-247" aria-hidden="true" tabindex="-1"></a>TimeVect</span>
<span id="cb174-248"><a href="rna-seq-mkdata.html#cb174-248" aria-hidden="true" tabindex="-1"></a>TimeVect2 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">shQuote</span>(TimeVect), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>) <span class="co"># copy/paste result in c().</span></span>
<span id="cb174-249"><a href="rna-seq-mkdata.html#cb174-249" aria-hidden="true" tabindex="-1"></a>TimeVect2</span>
<span id="cb174-250"><a href="rna-seq-mkdata.html#cb174-250" aria-hidden="true" tabindex="-1"></a>Time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>)</span>
<span id="cb174-251"><a href="rna-seq-mkdata.html#cb174-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-252"><a href="rna-seq-mkdata.html#cb174-252" aria-hidden="true" tabindex="-1"></a>TissueVect <span class="ot">&lt;-</span> Metadata<span class="sc">$</span>Tissue</span>
<span id="cb174-253"><a href="rna-seq-mkdata.html#cb174-253" aria-hidden="true" tabindex="-1"></a>TissueVect <span class="co"># Instead of new vector name just save in same vector</span></span>
<span id="cb174-254"><a href="rna-seq-mkdata.html#cb174-254" aria-hidden="true" tabindex="-1"></a>TissueVect <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">shQuote</span>(TissueVect), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>) <span class="co"># copy/paste result in c().</span></span>
<span id="cb174-255"><a href="rna-seq-mkdata.html#cb174-255" aria-hidden="true" tabindex="-1"></a>TissueVect</span>
<span id="cb174-256"><a href="rna-seq-mkdata.html#cb174-256" aria-hidden="true" tabindex="-1"></a>Tissue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>)</span>
<span id="cb174-257"><a href="rna-seq-mkdata.html#cb174-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-258"><a href="rna-seq-mkdata.html#cb174-258" aria-hidden="true" tabindex="-1"></a>ShortNVect <span class="ot">&lt;-</span> Metadata<span class="sc">$</span>ShortName</span>
<span id="cb174-259"><a href="rna-seq-mkdata.html#cb174-259" aria-hidden="true" tabindex="-1"></a>ShortNVect <span class="co"># Instead of new vector name just save in same vector</span></span>
<span id="cb174-260"><a href="rna-seq-mkdata.html#cb174-260" aria-hidden="true" tabindex="-1"></a>ShortNVect <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">shQuote</span>(ShortNVect), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>) <span class="co"># copy/paste result in c().</span></span>
<span id="cb174-261"><a href="rna-seq-mkdata.html#cb174-261" aria-hidden="true" tabindex="-1"></a>ShortNVect</span>
<span id="cb174-262"><a href="rna-seq-mkdata.html#cb174-262" aria-hidden="true" tabindex="-1"></a>ShortName <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;14_Ko1&#39;</span>,<span class="st">&#39;14_Ko2&#39;</span>,<span class="st">&#39;14_Ko3&#39;</span>,<span class="st">&#39;14_Ko4&#39;</span>,<span class="st">&#39;14_WT1&#39;</span>,<span class="st">&#39;14_WT2&#39;</span>,<span class="st">&#39;14_WT3&#39;</span>,<span class="st">&#39;14_WT4&#39;</span>,<span class="st">&#39;7_Ko1&#39;</span>,<span class="st">&#39;7_Ko2&#39;</span>,<span class="st">&#39;7_Ko3&#39;</span>,<span class="st">&#39;7_Ko4&#39;</span>,<span class="st">&#39;7_WT1&#39;</span>,<span class="st">&#39;7_WT2&#39;</span>,<span class="st">&#39;7_WT3&#39;</span>,<span class="st">&#39;7_WT4&#39;</span>)</span>
<span id="cb174-263"><a href="rna-seq-mkdata.html#cb174-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-264"><a href="rna-seq-mkdata.html#cb174-264" aria-hidden="true" tabindex="-1"></a>SampNVect <span class="ot">&lt;-</span> Metadata<span class="sc">$</span>SampleName</span>
<span id="cb174-265"><a href="rna-seq-mkdata.html#cb174-265" aria-hidden="true" tabindex="-1"></a>SampNVect <span class="co"># Instead of new vector name just save in same vector</span></span>
<span id="cb174-266"><a href="rna-seq-mkdata.html#cb174-266" aria-hidden="true" tabindex="-1"></a>SampNVect <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">shQuote</span>(SampNVect), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>) <span class="co"># copy/paste result in c().</span></span>
<span id="cb174-267"><a href="rna-seq-mkdata.html#cb174-267" aria-hidden="true" tabindex="-1"></a>SampNVect</span>
<span id="cb174-268"><a href="rna-seq-mkdata.html#cb174-268" aria-hidden="true" tabindex="-1"></a>SampName <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;mPDL_RNA14D_Ko1&#39;</span>,<span class="st">&#39;mPDL_RNA14D_Ko2&#39;</span>,<span class="st">&#39;mPDL_RNA14D_Ko3&#39;</span>,<span class="st">&#39;mPDL_RNA14D_Ko4&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT1&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT2&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT3&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT4&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko1&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko2&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko3&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko4&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT1&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT2&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT3&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT4&#39;</span>)</span>
<span id="cb174-269"><a href="rna-seq-mkdata.html#cb174-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-270"><a href="rna-seq-mkdata.html#cb174-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-271"><a href="rna-seq-mkdata.html#cb174-271" aria-hidden="true" tabindex="-1"></a><span class="co"># Or create the Metadata file manually in R. </span></span>
<span id="cb174-272"><a href="rna-seq-mkdata.html#cb174-272" aria-hidden="true" tabindex="-1"></a><span class="co">#Create vectors containing the data. </span></span>
<span id="cb174-273"><a href="rna-seq-mkdata.html#cb174-273" aria-hidden="true" tabindex="-1"></a>SampName <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;mPDL_RNA14D_Ko1&#39;</span>,<span class="st">&#39;mPDL_RNA14D_Ko2&#39;</span>,<span class="st">&#39;mPDL_RNA14D_Ko3&#39;</span>,<span class="st">&#39;mPDL_RNA14D_Ko4&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT1&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT2&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT3&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT4&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko1&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko2&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko3&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko4&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT1&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT2&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT3&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT4&#39;</span>) <span class="co"># create Samples list as they appear in the df. </span></span>
<span id="cb174-274"><a href="rna-seq-mkdata.html#cb174-274" aria-hidden="true" tabindex="-1"></a>Genotype <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;Ko&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>,<span class="st">&#39;WT&#39;</span>) <span class="co"># Order according to the samples. </span></span>
<span id="cb174-275"><a href="rna-seq-mkdata.html#cb174-275" aria-hidden="true" tabindex="-1"></a>Time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;14d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>,<span class="st">&#39;7d&#39;</span>)</span>
<span id="cb174-276"><a href="rna-seq-mkdata.html#cb174-276" aria-hidden="true" tabindex="-1"></a>Tissue <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>,<span class="st">&#39;PDL&#39;</span>)</span>
<span id="cb174-277"><a href="rna-seq-mkdata.html#cb174-277" aria-hidden="true" tabindex="-1"></a>ShortName <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;14_Ko1&#39;</span>,<span class="st">&#39;14_Ko2&#39;</span>,<span class="st">&#39;14_Ko3&#39;</span>,<span class="st">&#39;14_Ko4&#39;</span>,<span class="st">&#39;14_WT1&#39;</span>,<span class="st">&#39;14_WT2&#39;</span>,<span class="st">&#39;14_WT3&#39;</span>,<span class="st">&#39;14_WT4&#39;</span>,<span class="st">&#39;7_Ko1&#39;</span>,<span class="st">&#39;7_Ko2&#39;</span>,<span class="st">&#39;7_Ko3&#39;</span>,<span class="st">&#39;7_Ko4&#39;</span>,<span class="st">&#39;7_WT1&#39;</span>,<span class="st">&#39;7_WT2&#39;</span>,<span class="st">&#39;7_WT3&#39;</span>,<span class="st">&#39;7_WT4&#39;</span>)</span>
<span id="cb174-278"><a href="rna-seq-mkdata.html#cb174-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-279"><a href="rna-seq-mkdata.html#cb174-279" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine vectors into a data frame.</span></span>
<span id="cb174-280"><a href="rna-seq-mkdata.html#cb174-280" aria-hidden="true" tabindex="-1"></a>ColdData <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Genotype, Time, Tissue, ShortName)</span>
<span id="cb174-281"><a href="rna-seq-mkdata.html#cb174-281" aria-hidden="true" tabindex="-1"></a>ColdData</span>
<span id="cb174-282"><a href="rna-seq-mkdata.html#cb174-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-283"><a href="rna-seq-mkdata.html#cb174-283" aria-hidden="true" tabindex="-1"></a><span class="co">#Create row names with the associated sample names.</span></span>
<span id="cb174-284"><a href="rna-seq-mkdata.html#cb174-284" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ColdData) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;mPDL_RNA14D_Ko1&#39;</span>,<span class="st">&#39;mPDL_RNA14D_Ko2&#39;</span>,<span class="st">&#39;mPDL_RNA14D_Ko3&#39;</span>,<span class="st">&#39;mPDL_RNA14D_Ko4&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT1&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT2&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT3&#39;</span>,<span class="st">&#39;mPDL_RNA14D_WT4&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko1&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko2&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko3&#39;</span>,<span class="st">&#39;mPDL_RNA7D_Ko4&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT1&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT2&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT3&#39;</span>,<span class="st">&#39;mPDL_RNA7D_WT4&#39;</span>)</span>
<span id="cb174-285"><a href="rna-seq-mkdata.html#cb174-285" aria-hidden="true" tabindex="-1"></a>ColdData</span>
<span id="cb174-286"><a href="rna-seq-mkdata.html#cb174-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-287"><a href="rna-seq-mkdata.html#cb174-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-288"><a href="rna-seq-mkdata.html#cb174-288" aria-hidden="true" tabindex="-1"></a><span class="co"># If df includes the Sample names as a column.</span></span>
<span id="cb174-289"><a href="rna-seq-mkdata.html#cb174-289" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine vectors into a data frame.</span></span>
<span id="cb174-290"><a href="rna-seq-mkdata.html#cb174-290" aria-hidden="true" tabindex="-1"></a>ColdData2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(SampName, Genotype, Time, Tissue, ShortName)</span>
<span id="cb174-291"><a href="rna-seq-mkdata.html#cb174-291" aria-hidden="true" tabindex="-1"></a>ColdData2</span>
<span id="cb174-292"><a href="rna-seq-mkdata.html#cb174-292" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert values of a column into row names in a df. Source: https://stackoverflow.com/questions/5555408/convert-the-values-in-a-column-into-row-names-in-an-existing-data-frame</span></span>
<span id="cb174-293"><a href="rna-seq-mkdata.html#cb174-293" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb174-294"><a href="rna-seq-mkdata.html#cb174-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Method01</span></span>
<span id="cb174-295"><a href="rna-seq-mkdata.html#cb174-295" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ColdData2) <span class="ot">&lt;-</span> ColdData2[,<span class="dv">1</span>] <span class="co"># Converting first column into row names.* Column will still remain. </span></span>
<span id="cb174-296"><a href="rna-seq-mkdata.html#cb174-296" aria-hidden="true" tabindex="-1"></a>ColdData2</span>
<span id="cb174-297"><a href="rna-seq-mkdata.html#cb174-297" aria-hidden="true" tabindex="-1"></a>ColdData2[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Erasing 1st column. </span></span>
<span id="cb174-298"><a href="rna-seq-mkdata.html#cb174-298" aria-hidden="true" tabindex="-1"></a>ColdData2</span>
<span id="cb174-299"><a href="rna-seq-mkdata.html#cb174-299" aria-hidden="true" tabindex="-1"></a><span class="co"># Method02</span></span>
<span id="cb174-300"><a href="rna-seq-mkdata.html#cb174-300" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(ColdData2) <span class="ot">&lt;-</span> ColdData2<span class="sc">$</span>SampName</span>
<span id="cb174-301"><a href="rna-seq-mkdata.html#cb174-301" aria-hidden="true" tabindex="-1"></a>ColdData2</span>
<span id="cb174-302"><a href="rna-seq-mkdata.html#cb174-302" aria-hidden="true" tabindex="-1"></a>ColdData2[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb174-303"><a href="rna-seq-mkdata.html#cb174-303" aria-hidden="true" tabindex="-1"></a>ColdData2</span>
<span id="cb174-304"><a href="rna-seq-mkdata.html#cb174-304" aria-hidden="true" tabindex="-1"></a><span class="co"># Method03:</span></span>
<span id="cb174-305"><a href="rna-seq-mkdata.html#cb174-305" aria-hidden="true" tabindex="-1"></a>ColdData2 <span class="ot">&lt;-</span> ColdData2 <span class="sc">%&gt;%</span> remove_rownames <span class="sc">%&gt;%</span> <span class="fu">column_to_rownames</span>(<span class="at">var=</span><span class="st">&quot;SampName&quot;</span>) </span>
<span id="cb174-306"><a href="rna-seq-mkdata.html#cb174-306" aria-hidden="true" tabindex="-1"></a>ColdData2 <span class="ot">&lt;-</span> ColdData2 <span class="sc">%&gt;%</span>  <span class="fu">column_to_rownames</span>(<span class="at">var=</span><span class="st">&quot;SampName&quot;</span>) <span class="co"># no need for remove_rowmanes?</span></span>
<span id="cb174-307"><a href="rna-seq-mkdata.html#cb174-307" aria-hidden="true" tabindex="-1"></a>ColdData2</span>
<span id="cb174-308"><a href="rna-seq-mkdata.html#cb174-308" aria-hidden="true" tabindex="-1"></a><span class="co"># Source: https://www.geeksforgeeks.org/convert-values-in-column-into-row-names-of-dataframe-in-r/</span></span>
<span id="cb174-309"><a href="rna-seq-mkdata.html#cb174-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-310"><a href="rna-seq-mkdata.html#cb174-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-311"><a href="rna-seq-mkdata.html#cb174-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-312"><a href="rna-seq-mkdata.html#cb174-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-313"><a href="rna-seq-mkdata.html#cb174-313" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA applied to RNA-seq data --------</span></span>
<span id="cb174-314"><a href="rna-seq-mkdata.html#cb174-314" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DESeq2)</span>
<span id="cb174-315"><a href="rna-seq-mkdata.html#cb174-315" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr) <span class="co"># for piper %&gt;%</span></span>
<span id="cb174-316"><a href="rna-seq-mkdata.html#cb174-316" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># for tibble (column to rowname), and other packages. </span></span>
<span id="cb174-317"><a href="rna-seq-mkdata.html#cb174-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-318"><a href="rna-seq-mkdata.html#cb174-318" aria-hidden="true" tabindex="-1"></a><span class="co">#from the https://scienceparkstudygroup.github.io/rna-seq-lesson/aio/index.html</span></span>
<span id="cb174-319"><a href="rna-seq-mkdata.html#cb174-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-320"><a href="rna-seq-mkdata.html#cb174-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Imported data</span></span>
<span id="cb174-321"><a href="rna-seq-mkdata.html#cb174-321" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_raw_count01 [<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]) <span class="co"># Raw count df</span></span>
<span id="cb174-322"><a href="rna-seq-mkdata.html#cb174-322" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_raw_count02 [<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]) <span class="co"># df  with no 0s for centering and scaling. </span></span>
<span id="cb174-323"><a href="rna-seq-mkdata.html#cb174-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-324"><a href="rna-seq-mkdata.html#cb174-324" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span> (all_raw_count02[,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]) <span class="co"># Use this for dds construction (no 0)</span></span>
<span id="cb174-325"><a href="rna-seq-mkdata.html#cb174-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-326"><a href="rna-seq-mkdata.html#cb174-326" aria-hidden="true" tabindex="-1"></a><span class="co"># reorder counts columns according to the experimental design file --------</span></span>
<span id="cb174-327"><a href="rna-seq-mkdata.html#cb174-327" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Metadata2)</span>
<span id="cb174-328"><a href="rna-seq-mkdata.html#cb174-328" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> all_raw_count02[,Metadata2<span class="sc">$</span>SampleName]</span>
<span id="cb174-329"><a href="rna-seq-mkdata.html#cb174-329" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counts [<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]) </span>
<span id="cb174-330"><a href="rna-seq-mkdata.html#cb174-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-331"><a href="rna-seq-mkdata.html#cb174-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-332"><a href="rna-seq-mkdata.html#cb174-332" aria-hidden="true" tabindex="-1"></a><span class="co"># first five rows and five columns</span></span>
<span id="cb174-333"><a href="rna-seq-mkdata.html#cb174-333" aria-hidden="true" tabindex="-1"></a>counts[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb174-334"><a href="rna-seq-mkdata.html#cb174-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-335"><a href="rna-seq-mkdata.html#cb174-335" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dds object that will be used through the rest of this episode.</span></span>
<span id="cb174-336"><a href="rna-seq-mkdata.html#cb174-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-337"><a href="rna-seq-mkdata.html#cb174-337" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that sample names match in both files</span></span>
<span id="cb174-338"><a href="rna-seq-mkdata.html#cb174-338" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">colnames</span>(counts) <span class="sc">%in%</span> Metadata2<span class="sc">$</span>SampleName)</span>
<span id="cb174-339"><a href="rna-seq-mkdata.html#cb174-339" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">colnames</span>(counts) <span class="sc">==</span> Metadata2<span class="sc">$</span>SampleName)</span>
<span id="cb174-340"><a href="rna-seq-mkdata.html#cb174-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-341"><a href="rna-seq-mkdata.html#cb174-341" aria-hidden="true" tabindex="-1"></a><span class="co"># Differential expression analysis.</span></span>
<span id="cb174-342"><a href="rna-seq-mkdata.html#cb174-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-343"><a href="rna-seq-mkdata.html#cb174-343" aria-hidden="true" tabindex="-1"></a><span class="do">## Creation of the DESeqDataSet object</span></span>
<span id="cb174-344"><a href="rna-seq-mkdata.html#cb174-344" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> counts, </span>
<span id="cb174-345"><a href="rna-seq-mkdata.html#cb174-345" aria-hidden="true" tabindex="-1"></a>                              <span class="at">colData =</span> Metadata2, </span>
<span id="cb174-346"><a href="rna-seq-mkdata.html#cb174-346" aria-hidden="true" tabindex="-1"></a>                              <span class="at">design =</span> <span class="sc">~</span> Genotype <span class="sc">+</span> Time)</span>
<span id="cb174-347"><a href="rna-seq-mkdata.html#cb174-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-348"><a href="rna-seq-mkdata.html#cb174-348" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance stabilization ---------</span></span>
<span id="cb174-349"><a href="rna-seq-mkdata.html#cb174-349" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot of mean - sd comparison</span></span>
<span id="cb174-350"><a href="rna-seq-mkdata.html#cb174-350" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance - mean plot for all genes</span></span>
<span id="cb174-351"><a href="rna-seq-mkdata.html#cb174-351" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counts)</span>
<span id="cb174-352"><a href="rna-seq-mkdata.html#cb174-352" aria-hidden="true" tabindex="-1"></a>p_mean_sd_scaled <span class="ot">&lt;-</span> </span>
<span id="cb174-353"><a href="rna-seq-mkdata.html#cb174-353" aria-hidden="true" tabindex="-1"></a>  counts <span class="sc">%&gt;%</span> </span>
<span id="cb174-354"><a href="rna-seq-mkdata.html#cb174-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb174-355"><a href="rna-seq-mkdata.html#cb174-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;gene&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-356"><a href="rna-seq-mkdata.html#cb174-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span> gene, <span class="at">names_to =</span> <span class="st">&quot;sample&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-357"><a href="rna-seq-mkdata.html#cb174-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gene) <span class="sc">%&gt;%</span> </span>
<span id="cb174-358"><a href="rna-seq-mkdata.html#cb174-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">gene_average =</span> <span class="fu">mean</span>(counts), <span class="at">gene_stdev =</span> <span class="fu">sd</span>(counts)) <span class="sc">%&gt;%</span> </span>
<span id="cb174-359"><a href="rna-seq-mkdata.html#cb174-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb174-360"><a href="rna-seq-mkdata.html#cb174-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(., <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(gene_average), <span class="at">y =</span> <span class="fu">log10</span>(gene_stdev))) <span class="sc">+</span></span>
<span id="cb174-361"><a href="rna-seq-mkdata.html#cb174-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb174-362"><a href="rna-seq-mkdata.html#cb174-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Gene count average (log10 scale)&quot;</span>,</span>
<span id="cb174-363"><a href="rna-seq-mkdata.html#cb174-363" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Gene count standard deviation (log10 scale)&quot;</span>) <span class="sc">+</span></span>
<span id="cb174-364"><a href="rna-seq-mkdata.html#cb174-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mean - Standard deviation relationship</span><span class="sc">\n</span><span class="st">(no variance stabilisation)&quot;</span>)</span>
<span id="cb174-365"><a href="rna-seq-mkdata.html#cb174-365" aria-hidden="true" tabindex="-1"></a>p_mean_sd_scaled</span>
<span id="cb174-366"><a href="rna-seq-mkdata.html#cb174-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-367"><a href="rna-seq-mkdata.html#cb174-367" aria-hidden="true" tabindex="-1"></a><span class="fu">is.data.frame</span>(counts2)</span>
<span id="cb174-368"><a href="rna-seq-mkdata.html#cb174-368" aria-hidden="true" tabindex="-1"></a>counts2 <span class="ot">&lt;-</span> <span class="fu">rownames_to_column</span>(counts, <span class="st">&quot;gene&quot;</span>)</span>
<span id="cb174-369"><a href="rna-seq-mkdata.html#cb174-369" aria-hidden="true" tabindex="-1"></a>counts2 <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(counts2, <span class="at">cols =</span> <span class="sc">-</span>gene, <span class="at">names_to =</span> <span class="st">&quot;sample&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>)</span>
<span id="cb174-370"><a href="rna-seq-mkdata.html#cb174-370" aria-hidden="true" tabindex="-1"></a>counts2 <span class="ot">&lt;-</span> <span class="fu">group_by</span>(gene)</span>
<span id="cb174-371"><a href="rna-seq-mkdata.html#cb174-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-372"><a href="rna-seq-mkdata.html#cb174-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-373"><a href="rna-seq-mkdata.html#cb174-373" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counts2[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,])</span>
<span id="cb174-374"><a href="rna-seq-mkdata.html#cb174-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-375"><a href="rna-seq-mkdata.html#cb174-375" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;vsn&quot;</span>)</span>
<span id="cb174-376"><a href="rna-seq-mkdata.html#cb174-376" aria-hidden="true" tabindex="-1"></a><span class="fu">meanSdPlot</span>(cts, <span class="at">ranks =</span> <span class="cn">FALSE</span>)</span>
<span id="cb174-377"><a href="rna-seq-mkdata.html#cb174-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-378"><a href="rna-seq-mkdata.html#cb174-378" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance stabilisation</span></span>
<span id="cb174-379"><a href="rna-seq-mkdata.html#cb174-379" aria-hidden="true" tabindex="-1"></a><span class="co"># dds &lt;- estimateSizeFactors(dds)</span></span>
<span id="cb174-380"><a href="rna-seq-mkdata.html#cb174-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-381"><a href="rna-seq-mkdata.html#cb174-381" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span>  <span class="fu">estimateDispersions</span>(<span class="at">object =</span> dds, </span>
<span id="cb174-382"><a href="rna-seq-mkdata.html#cb174-382" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fitType =</span> <span class="st">&quot;parametric&quot;</span>, </span>
<span id="cb174-383"><a href="rna-seq-mkdata.html#cb174-383" aria-hidden="true" tabindex="-1"></a>                            <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb174-384"><a href="rna-seq-mkdata.html#cb174-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-385"><a href="rna-seq-mkdata.html#cb174-385" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> <span class="fu">estimateSizeFactors</span>(dds)</span>
<span id="cb174-386"><a href="rna-seq-mkdata.html#cb174-386" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span>  <span class="fu">estimateDispersions</span>(<span class="at">object =</span> dds,</span>
<span id="cb174-387"><a href="rna-seq-mkdata.html#cb174-387" aria-hidden="true" tabindex="-1"></a>                            <span class="at">fitType =</span> <span class="st">&quot;parametric&quot;</span>,</span>
<span id="cb174-388"><a href="rna-seq-mkdata.html#cb174-388" aria-hidden="true" tabindex="-1"></a>                            <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb174-389"><a href="rna-seq-mkdata.html#cb174-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-390"><a href="rna-seq-mkdata.html#cb174-390" aria-hidden="true" tabindex="-1"></a>vsd <span class="ot">=</span> <span class="fu">varianceStabilizingTransformation</span>(<span class="at">object =</span> dds, </span>
<span id="cb174-391"><a href="rna-seq-mkdata.html#cb174-391" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">blind =</span> <span class="cn">TRUE</span>,           <span class="co"># do not take the design formula into account</span></span>
<span id="cb174-392"><a href="rna-seq-mkdata.html#cb174-392" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># best practice for sample-level QC</span></span>
<span id="cb174-393"><a href="rna-seq-mkdata.html#cb174-393" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fitType =</span> <span class="st">&quot;parametric&quot;</span>)</span>
<span id="cb174-394"><a href="rna-seq-mkdata.html#cb174-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-395"><a href="rna-seq-mkdata.html#cb174-395" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the matrix of variance stabilised counts</span></span>
<span id="cb174-396"><a href="rna-seq-mkdata.html#cb174-396" aria-hidden="true" tabindex="-1"></a>variance_stabilised_counts <span class="ot">&lt;-</span> <span class="fu">assay</span>(vsd)</span>
<span id="cb174-397"><a href="rna-seq-mkdata.html#cb174-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-398"><a href="rna-seq-mkdata.html#cb174-398" aria-hidden="true" tabindex="-1"></a><span class="co"># create the mean-sd plot</span></span>
<span id="cb174-399"><a href="rna-seq-mkdata.html#cb174-399" aria-hidden="true" tabindex="-1"></a>p_mean_sd_vst <span class="ot">&lt;-</span> </span>
<span id="cb174-400"><a href="rna-seq-mkdata.html#cb174-400" aria-hidden="true" tabindex="-1"></a>  variance_stabilised_counts <span class="sc">%&gt;%</span> </span>
<span id="cb174-401"><a href="rna-seq-mkdata.html#cb174-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb174-402"><a href="rna-seq-mkdata.html#cb174-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;gene&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-403"><a href="rna-seq-mkdata.html#cb174-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span> gene, <span class="at">names_to =</span> <span class="st">&quot;sample&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-404"><a href="rna-seq-mkdata.html#cb174-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gene) <span class="sc">%&gt;%</span> </span>
<span id="cb174-405"><a href="rna-seq-mkdata.html#cb174-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">gene_average =</span> <span class="fu">mean</span>(counts), <span class="at">gene_stdev =</span> <span class="fu">sd</span>(counts)) <span class="sc">%&gt;%</span> </span>
<span id="cb174-406"><a href="rna-seq-mkdata.html#cb174-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb174-407"><a href="rna-seq-mkdata.html#cb174-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(., <span class="fu">aes</span>(<span class="at">x =</span> gene_average, <span class="at">y =</span> gene_stdev)) <span class="sc">+</span></span>
<span id="cb174-408"><a href="rna-seq-mkdata.html#cb174-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb174-409"><a href="rna-seq-mkdata.html#cb174-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Gene count average (variance stabilised)&quot;</span>, </span>
<span id="cb174-410"><a href="rna-seq-mkdata.html#cb174-410" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Gene count standard deviation (variance stabilised)&quot;</span>) <span class="sc">+</span></span>
<span id="cb174-411"><a href="rna-seq-mkdata.html#cb174-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mean - Standard deviation relationship</span><span class="sc">\n</span><span class="st">(after variance stabilisation &quot;</span>)</span>
<span id="cb174-412"><a href="rna-seq-mkdata.html#cb174-412" aria-hidden="true" tabindex="-1"></a>p_mean_sd_vst</span>
<span id="cb174-413"><a href="rna-seq-mkdata.html#cb174-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-414"><a href="rna-seq-mkdata.html#cb174-414" aria-hidden="true" tabindex="-1"></a><span class="co"># RNA-seq scree plot -----------</span></span>
<span id="cb174-415"><a href="rna-seq-mkdata.html#cb174-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-416"><a href="rna-seq-mkdata.html#cb174-416" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom PCA function</span></span>
<span id="cb174-417"><a href="rna-seq-mkdata.html#cb174-417" aria-hidden="true" tabindex="-1"></a><span class="co"># define a custom R function called &quot;mypca()&quot;&quot;</span></span>
<span id="cb174-418"><a href="rna-seq-mkdata.html#cb174-418" aria-hidden="true" tabindex="-1"></a>mypca <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>){</span>
<span id="cb174-419"><a href="rna-seq-mkdata.html#cb174-419" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Samples should be in rows</span></span>
<span id="cb174-420"><a href="rna-seq-mkdata.html#cb174-420" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variables in the columns</span></span>
<span id="cb174-421"><a href="rna-seq-mkdata.html#cb174-421" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-422"><a href="rna-seq-mkdata.html#cb174-422" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove constant variables</span></span>
<span id="cb174-423"><a href="rna-seq-mkdata.html#cb174-423" aria-hidden="true" tabindex="-1"></a>  constant_val <span class="ot">=</span> <span class="fu">apply</span>(x,<span class="dv">2</span>,<span class="st">&#39;sd&#39;</span>)</span>
<span id="cb174-424"><a href="rna-seq-mkdata.html#cb174-424" aria-hidden="true" tabindex="-1"></a>  x_reduced <span class="ot">=</span> x[,constant_val<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb174-425"><a href="rna-seq-mkdata.html#cb174-425" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-426"><a href="rna-seq-mkdata.html#cb174-426" aria-hidden="true" tabindex="-1"></a>  <span class="co"># perform SVD</span></span>
<span id="cb174-427"><a href="rna-seq-mkdata.html#cb174-427" aria-hidden="true" tabindex="-1"></a>  SVD <span class="ot">&lt;-</span> <span class="fu">svd</span>(<span class="fu">scale</span>(x_reduced,<span class="at">center =</span> center, <span class="at">scale =</span> scale))</span>
<span id="cb174-428"><a href="rna-seq-mkdata.html#cb174-428" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-429"><a href="rna-seq-mkdata.html#cb174-429" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create scores data frame</span></span>
<span id="cb174-430"><a href="rna-seq-mkdata.html#cb174-430" aria-hidden="true" tabindex="-1"></a>  scores <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(SVD<span class="sc">$</span>u <span class="sc">%*%</span> <span class="fu">diag</span>(SVD<span class="sc">$</span>d))</span>
<span id="cb174-431"><a href="rna-seq-mkdata.html#cb174-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(scores) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(x)</span>
<span id="cb174-432"><a href="rna-seq-mkdata.html#cb174-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(scores) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;PC&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(scores)[<span class="dv">2</span>]))</span>
<span id="cb174-433"><a href="rna-seq-mkdata.html#cb174-433" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-434"><a href="rna-seq-mkdata.html#cb174-434" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create loadings data frams</span></span>
<span id="cb174-435"><a href="rna-seq-mkdata.html#cb174-435" aria-hidden="true" tabindex="-1"></a>  loadings <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(SVD<span class="sc">$</span>v)</span>
<span id="cb174-436"><a href="rna-seq-mkdata.html#cb174-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(loadings) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;PC&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(loadings)[<span class="dv">2</span>]))</span>
<span id="cb174-437"><a href="rna-seq-mkdata.html#cb174-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(loadings) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(x_reduced)</span>
<span id="cb174-438"><a href="rna-seq-mkdata.html#cb174-438" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-439"><a href="rna-seq-mkdata.html#cb174-439" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create data frame for explained variances</span></span>
<span id="cb174-440"><a href="rna-seq-mkdata.html#cb174-440" aria-hidden="true" tabindex="-1"></a>  explained_var <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">round</span>((SVD<span class="sc">$</span>d<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>(SVD<span class="sc">$</span>d<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span><span class="dv">100</span>, <span class="at">digits =</span> <span class="dv">1</span>))</span>
<span id="cb174-441"><a href="rna-seq-mkdata.html#cb174-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(explained_var) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;PC&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(loadings)[<span class="dv">2</span>]))</span>
<span id="cb174-442"><a href="rna-seq-mkdata.html#cb174-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(explained_var) <span class="ot">&lt;-</span> <span class="st">&quot;exp_var&quot;</span></span>
<span id="cb174-443"><a href="rna-seq-mkdata.html#cb174-443" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-444"><a href="rna-seq-mkdata.html#cb174-444" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return result</span></span>
<span id="cb174-445"><a href="rna-seq-mkdata.html#cb174-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">list</span>(<span class="st">&quot;scores&quot;</span> <span class="ot">=</span> scores, <span class="st">&quot;loadings&quot;</span> <span class="ot">=</span> loadings, <span class="st">&quot;explained_var&quot;</span> <span class="ot">=</span> explained_var))</span>
<span id="cb174-446"><a href="rna-seq-mkdata.html#cb174-446" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb174-447"><a href="rna-seq-mkdata.html#cb174-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-448"><a href="rna-seq-mkdata.html#cb174-448" aria-hidden="true" tabindex="-1"></a><span class="co"># transpose the data because in variance_stabilised_counts the rows are the variables and the columns correspond to the samples</span></span>
<span id="cb174-449"><a href="rna-seq-mkdata.html#cb174-449" aria-hidden="true" tabindex="-1"></a>t_variance_stabilised_counts <span class="ot">&lt;-</span> variance_stabilised_counts <span class="co"># this is not doing anything!!!!</span></span>
<span id="cb174-450"><a href="rna-seq-mkdata.html#cb174-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-451"><a href="rna-seq-mkdata.html#cb174-451" aria-hidden="true" tabindex="-1"></a><span class="co"># before computing the PCA, check that samples are in rows and genes in columns</span></span>
<span id="cb174-452"><a href="rna-seq-mkdata.html#cb174-452" aria-hidden="true" tabindex="-1"></a>pca_results <span class="ot">&lt;-</span> <span class="fu">mypca</span>(<span class="fu">t</span>(t_variance_stabilised_counts), <span class="co"># added the transpose t() funtion here!!!.. now it works.!!!</span></span>
<span id="cb174-453"><a href="rna-seq-mkdata.html#cb174-453" aria-hidden="true" tabindex="-1"></a>                     <span class="at">center =</span> <span class="cn">TRUE</span>, </span>
<span id="cb174-454"><a href="rna-seq-mkdata.html#cb174-454" aria-hidden="true" tabindex="-1"></a>                     <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb174-455"><a href="rna-seq-mkdata.html#cb174-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-456"><a href="rna-seq-mkdata.html#cb174-456" aria-hidden="true" tabindex="-1"></a><span class="co"># make the plot</span></span>
<span id="cb174-457"><a href="rna-seq-mkdata.html#cb174-457" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pca_results<span class="sc">$</span>explained_var, </span>
<span id="cb174-458"><a href="rna-seq-mkdata.html#cb174-458" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="fu">nrow</span>(pca_results<span class="sc">$</span>explained_var)), </span>
<span id="cb174-459"><a href="rna-seq-mkdata.html#cb174-459" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> exp_var)) <span class="sc">+</span></span>
<span id="cb174-460"><a href="rna-seq-mkdata.html#cb174-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;explained variance (%)&#39;</span>) <span class="sc">+</span> </span>
<span id="cb174-461"><a href="rna-seq-mkdata.html#cb174-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Explained variance per component&#39;</span>) <span class="sc">+</span> </span>
<span id="cb174-462"><a href="rna-seq-mkdata.html#cb174-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb174-463"><a href="rna-seq-mkdata.html#cb174-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Principal Component number&quot;</span>) <span class="sc">+</span></span>
<span id="cb174-464"><a href="rna-seq-mkdata.html#cb174-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(</span>
<span id="cb174-465"><a href="rna-seq-mkdata.html#cb174-465" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="dv">1</span>, </span>
<span id="cb174-466"><a href="rna-seq-mkdata.html#cb174-466" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">nrow</span>(pca_results<span class="sc">$</span>explained_var)))</span>
<span id="cb174-467"><a href="rna-seq-mkdata.html#cb174-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-468"><a href="rna-seq-mkdata.html#cb174-468" aria-hidden="true" tabindex="-1"></a><span class="co">#  How much percentage of the total variance are “caught” by PC1 and PC2?</span></span>
<span id="cb174-469"><a href="rna-seq-mkdata.html#cb174-469" aria-hidden="true" tabindex="-1"></a><span class="co">#  How many PCs are necessary to get 50% of the total variance?</span></span>
<span id="cb174-470"><a href="rna-seq-mkdata.html#cb174-470" aria-hidden="true" tabindex="-1"></a><span class="co">#  Solution</span></span>
<span id="cb174-471"><a href="rna-seq-mkdata.html#cb174-471" aria-hidden="true" tabindex="-1"></a><span class="fu">cumsum</span>(pca_results<span class="sc">$</span>explained_var)[<span class="dv">2</span>,<span class="dv">1</span>] <span class="co"># shows you that 28.8% of the varaince are explained by PC1 and PC2.</span></span>
<span id="cb174-472"><a href="rna-seq-mkdata.html#cb174-472" aria-hidden="true" tabindex="-1"></a><span class="fu">cumsum</span>(pca_results<span class="sc">$</span>explained_var) <span class="sc">%&gt;%</span> </span>
<span id="cb174-473"><a href="rna-seq-mkdata.html#cb174-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb174-474"><a href="rna-seq-mkdata.html#cb174-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(exp_var <span class="sc">&gt;</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-475"><a href="rna-seq-mkdata.html#cb174-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="co"># You need to go up to PC7 to catch 51% of the variance.</span></span>
<span id="cb174-476"><a href="rna-seq-mkdata.html#cb174-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-477"><a href="rna-seq-mkdata.html#cb174-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-478"><a href="rna-seq-mkdata.html#cb174-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-479"><a href="rna-seq-mkdata.html#cb174-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-480"><a href="rna-seq-mkdata.html#cb174-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-481"><a href="rna-seq-mkdata.html#cb174-481" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> pca_results<span class="sc">$</span>scores</span>
<span id="cb174-482"><a href="rna-seq-mkdata.html#cb174-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-483"><a href="rna-seq-mkdata.html#cb174-483" aria-hidden="true" tabindex="-1"></a><span class="co"># first 5 rows and columns</span></span>
<span id="cb174-484"><a href="rna-seq-mkdata.html#cb174-484" aria-hidden="true" tabindex="-1"></a>scores[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb174-485"><a href="rna-seq-mkdata.html#cb174-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-486"><a href="rna-seq-mkdata.html#cb174-486" aria-hidden="true" tabindex="-1"></a>scores_with_conditions <span class="ot">&lt;-</span> </span>
<span id="cb174-487"><a href="rna-seq-mkdata.html#cb174-487" aria-hidden="true" tabindex="-1"></a>  scores <span class="sc">%&gt;%</span> </span>
<span id="cb174-488"><a href="rna-seq-mkdata.html#cb174-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;SampleName&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># to prepare to join on the &quot;sample&quot; column</span></span>
<span id="cb174-489"><a href="rna-seq-mkdata.html#cb174-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">x =</span> .,                 <span class="co"># this means that we are passing the &#39;scores&#39; dataframe </span></span>
<span id="cb174-490"><a href="rna-seq-mkdata.html#cb174-490" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> Metadata2,         <span class="co"># this dataframe contains the sample to condition correspondence</span></span>
<span id="cb174-491"><a href="rna-seq-mkdata.html#cb174-491" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;SampleName&quot;</span>)</span>
<span id="cb174-492"><a href="rna-seq-mkdata.html#cb174-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-493"><a href="rna-seq-mkdata.html#cb174-493" aria-hidden="true" tabindex="-1"></a><span class="co"># shows the first 5 rows and the last 6 columns. Note that conditions were added to the table.  </span></span>
<span id="cb174-494"><a href="rna-seq-mkdata.html#cb174-494" aria-hidden="true" tabindex="-1"></a>scores_with_conditions[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">15</span><span class="sc">:</span><span class="dv">20</span>]</span>
<span id="cb174-495"><a href="rna-seq-mkdata.html#cb174-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-496"><a href="rna-seq-mkdata.html#cb174-496" aria-hidden="true" tabindex="-1"></a><span class="co"># PC14      PC15          PC16 Genotype Time Tissue</span></span>
<span id="cb174-497"><a href="rna-seq-mkdata.html#cb174-497" aria-hidden="true" tabindex="-1"></a><span class="co"># 1  11.18538  11.34342 -2.053225e-12       WT    7    PDL</span></span>
<span id="cb174-498"><a href="rna-seq-mkdata.html#cb174-498" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 -24.19255  42.96321 -2.053225e-12       WT    7    PDL</span></span>
<span id="cb174-499"><a href="rna-seq-mkdata.html#cb174-499" aria-hidden="true" tabindex="-1"></a><span class="co"># 3  30.91639 -20.58249 -2.053225e-12       WT    7    PDL</span></span>
<span id="cb174-500"><a href="rna-seq-mkdata.html#cb174-500" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 -26.27940 -26.47902 -2.053225e-12       WT    7    PDL</span></span>
<span id="cb174-501"><a href="rna-seq-mkdata.html#cb174-501" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 -67.95911 -14.25815 -2.053225e-12       Ko    7    PDL</span></span>
<span id="cb174-502"><a href="rna-seq-mkdata.html#cb174-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-503"><a href="rna-seq-mkdata.html#cb174-503" aria-hidden="true" tabindex="-1"></a><span class="co"># explained variance</span></span>
<span id="cb174-504"><a href="rna-seq-mkdata.html#cb174-504" aria-hidden="true" tabindex="-1"></a><span class="co"># one % variance value per PC</span></span>
<span id="cb174-505"><a href="rna-seq-mkdata.html#cb174-505" aria-hidden="true" tabindex="-1"></a>explained_variance <span class="ot">&lt;-</span> </span>
<span id="cb174-506"><a href="rna-seq-mkdata.html#cb174-506" aria-hidden="true" tabindex="-1"></a>  pca_results<span class="sc">$</span>explained_var <span class="sc">%&gt;%</span> </span>
<span id="cb174-507"><a href="rna-seq-mkdata.html#cb174-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(<span class="st">&quot;exp_var&quot;</span>)</span>
<span id="cb174-508"><a href="rna-seq-mkdata.html#cb174-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-509"><a href="rna-seq-mkdata.html#cb174-509" aria-hidden="true" tabindex="-1"></a>explained_variance</span>
<span id="cb174-510"><a href="rna-seq-mkdata.html#cb174-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-511"><a href="rna-seq-mkdata.html#cb174-511" aria-hidden="true" tabindex="-1"></a><span class="co"># RNAseq Ploting ------------------</span></span>
<span id="cb174-512"><a href="rna-seq-mkdata.html#cb174-512" aria-hidden="true" tabindex="-1"></a><span class="co"># Genotype Plot</span></span>
<span id="cb174-513"><a href="rna-seq-mkdata.html#cb174-513" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(scores_with_conditions, </span>
<span id="cb174-514"><a href="rna-seq-mkdata.html#cb174-514" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> Genotype)) <span class="sc">+</span></span>
<span id="cb174-515"><a href="rna-seq-mkdata.html#cb174-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb174-516"><a href="rna-seq-mkdata.html#cb174-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> SampleName), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb174-517"><a href="rna-seq-mkdata.html#cb174-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">&quot;PC1: &quot;</span>,explained_variance[<span class="dv">1</span>],<span class="st">&quot;% variance&quot;</span>)) <span class="sc">+</span></span>
<span id="cb174-518"><a href="rna-seq-mkdata.html#cb174-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">&quot;PC2: &quot;</span>,explained_variance[<span class="dv">2</span>],<span class="st">&quot;% variance&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb174-519"><a href="rna-seq-mkdata.html#cb174-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb174-520"><a href="rna-seq-mkdata.html#cb174-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;PCA score plot with the Genotype condition overlaid&quot;</span>)</span>
<span id="cb174-521"><a href="rna-seq-mkdata.html#cb174-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-522"><a href="rna-seq-mkdata.html#cb174-522" aria-hidden="true" tabindex="-1"></a><span class="co"># Time Plot</span></span>
<span id="cb174-523"><a href="rna-seq-mkdata.html#cb174-523" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(scores_with_conditions, </span>
<span id="cb174-524"><a href="rna-seq-mkdata.html#cb174-524" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> Time)) <span class="sc">+</span></span>
<span id="cb174-525"><a href="rna-seq-mkdata.html#cb174-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb174-526"><a href="rna-seq-mkdata.html#cb174-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> ShortName), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb174-527"><a href="rna-seq-mkdata.html#cb174-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">&quot;PC1: &quot;</span>,explained_variance[<span class="dv">1</span>],<span class="st">&quot;% variance&quot;</span>)) <span class="sc">+</span></span>
<span id="cb174-528"><a href="rna-seq-mkdata.html#cb174-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">&quot;PC2: &quot;</span>,explained_variance[<span class="dv">2</span>],<span class="st">&quot;% variance&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb174-529"><a href="rna-seq-mkdata.html#cb174-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb174-530"><a href="rna-seq-mkdata.html#cb174-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;PCA score plot with Time condition overlaid&quot;</span>)</span>
<span id="cb174-531"><a href="rna-seq-mkdata.html#cb174-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-532"><a href="rna-seq-mkdata.html#cb174-532" aria-hidden="true" tabindex="-1"></a><span class="co"># Other Condition...</span></span>
<span id="cb174-533"><a href="rna-seq-mkdata.html#cb174-533" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(scores_with_conditions, </span>
<span id="cb174-534"><a href="rna-seq-mkdata.html#cb174-534" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> dpi)) <span class="sc">+</span></span>
<span id="cb174-535"><a href="rna-seq-mkdata.html#cb174-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb174-536"><a href="rna-seq-mkdata.html#cb174-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> sample), <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb174-537"><a href="rna-seq-mkdata.html#cb174-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste0</span>(<span class="st">&quot;PC1: &quot;</span>,explained_variance[<span class="dv">1</span>],<span class="st">&quot;% variance&quot;</span>)) <span class="sc">+</span></span>
<span id="cb174-538"><a href="rna-seq-mkdata.html#cb174-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste0</span>(<span class="st">&quot;PC2: &quot;</span>,explained_variance[<span class="dv">2</span>],<span class="st">&quot;% variance&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb174-539"><a href="rna-seq-mkdata.html#cb174-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb174-540"><a href="rna-seq-mkdata.html#cb174-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;PCA score plot with the time after infection (dpi) overlaid&quot;</span>)</span>
<span id="cb174-541"><a href="rna-seq-mkdata.html#cb174-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-542"><a href="rna-seq-mkdata.html#cb174-542" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD on not working ------</span></span>
<span id="cb174-543"><a href="rna-seq-mkdata.html#cb174-543" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets look at how to use loading scores to dermine which genes have the largest effect on where samples are plotted in the PCA plot</span></span>
<span id="cb174-544"><a href="rna-seq-mkdata.html#cb174-544" aria-hidden="true" tabindex="-1"></a><span class="co"># Are Lodings and rotation the same?  Seems like yes!!</span></span>
<span id="cb174-545"><a href="rna-seq-mkdata.html#cb174-545" aria-hidden="true" tabindex="-1"></a>loading_scores2 <span class="ot">&lt;-</span> pca_results<span class="sc">$</span>loadings[,<span class="dv">1</span>]</span>
<span id="cb174-546"><a href="rna-seq-mkdata.html#cb174-546" aria-hidden="true" tabindex="-1"></a>gene_scores2 <span class="ot">&lt;-</span> <span class="fu">abs</span>(loading_scores2)</span>
<span id="cb174-547"><a href="rna-seq-mkdata.html#cb174-547" aria-hidden="true" tabindex="-1"></a>gene_scores_ranked2 <span class="ot">&lt;-</span>  <span class="fu">sort</span>(gene_scores2, <span class="at">decreasing =</span> T)</span>
<span id="cb174-548"><a href="rna-seq-mkdata.html#cb174-548" aria-hidden="true" tabindex="-1"></a>top10_genes2 <span class="ot">&lt;-</span> <span class="fu">row.names</span>(gene_scores_ranked2[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb174-549"><a href="rna-seq-mkdata.html#cb174-549" aria-hidden="true" tabindex="-1"></a>top10_genes2</span>
<span id="cb174-550"><a href="rna-seq-mkdata.html#cb174-550" aria-hidden="true" tabindex="-1"></a>pca<span class="sc">$</span>rotation[top10_genes,<span class="dv">1</span>] <span class="co"># show the scores (and +/-)</span></span>
<span id="cb174-551"><a href="rna-seq-mkdata.html#cb174-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-552"><a href="rna-seq-mkdata.html#cb174-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-553"><a href="rna-seq-mkdata.html#cb174-553" aria-hidden="true" tabindex="-1"></a><span class="co"># DESeq2 count normalization ----</span></span>
<span id="cb174-554"><a href="rna-seq-mkdata.html#cb174-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Let’s see how, in practice, we can use DESeq2 median-of-ratios method to normalize the gene counts.</span></span>
<span id="cb174-555"><a href="rna-seq-mkdata.html#cb174-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-556"><a href="rna-seq-mkdata.html#cb174-556" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Import and  matching to the experimantal design and counts data same as above. </span></span>
<span id="cb174-557"><a href="rna-seq-mkdata.html#cb174-557" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counts[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb174-558"><a href="rna-seq-mkdata.html#cb174-558" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the DESeqDataSet object</span></span>
<span id="cb174-559"><a href="rna-seq-mkdata.html#cb174-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-560"><a href="rna-seq-mkdata.html#cb174-560" aria-hidden="true" tabindex="-1"></a><span class="co"># suppressPackageStartupMessages(library(DESeq2)) # to load DESeq2 and suppress the long startup message</span></span>
<span id="cb174-561"><a href="rna-seq-mkdata.html#cb174-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-562"><a href="rna-seq-mkdata.html#cb174-562" aria-hidden="true" tabindex="-1"></a><span class="co"># Creation of the DESeqDataSet object</span></span>
<span id="cb174-563"><a href="rna-seq-mkdata.html#cb174-563" aria-hidden="true" tabindex="-1"></a>dds2 <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> all_raw_count02, </span>
<span id="cb174-564"><a href="rna-seq-mkdata.html#cb174-564" aria-hidden="true" tabindex="-1"></a>                               <span class="at">colData =</span> Metadata2, </span>
<span id="cb174-565"><a href="rna-seq-mkdata.html#cb174-565" aria-hidden="true" tabindex="-1"></a>                               <span class="at">design =</span> <span class="sc">~</span> Genotype) </span>
<span id="cb174-566"><a href="rna-seq-mkdata.html#cb174-566" aria-hidden="true" tabindex="-1"></a>dds2</span>
<span id="cb174-567"><a href="rna-seq-mkdata.html#cb174-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-568"><a href="rna-seq-mkdata.html#cb174-568" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate normalized counts</span></span>
<span id="cb174-569"><a href="rna-seq-mkdata.html#cb174-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-570"><a href="rna-seq-mkdata.html#cb174-570" aria-hidden="true" tabindex="-1"></a>dds2 <span class="ot">&lt;-</span> <span class="fu">estimateSizeFactors</span>(dds2)</span>
<span id="cb174-571"><a href="rna-seq-mkdata.html#cb174-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-572"><a href="rna-seq-mkdata.html#cb174-572" aria-hidden="true" tabindex="-1"></a><span class="fu">sizeFactors</span>(dds2)</span>
<span id="cb174-573"><a href="rna-seq-mkdata.html#cb174-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-574"><a href="rna-seq-mkdata.html#cb174-574" aria-hidden="true" tabindex="-1"></a><span class="co"># We can plot these size factors to see how much they differ between samples.</span></span>
<span id="cb174-575"><a href="rna-seq-mkdata.html#cb174-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-576"><a href="rna-seq-mkdata.html#cb174-576" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb174-577"><a href="rna-seq-mkdata.html#cb174-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-578"><a href="rna-seq-mkdata.html#cb174-578" aria-hidden="true" tabindex="-1"></a><span class="co"># create a dplyr tibble</span></span>
<span id="cb174-579"><a href="rna-seq-mkdata.html#cb174-579" aria-hidden="true" tabindex="-1"></a>size_factors_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb174-580"><a href="rna-seq-mkdata.html#cb174-580" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample =</span> <span class="fu">names</span>(<span class="fu">sizeFactors</span>(dds2)), </span>
<span id="cb174-581"><a href="rna-seq-mkdata.html#cb174-581" aria-hidden="true" tabindex="-1"></a>  <span class="at">correction_factor =</span> <span class="fu">sizeFactors</span>(dds2)</span>
<span id="cb174-582"><a href="rna-seq-mkdata.html#cb174-582" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb174-583"><a href="rna-seq-mkdata.html#cb174-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-584"><a href="rna-seq-mkdata.html#cb174-584" aria-hidden="true" tabindex="-1"></a><span class="co"># line plot to connect the different size factor values</span></span>
<span id="cb174-585"><a href="rna-seq-mkdata.html#cb174-585" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(size_factors_df, <span class="fu">aes</span>(<span class="at">x =</span> sample, <span class="at">y =</span> correction_factor, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb174-586"><a href="rna-seq-mkdata.html#cb174-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb174-587"><a href="rna-seq-mkdata.html#cb174-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb174-588"><a href="rna-seq-mkdata.html#cb174-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">size =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb174-589"><a href="rna-seq-mkdata.html#cb174-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb174-590"><a href="rna-seq-mkdata.html#cb174-590" aria-hidden="true" tabindex="-1"></a> <span class="co"># xlab(paste(&quot;PC1 - &quot;, pca.var.per[1], &quot;%&quot;, sep = &quot;&quot;)) +</span></span>
<span id="cb174-591"><a href="rna-seq-mkdata.html#cb174-591" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ylab(paste(&quot;PC2 - &quot;, pca.var.per[2], &quot;%&quot;, sep = &quot;&quot;)) +</span></span>
<span id="cb174-592"><a href="rna-seq-mkdata.html#cb174-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Median of ratios method of normalization (size factors) to see how much samples differ between eachother &quot;</span>)</span>
<span id="cb174-593"><a href="rna-seq-mkdata.html#cb174-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-594"><a href="rna-seq-mkdata.html#cb174-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-595"><a href="rna-seq-mkdata.html#cb174-595" aria-hidden="true" tabindex="-1"></a><span class="co"># to display the plot</span></span>
<span id="cb174-596"><a href="rna-seq-mkdata.html#cb174-596" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb174-597"><a href="rna-seq-mkdata.html#cb174-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-598"><a href="rna-seq-mkdata.html#cb174-598" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the normalised counts</span></span>
<span id="cb174-599"><a href="rna-seq-mkdata.html#cb174-599" aria-hidden="true" tabindex="-1"></a>counts_normalised <span class="ot">=</span> <span class="fu">counts</span>(dds2, <span class="at">normalized =</span> <span class="cn">TRUE</span>)</span>
<span id="cb174-600"><a href="rna-seq-mkdata.html#cb174-600" aria-hidden="true" tabindex="-1"></a>counts_normalised[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb174-601"><a href="rna-seq-mkdata.html#cb174-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-602"><a href="rna-seq-mkdata.html#cb174-602" aria-hidden="true" tabindex="-1"></a>counts_log10 <span class="ot">&lt;-</span> <span class="fu">log10</span>(counts<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb174-603"><a href="rna-seq-mkdata.html#cb174-603" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(counts_log10, <span class="at">las=</span><span class="dv">2</span>, <span class="at">main=</span><span class="st">&quot;Log10 of counts&quot;</span>)</span>
<span id="cb174-604"><a href="rna-seq-mkdata.html#cb174-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-605"><a href="rna-seq-mkdata.html#cb174-605" aria-hidden="true" tabindex="-1"></a>counts_normalised_log10 <span class="ot">&lt;-</span> <span class="fu">log10</span>(counts_normalised<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb174-606"><a href="rna-seq-mkdata.html#cb174-606" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(counts_normalised_log10, <span class="at">las=</span><span class="dv">2</span>, <span class="at">col=</span> <span class="st">&quot;green&quot;</span>, <span class="at">main=</span><span class="st">&quot;Normalize log10 counts&quot;</span>)</span>
<span id="cb174-607"><a href="rna-seq-mkdata.html#cb174-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-608"><a href="rna-seq-mkdata.html#cb174-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-609"><a href="rna-seq-mkdata.html#cb174-609" aria-hidden="true" tabindex="-1"></a><span class="co"># Differential expression analysis -----------------------</span></span>
<span id="cb174-610"><a href="rna-seq-mkdata.html#cb174-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-611"><a href="rna-seq-mkdata.html#cb174-611" aria-hidden="true" tabindex="-1"></a><span class="co"># Warning *************************************</span></span>
<span id="cb174-612"><a href="rna-seq-mkdata.html#cb174-612" aria-hidden="true" tabindex="-1"></a><span class="co"># We do not want to work on all comparisons, we will filter out the samples and conditions that we do not need. In this example, only the mock growth and the P. syringae infected condition will remain.</span></span>
<span id="cb174-613"><a href="rna-seq-mkdata.html#cb174-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-614"><a href="rna-seq-mkdata.html#cb174-614" aria-hidden="true" tabindex="-1"></a><span class="co"># You should still have the counts and xp_design objects in your R environment. If not, please run the following code.</span></span>
<span id="cb174-615"><a href="rna-seq-mkdata.html#cb174-615" aria-hidden="true" tabindex="-1"></a><span class="co"># read the xp design file if not available in your environment </span></span>
<span id="cb174-616"><a href="rna-seq-mkdata.html#cb174-616" aria-hidden="true" tabindex="-1"></a><span class="co"># Metadata2 &lt;- read.delim(&quot;experimental_design_modified.txt&quot;, </span></span>
<span id="cb174-617"><a href="rna-seq-mkdata.html#cb174-617" aria-hidden="true" tabindex="-1"></a><span class="co">#                         header = T, </span></span>
<span id="cb174-618"><a href="rna-seq-mkdata.html#cb174-618" aria-hidden="true" tabindex="-1"></a><span class="co">#                         stringsAsFactors = F, </span></span>
<span id="cb174-619"><a href="rna-seq-mkdata.html#cb174-619" aria-hidden="true" tabindex="-1"></a><span class="co">#                         colClasses = rep(&quot;character&quot;,4))</span></span>
<span id="cb174-620"><a href="rna-seq-mkdata.html#cb174-620" aria-hidden="true" tabindex="-1"></a><span class="co"># # change col names</span></span>
<span id="cb174-621"><a href="rna-seq-mkdata.html#cb174-621" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(Metadata2) &lt;- c(&quot;sample&quot;, &quot;seed&quot;, &quot;infected&quot;, &quot;dpi&quot;)</span></span>
<span id="cb174-622"><a href="rna-seq-mkdata.html#cb174-622" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb174-623"><a href="rna-seq-mkdata.html#cb174-623" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb174-624"><a href="rna-seq-mkdata.html#cb174-624" aria-hidden="true" tabindex="-1"></a><span class="co"># counts &lt;- read.delim(&quot;counts.txt&quot;, header = T, stringsAsFactors = F)</span></span>
<span id="cb174-625"><a href="rna-seq-mkdata.html#cb174-625" aria-hidden="true" tabindex="-1"></a><span class="co"># genes &lt;- counts[,1]</span></span>
<span id="cb174-626"><a href="rna-seq-mkdata.html#cb174-626" aria-hidden="true" tabindex="-1"></a><span class="co"># counts &lt;- counts[,-1]</span></span>
<span id="cb174-627"><a href="rna-seq-mkdata.html#cb174-627" aria-hidden="true" tabindex="-1"></a><span class="co"># row.names(counts) &lt;- genes</span></span>
<span id="cb174-628"><a href="rna-seq-mkdata.html#cb174-628" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb174-629"><a href="rna-seq-mkdata.html#cb174-629" aria-hidden="true" tabindex="-1"></a><span class="co"># # reorder counts columns according to the experimental design file</span></span>
<span id="cb174-630"><a href="rna-seq-mkdata.html#cb174-630" aria-hidden="true" tabindex="-1"></a><span class="co"># counts &lt;- counts[, xp_design$sample]</span></span>
<span id="cb174-631"><a href="rna-seq-mkdata.html#cb174-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-632"><a href="rna-seq-mkdata.html#cb174-632" aria-hidden="true" tabindex="-1"></a><span class="co">#******************************************************************************</span></span>
<span id="cb174-633"><a href="rna-seq-mkdata.html#cb174-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-634"><a href="rna-seq-mkdata.html#cb174-634" aria-hidden="true" tabindex="-1"></a><span class="co"># We will now filter both the counts and xp_design objects to keep a one-factor comparison to investigate....?</span></span>
<span id="cb174-635"><a href="rna-seq-mkdata.html#cb174-635" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DESeq2)</span>
<span id="cb174-636"><a href="rna-seq-mkdata.html#cb174-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-637"><a href="rna-seq-mkdata.html#cb174-637" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Metadata2)</span>
<span id="cb174-638"><a href="rna-seq-mkdata.html#cb174-638" aria-hidden="true" tabindex="-1"></a>Metadata2<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Metadata2<span class="sc">$</span>Time)</span>
<span id="cb174-639"><a href="rna-seq-mkdata.html#cb174-639" aria-hidden="true" tabindex="-1"></a>Metadata2<span class="sc">$</span>Genotype <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Metadata2<span class="sc">$</span>Genotype)</span>
<span id="cb174-640"><a href="rna-seq-mkdata.html#cb174-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-641"><a href="rna-seq-mkdata.html#cb174-641" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Metadata2)</span>
<span id="cb174-642"><a href="rna-seq-mkdata.html#cb174-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-643"><a href="rna-seq-mkdata.html#cb174-643" aria-hidden="true" tabindex="-1"></a><span class="co"># filter design file (mock versus P. syringae at 7 dpi)</span></span>
<span id="cb174-644"><a href="rna-seq-mkdata.html#cb174-644" aria-hidden="true" tabindex="-1"></a>var_GenetypeKo_vs_Time14 <span class="ot">=</span> Metadata2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Time <span class="sc">==</span> <span class="st">&quot;14&quot;</span>) <span class="co"># (Genotype == &quot;Ko&quot; &amp; Time == &quot;14&quot;)</span></span>
<span id="cb174-645"><a href="rna-seq-mkdata.html#cb174-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-646"><a href="rna-seq-mkdata.html#cb174-646" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter count file accordingly (to keep only samples present in the filtered xp_design file)</span></span>
<span id="cb174-647"><a href="rna-seq-mkdata.html#cb174-647" aria-hidden="true" tabindex="-1"></a>counts_filtered <span class="ot">=</span> counts[, <span class="fu">colnames</span>(counts) <span class="sc">%in%</span> var_GenetypeKo_vs_Time14<span class="sc">$</span>SampleName]</span>
<span id="cb174-648"><a href="rna-seq-mkdata.html#cb174-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-649"><a href="rna-seq-mkdata.html#cb174-649" aria-hidden="true" tabindex="-1"></a><span class="do">## Creation of the DESeqDataSet</span></span>
<span id="cb174-650"><a href="rna-seq-mkdata.html#cb174-650" aria-hidden="true" tabindex="-1"></a>dds3 <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> counts_filtered, </span>
<span id="cb174-651"><a href="rna-seq-mkdata.html#cb174-651" aria-hidden="true" tabindex="-1"></a>                               <span class="at">colData =</span> var_GenetypeKo_vs_Time14, </span>
<span id="cb174-652"><a href="rna-seq-mkdata.html#cb174-652" aria-hidden="true" tabindex="-1"></a>                               <span class="at">design =</span> <span class="sc">~</span> Genotype)</span>
<span id="cb174-653"><a href="rna-seq-mkdata.html#cb174-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-654"><a href="rna-seq-mkdata.html#cb174-654" aria-hidden="true" tabindex="-1"></a><span class="co"># It is important to make sure that levels are properly ordered so we are indeed using the mock group as our reference level. A positive gene fold change will for instance signify that the gene is upregulated in the P. syringae condition relatively to the mock condition.</span></span>
<span id="cb174-655"><a href="rna-seq-mkdata.html#cb174-655" aria-hidden="true" tabindex="-1"></a><span class="co">#One way to see how levels are interpreted within the DESeqDataSet object is to display the factor levels.</span></span>
<span id="cb174-656"><a href="rna-seq-mkdata.html#cb174-656" aria-hidden="true" tabindex="-1"></a>dds3<span class="sc">$</span>Genotype</span>
<span id="cb174-657"><a href="rna-seq-mkdata.html#cb174-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-658"><a href="rna-seq-mkdata.html#cb174-658" aria-hidden="true" tabindex="-1"></a>dds3 <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds3)</span>
<span id="cb174-659"><a href="rna-seq-mkdata.html#cb174-659" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">results</span>(dds3)</span>
<span id="cb174-660"><a href="rna-seq-mkdata.html#cb174-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-661"><a href="rna-seq-mkdata.html#cb174-661" aria-hidden="true" tabindex="-1"></a><span class="co"># have a peek at the DESeqResults object </span></span>
<span id="cb174-662"><a href="rna-seq-mkdata.html#cb174-662" aria-hidden="true" tabindex="-1"></a>res</span>
<span id="cb174-663"><a href="rna-seq-mkdata.html#cb174-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-664"><a href="rna-seq-mkdata.html#cb174-664" aria-hidden="true" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> <span class="fu">results</span>(dds3, <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">&quot;Genotype&quot;</span>,                      <span class="co"># name of the factor</span></span>
<span id="cb174-665"><a href="rna-seq-mkdata.html#cb174-665" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;Ko&quot;</span>,    <span class="co"># name of the numerator level for fold change</span></span>
<span id="cb174-666"><a href="rna-seq-mkdata.html#cb174-666" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;WT&quot;</span>))                          <span class="co"># name of the denominator level    </span></span>
<span id="cb174-667"><a href="rna-seq-mkdata.html#cb174-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-668"><a href="rna-seq-mkdata.html#cb174-668" aria-hidden="true" tabindex="-1"></a><span class="fu">all_equal</span>(res, res2)</span>
<span id="cb174-669"><a href="rna-seq-mkdata.html#cb174-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-670"><a href="rna-seq-mkdata.html#cb174-670" aria-hidden="true" tabindex="-1"></a><span class="fu">mcols</span>(res)</span>
<span id="cb174-671"><a href="rna-seq-mkdata.html#cb174-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-672"><a href="rna-seq-mkdata.html#cb174-672" aria-hidden="true" tabindex="-1"></a><span class="co"># False discovery rates FDR / Benjamini-Hocheberg method ----------</span></span>
<span id="cb174-673"><a href="rna-seq-mkdata.html#cb174-673" aria-hidden="true" tabindex="-1"></a><span class="co"># Explanation of this method here: https://youtu.be/K8LQSvtjcEo </span></span>
<span id="cb174-674"><a href="rna-seq-mkdata.html#cb174-674" aria-hidden="true" tabindex="-1"></a><span class="co"># We can count the number of genes that are differentially regulated at a certain \(\alpha\) level.</span></span>
<span id="cb174-675"><a href="rna-seq-mkdata.html#cb174-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-676"><a href="rna-seq-mkdata.html#cb174-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-677"><a href="rna-seq-mkdata.html#cb174-677" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb174-678"><a href="rna-seq-mkdata.html#cb174-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-679"><a href="rna-seq-mkdata.html#cb174-679" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold of p = 0.01</span></span>
<span id="cb174-680"><a href="rna-seq-mkdata.html#cb174-680" aria-hidden="true" tabindex="-1"></a>res <span class="sc">%&gt;%</span> </span>
<span id="cb174-681"><a href="rna-seq-mkdata.html#cb174-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb174-682"><a href="rna-seq-mkdata.html#cb174-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(padj <span class="sc">&lt;</span> <span class="fl">0.01</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-683"><a href="rna-seq-mkdata.html#cb174-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>()</span>
<span id="cb174-684"><a href="rna-seq-mkdata.html#cb174-684" aria-hidden="true" tabindex="-1"></a><span class="co"># 2347 genes out of 6 samples</span></span>
<span id="cb174-685"><a href="rna-seq-mkdata.html#cb174-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-686"><a href="rna-seq-mkdata.html#cb174-686" aria-hidden="true" tabindex="-1"></a><span class="dv">2347</span><span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fu">nrow</span>(counts)   <span class="co"># 6.977643 or around ~7%</span></span>
<span id="cb174-687"><a href="rna-seq-mkdata.html#cb174-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-688"><a href="rna-seq-mkdata.html#cb174-688" aria-hidden="true" tabindex="-1"></a><span class="co"># threshold of p = 0.001</span></span>
<span id="cb174-689"><a href="rna-seq-mkdata.html#cb174-689" aria-hidden="true" tabindex="-1"></a>FDR<span class="fl">.001</span> <span class="ot">&lt;-</span> res <span class="sc">%&gt;%</span> </span>
<span id="cb174-690"><a href="rna-seq-mkdata.html#cb174-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb174-691"><a href="rna-seq-mkdata.html#cb174-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(padj <span class="sc">&lt;</span> <span class="fl">0.001</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-692"><a href="rna-seq-mkdata.html#cb174-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>()</span>
<span id="cb174-693"><a href="rna-seq-mkdata.html#cb174-693" aria-hidden="true" tabindex="-1"></a>FDR<span class="fl">.001</span></span>
<span id="cb174-694"><a href="rna-seq-mkdata.html#cb174-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-695"><a href="rna-seq-mkdata.html#cb174-695" aria-hidden="true" tabindex="-1"></a>FDR<span class="fl">.001</span><span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fu">nrow</span>(counts)   <span class="co"># 4.83410631 or around ~5%</span></span>
<span id="cb174-696"><a href="rna-seq-mkdata.html#cb174-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-697"><a href="rna-seq-mkdata.html#cb174-697" aria-hidden="true" tabindex="-1"></a><span class="co">#　You should obtain 2347 differentially expressed genes at 1% and 1626 at 0.1% which are quite important numbers: indeed, it corresponds to respectively ~7% and ~5% of the whole number transcriptome (nrow(counts)　=　total number of mRNA is 33636).</span></span>
<span id="cb174-698"><a href="rna-seq-mkdata.html#cb174-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-699"><a href="rna-seq-mkdata.html#cb174-699" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution of adjusted p-values</span></span>
<span id="cb174-700"><a href="rna-seq-mkdata.html#cb174-700" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(res<span class="sc">$</span>padj, <span class="at">col=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Adjusted p-value distribution&quot;</span>)</span>
<span id="cb174-701"><a href="rna-seq-mkdata.html#cb174-701" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution of non-adjusted p-values</span></span>
<span id="cb174-702"><a href="rna-seq-mkdata.html#cb174-702" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(res<span class="sc">$</span>pvalue, <span class="at">col=</span><span class="st">&quot;grey&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Non-adjusted p-value distribution&quot;</span>)</span>
<span id="cb174-703"><a href="rna-seq-mkdata.html#cb174-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-704"><a href="rna-seq-mkdata.html#cb174-704" aria-hidden="true" tabindex="-1"></a><span class="co"># As you can see, the distribution of p-values was already quite similar suggesting that a good proportion of the tests have a significant p-value (inferior to \(\alpha\) = 0.01 for instance). This suggests that a good proportion of these will be true positives (genes truly differentially regulated).</span></span>
<span id="cb174-705"><a href="rna-seq-mkdata.html#cb174-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-706"><a href="rna-seq-mkdata.html#cb174-706" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting the table of differential genes ------------</span></span>
<span id="cb174-707"><a href="rna-seq-mkdata.html#cb174-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-708"><a href="rna-seq-mkdata.html#cb174-708" aria-hidden="true" tabindex="-1"></a>diff <span class="ot">=</span> res <span class="sc">%&gt;%</span> </span>
<span id="cb174-709"><a href="rna-seq-mkdata.html#cb174-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb174-710"><a href="rna-seq-mkdata.html#cb174-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;genes&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-711"><a href="rna-seq-mkdata.html#cb174-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(padj <span class="sc">&lt;</span> <span class="fl">0.01</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-712"><a href="rna-seq-mkdata.html#cb174-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(log2FoldChange), </span>
<span id="cb174-713"><a href="rna-seq-mkdata.html#cb174-713" aria-hidden="true" tabindex="-1"></a>          <span class="fu">desc</span>(padj))</span>
<span id="cb174-714"><a href="rna-seq-mkdata.html#cb174-714" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(diff)</span>
<span id="cb174-715"><a href="rna-seq-mkdata.html#cb174-715" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(diff)</span>
<span id="cb174-716"><a href="rna-seq-mkdata.html#cb174-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-717"><a href="rna-seq-mkdata.html#cb174-717" aria-hidden="true" tabindex="-1"></a><span class="co"># Save differential genes table in a file. --------</span></span>
<span id="cb174-718"><a href="rna-seq-mkdata.html#cb174-718" aria-hidden="true" tabindex="-1"></a><span class="co"># # .csv file. </span></span>
<span id="cb174-719"><a href="rna-seq-mkdata.html#cb174-719" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(diff, file =  &quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/diff.csv&quot;, sep = &quot;,&quot;, row.names = F)</span></span>
<span id="cb174-720"><a href="rna-seq-mkdata.html#cb174-720" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb174-721"><a href="rna-seq-mkdata.html#cb174-721" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb174-722"><a href="rna-seq-mkdata.html#cb174-722" aria-hidden="true" tabindex="-1"></a><span class="co"># #Excel file. Source: http://www.sthda.com/english/wiki/writing-data-from-r-to-excel-files-xls-xlsx</span></span>
<span id="cb174-723"><a href="rna-seq-mkdata.html#cb174-723" aria-hidden="true" tabindex="-1"></a><span class="co"># library(&quot;xlsx&quot;)</span></span>
<span id="cb174-724"><a href="rna-seq-mkdata.html#cb174-724" aria-hidden="true" tabindex="-1"></a><span class="co"># # Write the first data set in a new workbook</span></span>
<span id="cb174-725"><a href="rna-seq-mkdata.html#cb174-725" aria-hidden="true" tabindex="-1"></a><span class="co"># write.xlsx(diff, file = &quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/diff.xlsx&quot;,</span></span>
<span id="cb174-726"><a href="rna-seq-mkdata.html#cb174-726" aria-hidden="true" tabindex="-1"></a><span class="co">#            sheetName = &quot;diff1&quot;, row.names = F, append = FALSE)</span></span>
<span id="cb174-727"><a href="rna-seq-mkdata.html#cb174-727" aria-hidden="true" tabindex="-1"></a><span class="co"># # Add a second data set in a new worksheet</span></span>
<span id="cb174-728"><a href="rna-seq-mkdata.html#cb174-728" aria-hidden="true" tabindex="-1"></a><span class="co"># write.xlsx(diff2, file = &quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Top10DEgenes_prcomp.xlsx&quot;,</span></span>
<span id="cb174-729"><a href="rna-seq-mkdata.html#cb174-729" aria-hidden="true" tabindex="-1"></a><span class="co">#            sheetName = &quot;diff2&quot;, row.names = F, append = TRUE) # to add as a new sheet.</span></span>
<span id="cb174-730"><a href="rna-seq-mkdata.html#cb174-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-731"><a href="rna-seq-mkdata.html#cb174-731" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a third data set..... I AM ADDING THIS SHEET TO AN EXISTING FILE FROM THE PREVIOUS PCA ANALISYS.</span></span>
<span id="cb174-732"><a href="rna-seq-mkdata.html#cb174-732" aria-hidden="true" tabindex="-1"></a><span class="fu">write.xlsx</span>(diff, <span class="at">file =</span> <span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Top10DEgenes_prcomp.xlsx&quot;</span>,</span>
<span id="cb174-733"><a href="rna-seq-mkdata.html#cb174-733" aria-hidden="true" tabindex="-1"></a>           <span class="at">sheetName =</span> <span class="st">&quot;diff1&quot;</span>, <span class="at">row.names =</span> F, <span class="at">append =</span> <span class="cn">TRUE</span>) <span class="co"># to add as a new sheet.</span></span>
<span id="cb174-734"><a href="rna-seq-mkdata.html#cb174-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-735"><a href="rna-seq-mkdata.html#cb174-735" aria-hidden="true" tabindex="-1"></a><span class="co"># # Physically opening an excel file within R (maybe Windows only)</span></span>
<span id="cb174-736"><a href="rna-seq-mkdata.html#cb174-736" aria-hidden="true" tabindex="-1"></a><span class="co"># Top10DEgenes_prcomp.xlsx_path &lt;- &quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Top10DEgenes_prcomp.xlsx&quot;</span></span>
<span id="cb174-737"><a href="rna-seq-mkdata.html#cb174-737" aria-hidden="true" tabindex="-1"></a><span class="co"># command &lt;- paste(&quot;open excel&quot;, Top10DEgenes_prcomp.xlsx_path)</span></span>
<span id="cb174-738"><a href="rna-seq-mkdata.html#cb174-738" aria-hidden="true" tabindex="-1"></a><span class="co"># system(command)</span></span>
<span id="cb174-739"><a href="rna-seq-mkdata.html#cb174-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-740"><a href="rna-seq-mkdata.html#cb174-740" aria-hidden="true" tabindex="-1"></a><span class="co"># # install.packages(&quot;writexl&quot;)</span></span>
<span id="cb174-741"><a href="rna-seq-mkdata.html#cb174-741" aria-hidden="true" tabindex="-1"></a><span class="co"># library(&quot;writexl&quot;)</span></span>
<span id="cb174-742"><a href="rna-seq-mkdata.html#cb174-742" aria-hidden="true" tabindex="-1"></a><span class="co"># write_xlsx(TopDEgenes_prcomp, &quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/all_raw_count01.xlsx&quot;, sheet= top10_genes)</span></span>
<span id="cb174-743"><a href="rna-seq-mkdata.html#cb174-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-744"><a href="rna-seq-mkdata.html#cb174-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-745"><a href="rna-seq-mkdata.html#cb174-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-746"><a href="rna-seq-mkdata.html#cb174-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-747"><a href="rna-seq-mkdata.html#cb174-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-748"><a href="rna-seq-mkdata.html#cb174-748" aria-hidden="true" tabindex="-1"></a><span class="co"># Volcano plot -----------</span></span>
<span id="cb174-749"><a href="rna-seq-mkdata.html#cb174-749" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we are going to “shrink” the \(\log2\) fold changes to remove the noise associated with fold changes coming from genes with low count levels. Shrinkage of effect size (LFC estimates) is useful for visualization and ranking of genes. This helps to get more meaningful log2 fold changes for all genes independently of their expression level.</span></span>
<span id="cb174-750"><a href="rna-seq-mkdata.html#cb174-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-751"><a href="rna-seq-mkdata.html#cb174-751" aria-hidden="true" tabindex="-1"></a>resLFC <span class="ot">&lt;-</span> <span class="fu">lfcShrink</span>(<span class="at">dds =</span> dds3, </span>
<span id="cb174-752"><a href="rna-seq-mkdata.html#cb174-752" aria-hidden="true" tabindex="-1"></a>                    <span class="at">res =</span> res,</span>
<span id="cb174-753"><a href="rna-seq-mkdata.html#cb174-753" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;normal&quot;</span>,</span>
<span id="cb174-754"><a href="rna-seq-mkdata.html#cb174-754" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coef =</span> <span class="dv">2</span>) <span class="co"># corresponds to &quot;WT vs Ko&quot; comparison</span></span>
<span id="cb174-755"><a href="rna-seq-mkdata.html#cb174-755" aria-hidden="true" tabindex="-1"></a>resLFC</span>
<span id="cb174-756"><a href="rna-seq-mkdata.html#cb174-756" aria-hidden="true" tabindex="-1"></a><span class="co"># EnhancedVolcano Installation</span></span>
<span id="cb174-757"><a href="rna-seq-mkdata.html#cb174-757" aria-hidden="true" tabindex="-1"></a><span class="co"># if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE))</span></span>
<span id="cb174-758"><a href="rna-seq-mkdata.html#cb174-758" aria-hidden="true" tabindex="-1"></a><span class="co">#  install.packages(&quot;BiocManager&quot;)</span></span>
<span id="cb174-759"><a href="rna-seq-mkdata.html#cb174-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-760"><a href="rna-seq-mkdata.html#cb174-760" aria-hidden="true" tabindex="-1"></a><span class="co">#BiocManager::install(&quot;EnhancedVolcano&quot;)</span></span>
<span id="cb174-761"><a href="rna-seq-mkdata.html#cb174-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-762"><a href="rna-seq-mkdata.html#cb174-762" aria-hidden="true" tabindex="-1"></a><span class="co"># load the library if not done yet</span></span>
<span id="cb174-763"><a href="rna-seq-mkdata.html#cb174-763" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;EnhancedVolcano&quot;</span>)</span>
<span id="cb174-764"><a href="rna-seq-mkdata.html#cb174-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-765"><a href="rna-seq-mkdata.html#cb174-765" aria-hidden="true" tabindex="-1"></a><span class="co"># The main function is named after the package</span></span>
<span id="cb174-766"><a href="rna-seq-mkdata.html#cb174-766" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(<span class="at">toptable =</span> resLFC,              <span class="co"># We use the shrunken log2 fold change as noise associated with low count genes is removed </span></span>
<span id="cb174-767"><a href="rna-seq-mkdata.html#cb174-767" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">&quot;log2FoldChange&quot;</span>,           <span class="co"># Name of the column in resLFC that contains the log2 fold changes</span></span>
<span id="cb174-768"><a href="rna-seq-mkdata.html#cb174-768" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> <span class="st">&quot;padj&quot;</span>,                     <span class="co"># Name of the column in resLFC that contains the p-value</span></span>
<span id="cb174-769"><a href="rna-seq-mkdata.html#cb174-769" aria-hidden="true" tabindex="-1"></a>                <span class="at">lab =</span> <span class="fu">rownames</span>(resLFC)</span>
<span id="cb174-770"><a href="rna-seq-mkdata.html#cb174-770" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb174-771"><a href="rna-seq-mkdata.html#cb174-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-772"><a href="rna-seq-mkdata.html#cb174-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-773"><a href="rna-seq-mkdata.html#cb174-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-774"><a href="rna-seq-mkdata.html#cb174-774" aria-hidden="true" tabindex="-1"></a><span class="fu">EnhancedVolcano</span>(<span class="at">toptable =</span> resLFC,</span>
<span id="cb174-775"><a href="rna-seq-mkdata.html#cb174-775" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="st">&quot;log2FoldChange&quot;</span>,</span>
<span id="cb174-776"><a href="rna-seq-mkdata.html#cb174-776" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> <span class="st">&quot;padj&quot;</span>,</span>
<span id="cb174-777"><a href="rna-seq-mkdata.html#cb174-777" aria-hidden="true" tabindex="-1"></a>                <span class="at">lab =</span> <span class="fu">rownames</span>(resLFC),</span>
<span id="cb174-778"><a href="rna-seq-mkdata.html#cb174-778" aria-hidden="true" tabindex="-1"></a>                <span class="at">labSize =</span> <span class="dv">3</span>,</span>
<span id="cb174-779"><a href="rna-seq-mkdata.html#cb174-779" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="sc">+</span><span class="dv">10</span>),</span>
<span id="cb174-780"><a href="rna-seq-mkdata.html#cb174-780" aria-hidden="true" tabindex="-1"></a>                <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb174-781"><a href="rna-seq-mkdata.html#cb174-781" aria-hidden="true" tabindex="-1"></a>                <span class="at">pCutoff =</span> <span class="fl">1e-06</span>,</span>
<span id="cb174-782"><a href="rna-seq-mkdata.html#cb174-782" aria-hidden="true" tabindex="-1"></a>                <span class="at">pointSize =</span> <span class="fl">2.0</span>,</span>
<span id="cb174-783"><a href="rna-seq-mkdata.html#cb174-783" aria-hidden="true" tabindex="-1"></a>                <span class="at">FCcutoff =</span> <span class="dv">2</span>, </span>
<span id="cb174-784"><a href="rna-seq-mkdata.html#cb174-784" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;WT vs Ko comparison (fold change cutoff = 2, p-value cutoff = 1e-06)&quot;</span>,</span>
<span id="cb174-785"><a href="rna-seq-mkdata.html#cb174-785" aria-hidden="true" tabindex="-1"></a>                <span class="at">subtitle =</span> <span class="st">&#39;Differential expression&#39;</span>,</span>
<span id="cb174-786"><a href="rna-seq-mkdata.html#cb174-786" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb174-787"><a href="rna-seq-mkdata.html#cb174-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-788"><a href="rna-seq-mkdata.html#cb174-788" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap --------------------</span></span>
<span id="cb174-789"><a href="rna-seq-mkdata.html#cb174-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-790"><a href="rna-seq-mkdata.html#cb174-790" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb174-791"><a href="rna-seq-mkdata.html#cb174-791" aria-hidden="true" tabindex="-1"></a><span class="co"># df &lt;- scale(mtcars)</span></span>
<span id="cb174-792"><a href="rna-seq-mkdata.html#cb174-792" aria-hidden="true" tabindex="-1"></a><span class="co"># pheatmap(df)</span></span>
<span id="cb174-793"><a href="rna-seq-mkdata.html#cb174-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-794"><a href="rna-seq-mkdata.html#cb174-794" aria-hidden="true" tabindex="-1"></a><span class="co"># import custom function ------</span></span>
<span id="cb174-795"><a href="rna-seq-mkdata.html#cb174-795" aria-hidden="true" tabindex="-1"></a><span class="co"># source(&quot;normalization_function.R&quot;) # cant import, so I pasted below. mor_normalization.</span></span>
<span id="cb174-796"><a href="rna-seq-mkdata.html#cb174-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-797"><a href="rna-seq-mkdata.html#cb174-797" aria-hidden="true" tabindex="-1"></a>mor_normalization <span class="ot">=</span> <span class="cf">function</span>(data){</span>
<span id="cb174-798"><a href="rna-seq-mkdata.html#cb174-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb174-799"><a href="rna-seq-mkdata.html#cb174-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tibble)</span>
<span id="cb174-800"><a href="rna-seq-mkdata.html#cb174-800" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-801"><a href="rna-seq-mkdata.html#cb174-801" aria-hidden="true" tabindex="-1"></a>  <span class="co"># take the log</span></span>
<span id="cb174-802"><a href="rna-seq-mkdata.html#cb174-802" aria-hidden="true" tabindex="-1"></a>  log_data <span class="ot">=</span> <span class="fu">log</span>(data) </span>
<span id="cb174-803"><a href="rna-seq-mkdata.html#cb174-803" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-804"><a href="rna-seq-mkdata.html#cb174-804" aria-hidden="true" tabindex="-1"></a>  <span class="co"># find the psuedo-references per sample by taking the geometric mean</span></span>
<span id="cb174-805"><a href="rna-seq-mkdata.html#cb174-805" aria-hidden="true" tabindex="-1"></a>  log_data <span class="ot">=</span> log_data <span class="sc">%&gt;%</span> </span>
<span id="cb174-806"><a href="rna-seq-mkdata.html#cb174-806" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="st">&#39;gene&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-807"><a href="rna-seq-mkdata.html#cb174-807" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span> (<span class="at">gene_averages =</span> <span class="fu">rowMeans</span>(log_data)) <span class="sc">%&gt;%</span> </span>
<span id="cb174-808"><a href="rna-seq-mkdata.html#cb174-808" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(gene_averages <span class="sc">!=</span> <span class="st">&quot;-Inf&quot;</span>)</span>
<span id="cb174-809"><a href="rna-seq-mkdata.html#cb174-809" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-810"><a href="rna-seq-mkdata.html#cb174-810" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the last columns is the pseudo-reference column </span></span>
<span id="cb174-811"><a href="rna-seq-mkdata.html#cb174-811" aria-hidden="true" tabindex="-1"></a>  pseudo_column <span class="ot">=</span> <span class="fu">ncol</span>(log_data)</span>
<span id="cb174-812"><a href="rna-seq-mkdata.html#cb174-812" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-813"><a href="rna-seq-mkdata.html#cb174-813" aria-hidden="true" tabindex="-1"></a>  <span class="co"># where to stop before the pseudo column </span></span>
<span id="cb174-814"><a href="rna-seq-mkdata.html#cb174-814" aria-hidden="true" tabindex="-1"></a>  before_pseduo <span class="ot">=</span> pseudo_column <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb174-815"><a href="rna-seq-mkdata.html#cb174-815" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-816"><a href="rna-seq-mkdata.html#cb174-816" aria-hidden="true" tabindex="-1"></a>  <span class="co"># find the ratio of the log data to the pseudo-reference</span></span>
<span id="cb174-817"><a href="rna-seq-mkdata.html#cb174-817" aria-hidden="true" tabindex="-1"></a>  ratios <span class="ot">=</span> <span class="fu">sweep</span>(log_data[,<span class="dv">2</span><span class="sc">:</span>before_pseduo], <span class="dv">1</span>, log_data[,pseudo_column], <span class="st">&quot;-&quot;</span>)</span>
<span id="cb174-818"><a href="rna-seq-mkdata.html#cb174-818" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-819"><a href="rna-seq-mkdata.html#cb174-819" aria-hidden="true" tabindex="-1"></a>  <span class="co"># find the median of the ratios</span></span>
<span id="cb174-820"><a href="rna-seq-mkdata.html#cb174-820" aria-hidden="true" tabindex="-1"></a>  sample_medians <span class="ot">=</span> <span class="fu">apply</span>(ratios, <span class="dv">2</span>, median)</span>
<span id="cb174-821"><a href="rna-seq-mkdata.html#cb174-821" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-822"><a href="rna-seq-mkdata.html#cb174-822" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert the median to a scaling factor</span></span>
<span id="cb174-823"><a href="rna-seq-mkdata.html#cb174-823" aria-hidden="true" tabindex="-1"></a>  scaling_factors <span class="ot">=</span> <span class="fu">exp</span>(sample_medians)</span>
<span id="cb174-824"><a href="rna-seq-mkdata.html#cb174-824" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb174-825"><a href="rna-seq-mkdata.html#cb174-825" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use scaling factors to scale the original data</span></span>
<span id="cb174-826"><a href="rna-seq-mkdata.html#cb174-826" aria-hidden="true" tabindex="-1"></a>  manually_normalized <span class="ot">=</span> <span class="fu">sweep</span>(data, <span class="dv">2</span>, scaling_factors, <span class="st">&quot;/&quot;</span>)</span>
<span id="cb174-827"><a href="rna-seq-mkdata.html#cb174-827" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(manually_normalized)</span>
<span id="cb174-828"><a href="rna-seq-mkdata.html#cb174-828" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb174-829"><a href="rna-seq-mkdata.html#cb174-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-830"><a href="rna-seq-mkdata.html#cb174-830" aria-hidden="true" tabindex="-1"></a><span class="co"># First version</span></span>
<span id="cb174-831"><a href="rna-seq-mkdata.html#cb174-831" aria-hidden="true" tabindex="-1"></a>counts_normalised_only_diff_genes <span class="ot">=</span> </span>
<span id="cb174-832"><a href="rna-seq-mkdata.html#cb174-832" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mor_normalization</span>(counts) <span class="sc">%&gt;%</span>                 <span class="co"># normalize the counts using our custom function</span></span>
<span id="cb174-833"><a href="rna-seq-mkdata.html#cb174-833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;genes&quot;</span>) <span class="sc">%&gt;%</span>               </span>
<span id="cb174-834"><a href="rna-seq-mkdata.html#cb174-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> genes,                         <span class="co"># pivot_longer() is an update version of gather() since tidyr version 1.0</span></span>
<span id="cb174-835"><a href="rna-seq-mkdata.html#cb174-835" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;sample&quot;</span>, </span>
<span id="cb174-836"><a href="rna-seq-mkdata.html#cb174-836" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-837"><a href="rna-seq-mkdata.html#cb174-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(genes <span class="sc">%in%</span> diff<span class="sc">$</span>genes) <span class="sc">%&gt;%</span>             </span>
<span id="cb174-838"><a href="rna-seq-mkdata.html#cb174-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;sample&quot;</span>,            <span class="co"># pivot_wider() is an updated approach to spread()</span></span>
<span id="cb174-839"><a href="rna-seq-mkdata.html#cb174-839" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">&quot;counts&quot;</span>)  <span class="sc">%&gt;%</span>      </span>
<span id="cb174-840"><a href="rna-seq-mkdata.html#cb174-840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">&quot;genes&quot;</span>)                   <span class="co"># the gene column is converted back to row names to create a matrix usable with pheatmap</span></span>
<span id="cb174-841"><a href="rna-seq-mkdata.html#cb174-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-842"><a href="rna-seq-mkdata.html#cb174-842" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(counts_normalised_only_diff_genes)          <span class="co"># check that you have the expected number of rows and columns</span></span>
<span id="cb174-843"><a href="rna-seq-mkdata.html#cb174-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-844"><a href="rna-seq-mkdata.html#cb174-844" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(counts_normalised_only_diff_genes, </span>
<span id="cb174-845"><a href="rna-seq-mkdata.html#cb174-845" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>, </span>
<span id="cb174-846"><a href="rna-seq-mkdata.html#cb174-846" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>, </span>
<span id="cb174-847"><a href="rna-seq-mkdata.html#cb174-847" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb174-848"><a href="rna-seq-mkdata.html#cb174-848" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb174-849"><a href="rna-seq-mkdata.html#cb174-849" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> <span class="cn">TRUE</span>)</span>
<span id="cb174-850"><a href="rna-seq-mkdata.html#cb174-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-851"><a href="rna-seq-mkdata.html#cb174-851" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap is all blue!! WHY?!!!!!!!!!!!!!</span></span>
<span id="cb174-852"><a href="rna-seq-mkdata.html#cb174-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-853"><a href="rna-seq-mkdata.html#cb174-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-854"><a href="rna-seq-mkdata.html#cb174-854" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution of values in the counts_normalised_only_diff_genes table:</span></span>
<span id="cb174-855"><a href="rna-seq-mkdata.html#cb174-855" aria-hidden="true" tabindex="-1"></a>counts_normalised_only_diff_genes <span class="sc">%&gt;%</span> </span>
<span id="cb174-856"><a href="rna-seq-mkdata.html#cb174-856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;genes&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-857"><a href="rna-seq-mkdata.html#cb174-857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> genes, <span class="at">names_to =</span> <span class="st">&quot;sample&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-858"><a href="rna-seq-mkdata.html#cb174-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(., <span class="fu">hist</span>(counts, <span class="at">col =</span> <span class="st">&quot;dodgerblue&quot;</span>))</span>
<span id="cb174-859"><a href="rna-seq-mkdata.html#cb174-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-860"><a href="rna-seq-mkdata.html#cb174-860" aria-hidden="true" tabindex="-1"></a><span class="co"># The scale on which gene counts are represented is the (main) issue here.</span></span>
<span id="cb174-861"><a href="rna-seq-mkdata.html#cb174-861" aria-hidden="true" tabindex="-1"></a><span class="co"># There are a lot of genes for which the number of counts are very low. If you \(\log2\) transform the counts, you get a nice distribution again where all gene frequency become visible again.</span></span>
<span id="cb174-862"><a href="rna-seq-mkdata.html#cb174-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-863"><a href="rna-seq-mkdata.html#cb174-863" aria-hidden="true" tabindex="-1"></a>counts_normalised_only_diff_genes <span class="sc">%&gt;%</span> </span>
<span id="cb174-864"><a href="rna-seq-mkdata.html#cb174-864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;genes&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-865"><a href="rna-seq-mkdata.html#cb174-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span> genes,<span class="at">names_to =</span> <span class="st">&quot;sample&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb174-866"><a href="rna-seq-mkdata.html#cb174-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(., <span class="fu">hist</span>(<span class="fu">log2</span>(counts), <span class="at">col =</span> <span class="st">&quot;dodgerblue&quot;</span>))</span>
<span id="cb174-867"><a href="rna-seq-mkdata.html#cb174-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-868"><a href="rna-seq-mkdata.html#cb174-868" aria-hidden="true" tabindex="-1"></a><span class="co"># If you re-run the code for the first heatmap with a log2 transformation, you will get a simple way to display different gene count levels. We add + 1 to account for genes with count values equal to 0.</span></span>
<span id="cb174-869"><a href="rna-seq-mkdata.html#cb174-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-870"><a href="rna-seq-mkdata.html#cb174-870" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(<span class="fu">log2</span>(counts_normalised_only_diff_genes <span class="sc">+</span> <span class="dv">1</span>), </span>
<span id="cb174-871"><a href="rna-seq-mkdata.html#cb174-871" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>, </span>
<span id="cb174-872"><a href="rna-seq-mkdata.html#cb174-872" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>, </span>
<span id="cb174-873"><a href="rna-seq-mkdata.html#cb174-873" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb174-874"><a href="rna-seq-mkdata.html#cb174-874" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb174-875"><a href="rna-seq-mkdata.html#cb174-875" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> <span class="cn">TRUE</span>)</span>
<span id="cb174-876"><a href="rna-seq-mkdata.html#cb174-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-877"><a href="rna-seq-mkdata.html#cb174-877" aria-hidden="true" tabindex="-1"></a><span class="co"># Second version with scaling</span></span>
<span id="cb174-878"><a href="rna-seq-mkdata.html#cb174-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-879"><a href="rna-seq-mkdata.html#cb174-879" aria-hidden="true" tabindex="-1"></a><span class="co">#Scaling trial </span></span>
<span id="cb174-880"><a href="rna-seq-mkdata.html#cb174-880" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb174-881"><a href="rna-seq-mkdata.html#cb174-881" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">10</span>)</span>
<span id="cb174-882"><a href="rna-seq-mkdata.html#cb174-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-883"><a href="rna-seq-mkdata.html#cb174-883" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually scaling</span></span>
<span id="cb174-884"><a href="rna-seq-mkdata.html#cb174-884" aria-hidden="true" tabindex="-1"></a>(x <span class="sc">-</span> <span class="fu">mean</span>(x)) <span class="sc">/</span> <span class="fu">sd</span>(x)</span>
<span id="cb174-885"><a href="rna-seq-mkdata.html#cb174-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-886"><a href="rna-seq-mkdata.html#cb174-886" aria-hidden="true" tabindex="-1"></a><span class="co"># With scale function</span></span>
<span id="cb174-887"><a href="rna-seq-mkdata.html#cb174-887" aria-hidden="true" tabindex="-1"></a><span class="fu">scale</span>(x)[,<span class="dv">1</span>]</span>
<span id="cb174-888"><a href="rna-seq-mkdata.html#cb174-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-889"><a href="rna-seq-mkdata.html#cb174-889" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(x)</span>
<span id="cb174-890"><a href="rna-seq-mkdata.html#cb174-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-891"><a href="rna-seq-mkdata.html#cb174-891" aria-hidden="true" tabindex="-1"></a>counts_scaled <span class="ot">=</span> </span>
<span id="cb174-892"><a href="rna-seq-mkdata.html#cb174-892" aria-hidden="true" tabindex="-1"></a>  counts_normalised_only_diff_genes <span class="sc">%&gt;%</span> </span>
<span id="cb174-893"><a href="rna-seq-mkdata.html#cb174-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>(.) <span class="sc">%&gt;%</span>                              <span class="co"># transpose to have the genes in columns </span></span>
<span id="cb174-894"><a href="rna-seq-mkdata.html#cb174-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>() <span class="sc">%&gt;%</span>                           <span class="co"># scale(x, center = TRUE, scale = TRUE) </span></span>
<span id="cb174-895"><a href="rna-seq-mkdata.html#cb174-895" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>(.)                                  <span class="co"># back in original shape</span></span>
<span id="cb174-896"><a href="rna-seq-mkdata.html#cb174-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-897"><a href="rna-seq-mkdata.html#cb174-897" aria-hidden="true" tabindex="-1"></a><span class="co"># sanity check</span></span>
<span id="cb174-898"><a href="rna-seq-mkdata.html#cb174-898" aria-hidden="true" tabindex="-1"></a><span class="co"># the majority of the values should be around zero</span></span>
<span id="cb174-899"><a href="rna-seq-mkdata.html#cb174-899" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(counts_scaled, <span class="at">MARGIN =</span> <span class="dv">1</span>, mean) <span class="sc">%&gt;%</span>                          <span class="co"># calculate the mean per row</span></span>
<span id="cb174-900"><a href="rna-seq-mkdata.html#cb174-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist</span>(., <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Z-score values&quot;</span>, <span class="at">col =</span> <span class="st">&quot;dodgerblue2&quot;</span>)  </span>
<span id="cb174-901"><a href="rna-seq-mkdata.html#cb174-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-902"><a href="rna-seq-mkdata.html#cb174-902" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(counts_scaled, </span>
<span id="cb174-903"><a href="rna-seq-mkdata.html#cb174-903" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>, </span>
<span id="cb174-904"><a href="rna-seq-mkdata.html#cb174-904" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>, </span>
<span id="cb174-905"><a href="rna-seq-mkdata.html#cb174-905" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb174-906"><a href="rna-seq-mkdata.html#cb174-906" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">&quot;none&quot;</span>,            <span class="co"># already done &quot;manually&quot;</span></span>
<span id="cb174-907"><a href="rna-seq-mkdata.html#cb174-907" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> <span class="cn">TRUE</span>)</span>
<span id="cb174-908"><a href="rna-seq-mkdata.html#cb174-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-909"><a href="rna-seq-mkdata.html#cb174-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-910"><a href="rna-seq-mkdata.html#cb174-910" aria-hidden="true" tabindex="-1"></a><span class="co"># Third version with genes and samples grouped by profiles</span></span>
<span id="cb174-911"><a href="rna-seq-mkdata.html#cb174-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-912"><a href="rna-seq-mkdata.html#cb174-912" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(counts_scaled, </span>
<span id="cb174-913"><a href="rna-seq-mkdata.html#cb174-913" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_rows =</span> <span class="cn">TRUE</span>,                      </span>
<span id="cb174-914"><a href="rna-seq-mkdata.html#cb174-914" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_cols =</span> <span class="cn">TRUE</span>, </span>
<span id="cb174-915"><a href="rna-seq-mkdata.html#cb174-915" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb174-916"><a href="rna-seq-mkdata.html#cb174-916" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> <span class="cn">TRUE</span>,</span>
<span id="cb174-917"><a href="rna-seq-mkdata.html#cb174-917" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Clustering on&quot;</span>)</span>
<span id="cb174-918"><a href="rna-seq-mkdata.html#cb174-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-919"><a href="rna-seq-mkdata.html#cb174-919" aria-hidden="true" tabindex="-1"></a><span class="co"># Fourth version of our heatmap with the 8 samples being investigated.</span></span>
<span id="cb174-920"><a href="rna-seq-mkdata.html#cb174-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-921"><a href="rna-seq-mkdata.html#cb174-921" aria-hidden="true" tabindex="-1"></a>counts_scaled_filtered <span class="ot">=</span> </span>
<span id="cb174-922"><a href="rna-seq-mkdata.html#cb174-922" aria-hidden="true" tabindex="-1"></a>  counts_scaled <span class="sc">%&gt;%</span> </span>
<span id="cb174-923"><a href="rna-seq-mkdata.html#cb174-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb174-924"><a href="rna-seq-mkdata.html#cb174-924" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(var_GenetypeKo_vs_Time14<span class="sc">$</span>SampleName) <span class="co"># keep the 8 samples</span></span>
<span id="cb174-925"><a href="rna-seq-mkdata.html#cb174-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-926"><a href="rna-seq-mkdata.html#cb174-926" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counts_scaled_filtered)</span>
<span id="cb174-927"><a href="rna-seq-mkdata.html#cb174-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-928"><a href="rna-seq-mkdata.html#cb174-928" aria-hidden="true" tabindex="-1"></a><span class="co"># Anotations for the map</span></span>
<span id="cb174-929"><a href="rna-seq-mkdata.html#cb174-929" aria-hidden="true" tabindex="-1"></a>anno_col_info <span class="ot">=</span> var_GenetypeKo_vs_Time14 <span class="sc">%&gt;%</span> <span class="fu">column_to_rownames</span>(<span class="st">&quot;SampleName&quot;</span>)</span>
<span id="cb174-930"><a href="rna-seq-mkdata.html#cb174-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-931"><a href="rna-seq-mkdata.html#cb174-931" aria-hidden="true" tabindex="-1"></a>anno_info_colors <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb174-932"><a href="rna-seq-mkdata.html#cb174-932" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tissue =</span> <span class="fu">c</span>(<span class="at">PDL =</span> <span class="st">&quot;#d8b365&quot;</span>),</span>
<span id="cb174-933"><a href="rna-seq-mkdata.html#cb174-933" aria-hidden="true" tabindex="-1"></a>  <span class="at">Genotype =</span> <span class="fu">c</span>(<span class="at">WT =</span> <span class="st">&quot;lightgrey&quot;</span>, </span>
<span id="cb174-934"><a href="rna-seq-mkdata.html#cb174-934" aria-hidden="true" tabindex="-1"></a>               <span class="at">Ko =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb174-935"><a href="rna-seq-mkdata.html#cb174-935" aria-hidden="true" tabindex="-1"></a>  <span class="at">Time =</span> <span class="fu">c</span>(<span class="st">&quot;14&quot;</span> <span class="ot">=</span> <span class="st">&quot;dodgerblue4&quot;</span>)</span>
<span id="cb174-936"><a href="rna-seq-mkdata.html#cb174-936" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb174-937"><a href="rna-seq-mkdata.html#cb174-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-938"><a href="rna-seq-mkdata.html#cb174-938" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmatp with anotations</span></span>
<span id="cb174-939"><a href="rna-seq-mkdata.html#cb174-939" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(counts_scaled_filtered, </span>
<span id="cb174-940"><a href="rna-seq-mkdata.html#cb174-940" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_rows =</span> <span class="cn">TRUE</span>,                       </span>
<span id="cb174-941"><a href="rna-seq-mkdata.html#cb174-941" aria-hidden="true" tabindex="-1"></a>         <span class="at">cluster_cols =</span> <span class="cn">TRUE</span>, </span>
<span id="cb174-942"><a href="rna-seq-mkdata.html#cb174-942" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb174-943"><a href="rna-seq-mkdata.html#cb174-943" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_colnames =</span> <span class="cn">TRUE</span>,</span>
<span id="cb174-944"><a href="rna-seq-mkdata.html#cb174-944" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_col =</span> anno_col_info,</span>
<span id="cb174-945"><a href="rna-seq-mkdata.html#cb174-945" aria-hidden="true" tabindex="-1"></a>         <span class="at">annotation_colors =</span> anno_info_colors,</span>
<span id="cb174-946"><a href="rna-seq-mkdata.html#cb174-946" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Clustering with ward method&quot;</span>)</span>
<span id="cb174-947"><a href="rna-seq-mkdata.html#cb174-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-948"><a href="rna-seq-mkdata.html#cb174-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-949"><a href="rna-seq-mkdata.html#cb174-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-950"><a href="rna-seq-mkdata.html#cb174-950" aria-hidden="true" tabindex="-1"></a><span class="co"># MA plots -------</span></span>
<span id="cb174-951"><a href="rna-seq-mkdata.html#cb174-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-952"><a href="rna-seq-mkdata.html#cb174-952" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(dds3, <span class="at">alpha =</span> <span class="fl">0.01</span>)</span>
<span id="cb174-953"><a href="rna-seq-mkdata.html#cb174-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-954"><a href="rna-seq-mkdata.html#cb174-954" aria-hidden="true" tabindex="-1"></a><span class="do">## S4 method for signature &#39;DESeqDataSet&#39;</span></span>
<span id="cb174-955"><a href="rna-seq-mkdata.html#cb174-955" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(</span>
<span id="cb174-956"><a href="rna-seq-mkdata.html#cb174-956" aria-hidden="true" tabindex="-1"></a>  dds3,</span>
<span id="cb174-957"><a href="rna-seq-mkdata.html#cb174-957" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.01</span>,</span>
<span id="cb174-958"><a href="rna-seq-mkdata.html#cb174-958" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;DESeqDataSet plotMA&quot;</span>,</span>
<span id="cb174-959"><a href="rna-seq-mkdata.html#cb174-959" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;mean of normalized counts&quot;</span>,</span>
<span id="cb174-960"><a href="rna-seq-mkdata.html#cb174-960" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ylim,</span></span>
<span id="cb174-961"><a href="rna-seq-mkdata.html#cb174-961" aria-hidden="true" tabindex="-1"></a>  <span class="at">colNonSig =</span> <span class="st">&quot;gray60&quot;</span>,</span>
<span id="cb174-962"><a href="rna-seq-mkdata.html#cb174-962" aria-hidden="true" tabindex="-1"></a>  <span class="at">colSig =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb174-963"><a href="rna-seq-mkdata.html#cb174-963" aria-hidden="true" tabindex="-1"></a>  <span class="at">colLine =</span> <span class="st">&quot;grey40&quot;</span>,</span>
<span id="cb174-964"><a href="rna-seq-mkdata.html#cb174-964" aria-hidden="true" tabindex="-1"></a>  <span class="at">returnData =</span> <span class="cn">FALSE</span>,</span>
<span id="cb174-965"><a href="rna-seq-mkdata.html#cb174-965" aria-hidden="true" tabindex="-1"></a>  <span class="at">MLE =</span> <span class="cn">FALSE</span>,</span>
<span id="cb174-966"><a href="rna-seq-mkdata.html#cb174-966" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb174-967"><a href="rna-seq-mkdata.html#cb174-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-968"><a href="rna-seq-mkdata.html#cb174-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-969"><a href="rna-seq-mkdata.html#cb174-969" aria-hidden="true" tabindex="-1"></a><span class="co"># Eastern New Mexico University  ENMU ***** ------</span></span>
<span id="cb174-970"><a href="rna-seq-mkdata.html#cb174-970" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Data</span></span>
<span id="cb174-971"><a href="rna-seq-mkdata.html#cb174-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-972"><a href="rna-seq-mkdata.html#cb174-972" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb174-973"><a href="rna-seq-mkdata.html#cb174-973" aria-hidden="true" tabindex="-1"></a>all_raw_count <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/all.raw.count.xlsx&quot;</span>)</span>
<span id="cb174-974"><a href="rna-seq-mkdata.html#cb174-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-975"><a href="rna-seq-mkdata.html#cb174-975" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_raw_count)</span>
<span id="cb174-976"><a href="rna-seq-mkdata.html#cb174-976" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(all_raw_count)</span>
<span id="cb174-977"><a href="rna-seq-mkdata.html#cb174-977" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(all_raw_count)</span>
<span id="cb174-978"><a href="rna-seq-mkdata.html#cb174-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-979"><a href="rna-seq-mkdata.html#cb174-979" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract column names.</span></span>
<span id="cb174-980"><a href="rna-seq-mkdata.html#cb174-980" aria-hidden="true" tabindex="-1"></a>colnames <span class="ot">&lt;-</span> <span class="fu">colnames</span>(all_raw_count)</span>
<span id="cb174-981"><a href="rna-seq-mkdata.html#cb174-981" aria-hidden="true" tabindex="-1"></a>colnames</span>
<span id="cb174-982"><a href="rna-seq-mkdata.html#cb174-982" aria-hidden="true" tabindex="-1"></a><span class="co"># “r convert list to comma separated string”</span></span>
<span id="cb174-983"><a href="rna-seq-mkdata.html#cb174-983" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">shQuote</span>(colnames), <span class="at">collapse=</span><span class="st">&quot;, &quot;</span>) <span class="co"># with quotes.</span></span>
<span id="cb174-984"><a href="rna-seq-mkdata.html#cb174-984" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(colnames, <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>) <span class="co"># without quotes. </span></span>
<span id="cb174-985"><a href="rna-seq-mkdata.html#cb174-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-986"><a href="rna-seq-mkdata.html#cb174-986" aria-hidden="true" tabindex="-1"></a>excluded_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GeneName&quot;</span>, <span class="st">&quot;Chr&quot;</span>, <span class="st">&quot;Start&quot;</span>, <span class="st">&quot;End&quot;</span>, <span class="st">&quot;Strand&quot;</span>, <span class="st">&quot;Length&quot;</span> )</span>
<span id="cb174-987"><a href="rna-seq-mkdata.html#cb174-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-988"><a href="rna-seq-mkdata.html#cb174-988" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># for select function</span></span>
<span id="cb174-989"><a href="rna-seq-mkdata.html#cb174-989" aria-hidden="true" tabindex="-1"></a>all_raw_count01 <span class="ot">&lt;-</span> <span class="fu">select</span>(all_raw_count, <span class="sc">-</span>excluded_vars) <span class="co"># it works, but... better use:</span></span>
<span id="cb174-990"><a href="rna-seq-mkdata.html#cb174-990" aria-hidden="true" tabindex="-1"></a>all_raw_count01 <span class="ot">&lt;-</span> <span class="fu">select</span>(all_raw_count, <span class="sc">-</span><span class="fu">all_of</span>(excluded_vars)) <span class="co">#exclude all variables in excluded_vars</span></span>
<span id="cb174-991"><a href="rna-seq-mkdata.html#cb174-991" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_raw_count01)</span>
<span id="cb174-992"><a href="rna-seq-mkdata.html#cb174-992" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(all_raw_count01)</span>
<span id="cb174-993"><a href="rna-seq-mkdata.html#cb174-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-994"><a href="rna-seq-mkdata.html#cb174-994" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(all_raw_count01)</span>
<span id="cb174-995"><a href="rna-seq-mkdata.html#cb174-995" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb174-996"><a href="rna-seq-mkdata.html#cb174-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-997"><a href="rna-seq-mkdata.html#cb174-997" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting first column into row names</span></span>
<span id="cb174-998"><a href="rna-seq-mkdata.html#cb174-998" aria-hidden="true" tabindex="-1"></a>all_raw_count01 <span class="ot">&lt;-</span> all_raw_count01 <span class="sc">%&gt;%</span> <span class="fu">column_to_rownames</span>(<span class="at">var=</span><span class="st">&quot;GeneID&quot;</span>) </span>
<span id="cb174-999"><a href="rna-seq-mkdata.html#cb174-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1000"><a href="rna-seq-mkdata.html#cb174-1000" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean/filter of non expresed genes </span></span>
<span id="cb174-1001"><a href="rna-seq-mkdata.html#cb174-1001" aria-hidden="true" tabindex="-1"></a><span class="co"># If Center and Scale needed, remove all rows containing all 0 values.</span></span>
<span id="cb174-1002"><a href="rna-seq-mkdata.html#cb174-1002" aria-hidden="true" tabindex="-1"></a><span class="co"># df1[rowSums(df1[])&gt;0,]</span></span>
<span id="cb174-1003"><a href="rna-seq-mkdata.html#cb174-1003" aria-hidden="true" tabindex="-1"></a>all_raw_count02 <span class="ot">&lt;-</span> all_raw_count01[<span class="fu">rowSums</span>(all_raw_count01[])<span class="sc">&gt;</span><span class="dv">0</span>,] </span>
<span id="cb174-1004"><a href="rna-seq-mkdata.html#cb174-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1005"><a href="rna-seq-mkdata.html#cb174-1005" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_raw_count02 [,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb174-1006"><a href="rna-seq-mkdata.html#cb174-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1007"><a href="rna-seq-mkdata.html#cb174-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1008"><a href="rna-seq-mkdata.html#cb174-1008" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Metadata</span></span>
<span id="cb174-1009"><a href="rna-seq-mkdata.html#cb174-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb174-1010"><a href="rna-seq-mkdata.html#cb174-1010" aria-hidden="true" tabindex="-1"></a>Metadata <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Notes.xlsx&quot;</span>, </span>
<span id="cb174-1011"><a href="rna-seq-mkdata.html#cb174-1011" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sheet =</span> <span class="st">&quot;MetaData&quot;</span>)</span>
<span id="cb174-1012"><a href="rna-seq-mkdata.html#cb174-1012" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Metadata)</span>
<span id="cb174-1013"><a href="rna-seq-mkdata.html#cb174-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1014"><a href="rna-seq-mkdata.html#cb174-1014" aria-hidden="true" tabindex="-1"></a><span class="co"># Order Metadata as you want to appear in the graphs. </span></span>
<span id="cb174-1015"><a href="rna-seq-mkdata.html#cb174-1015" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb174-1016"><a href="rna-seq-mkdata.html#cb174-1016" aria-hidden="true" tabindex="-1"></a>Metadata2 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Notes.xlsx&quot;</span>, </span>
<span id="cb174-1017"><a href="rna-seq-mkdata.html#cb174-1017" aria-hidden="true" tabindex="-1"></a>                        <span class="at">sheet =</span> <span class="st">&quot;MetaData2&quot;</span>)</span>
<span id="cb174-1018"><a href="rna-seq-mkdata.html#cb174-1018" aria-hidden="true" tabindex="-1"></a>Metadata2</span>
<span id="cb174-1019"><a href="rna-seq-mkdata.html#cb174-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1020"><a href="rna-seq-mkdata.html#cb174-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1021"><a href="rna-seq-mkdata.html#cb174-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Metadata2)</span>
<span id="cb174-1022"><a href="rna-seq-mkdata.html#cb174-1022" aria-hidden="true" tabindex="-1"></a>Metadata2<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Metadata2<span class="sc">$</span>Time)</span>
<span id="cb174-1023"><a href="rna-seq-mkdata.html#cb174-1023" aria-hidden="true" tabindex="-1"></a>Metadata2<span class="sc">$</span>Genotype <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Metadata2<span class="sc">$</span>Genotype)</span>
<span id="cb174-1024"><a href="rna-seq-mkdata.html#cb174-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1025"><a href="rna-seq-mkdata.html#cb174-1025" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Metadata2)</span>
<span id="cb174-1026"><a href="rna-seq-mkdata.html#cb174-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1027"><a href="rna-seq-mkdata.html#cb174-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1028"><a href="rna-seq-mkdata.html#cb174-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1029"><a href="rna-seq-mkdata.html#cb174-1029" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dds file</span></span>
<span id="cb174-1030"><a href="rna-seq-mkdata.html#cb174-1030" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DESeq2)</span>
<span id="cb174-1031"><a href="rna-seq-mkdata.html#cb174-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1032"><a href="rna-seq-mkdata.html#cb174-1032" aria-hidden="true" tabindex="-1"></a><span class="do">## Creation of the DESeqDataSet</span></span>
<span id="cb174-1033"><a href="rna-seq-mkdata.html#cb174-1033" aria-hidden="true" tabindex="-1"></a>dds4 <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> all_raw_count02, </span>
<span id="cb174-1034"><a href="rna-seq-mkdata.html#cb174-1034" aria-hidden="true" tabindex="-1"></a>                               <span class="at">colData =</span> Metadata2, </span>
<span id="cb174-1035"><a href="rna-seq-mkdata.html#cb174-1035" aria-hidden="true" tabindex="-1"></a>                               <span class="at">design =</span> <span class="sc">~</span> Genotype) <span class="co"># only one comparison. Time not included. </span></span>
<span id="cb174-1036"><a href="rna-seq-mkdata.html#cb174-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1037"><a href="rna-seq-mkdata.html#cb174-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1038"><a href="rna-seq-mkdata.html#cb174-1038" aria-hidden="true" tabindex="-1"></a><span class="co">#?`DESeq2-package`</span></span>
<span id="cb174-1039"><a href="rna-seq-mkdata.html#cb174-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1040"><a href="rna-seq-mkdata.html#cb174-1040" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only the genes with count &gt;10</span></span>
<span id="cb174-1041"><a href="rna-seq-mkdata.html#cb174-1041" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">counts</span>(dds4))<span class="sc">&gt;=</span><span class="dv">10</span></span>
<span id="cb174-1042"><a href="rna-seq-mkdata.html#cb174-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1043"><a href="rna-seq-mkdata.html#cb174-1043" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out keep.</span></span>
<span id="cb174-1044"><a href="rna-seq-mkdata.html#cb174-1044" aria-hidden="true" tabindex="-1"></a>dds4 <span class="ot">&lt;-</span> dds4[keep,]</span>
<span id="cb174-1045"><a href="rna-seq-mkdata.html#cb174-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1046"><a href="rna-seq-mkdata.html#cb174-1046" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate Size Factor</span></span>
<span id="cb174-1047"><a href="rna-seq-mkdata.html#cb174-1047" aria-hidden="true" tabindex="-1"></a>ddsN <span class="ot">&lt;-</span> <span class="fu">estimateSizeFactors</span>(dds4)</span>
<span id="cb174-1048"><a href="rna-seq-mkdata.html#cb174-1048" aria-hidden="true" tabindex="-1"></a>ddsN <span class="ot">&lt;-</span> <span class="fu">estimateDispersions</span>(ddsN)</span>
<span id="cb174-1049"><a href="rna-seq-mkdata.html#cb174-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1050"><a href="rna-seq-mkdata.html#cb174-1050" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize Data</span></span>
<span id="cb174-1051"><a href="rna-seq-mkdata.html#cb174-1051" aria-hidden="true" tabindex="-1"></a>Ndds <span class="ot">&lt;-</span> <span class="fu">counts</span>(ddsN, <span class="at">normalized=</span>T)</span>
<span id="cb174-1052"><a href="rna-seq-mkdata.html#cb174-1052" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Ndds)</span>
<span id="cb174-1053"><a href="rna-seq-mkdata.html#cb174-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1054"><a href="rna-seq-mkdata.html#cb174-1054" aria-hidden="true" tabindex="-1"></a><span class="co"># Save into a file.</span></span>
<span id="cb174-1055"><a href="rna-seq-mkdata.html#cb174-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1056"><a href="rna-seq-mkdata.html#cb174-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1057"><a href="rna-seq-mkdata.html#cb174-1057" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the differentiation Expression Table.</span></span>
<span id="cb174-1058"><a href="rna-seq-mkdata.html#cb174-1058" aria-hidden="true" tabindex="-1"></a>ddsDE <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds4) <span class="co">#Why dds4 and not Ndds?</span></span>
<span id="cb174-1059"><a href="rna-seq-mkdata.html#cb174-1059" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ddsDE)</span>
<span id="cb174-1060"><a href="rna-seq-mkdata.html#cb174-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1061"><a href="rna-seq-mkdata.html#cb174-1061" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the results of the differentiation expression analysis and define alpha.</span></span>
<span id="cb174-1062"><a href="rna-seq-mkdata.html#cb174-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1063"><a href="rna-seq-mkdata.html#cb174-1063" aria-hidden="true" tabindex="-1"></a>res4 <span class="ot">&lt;-</span> <span class="fu">results</span>(ddsDE, <span class="at">alpha =</span> <span class="fl">0.001</span>)</span>
<span id="cb174-1064"><a href="rna-seq-mkdata.html#cb174-1064" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res4)</span>
<span id="cb174-1065"><a href="rna-seq-mkdata.html#cb174-1065" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(res4)</span>
<span id="cb174-1066"><a href="rna-seq-mkdata.html#cb174-1066" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as file.</span></span>
<span id="cb174-1067"><a href="rna-seq-mkdata.html#cb174-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1068"><a href="rna-seq-mkdata.html#cb174-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1069"><a href="rna-seq-mkdata.html#cb174-1069" aria-hidden="true" tabindex="-1"></a><span class="co"># Order padj values from smallest to largest</span></span>
<span id="cb174-1070"><a href="rna-seq-mkdata.html#cb174-1070" aria-hidden="true" tabindex="-1"></a>res4Ordered <span class="ot">&lt;-</span> res4[<span class="fu">order</span>(res4<span class="sc">$</span>padj),]</span>
<span id="cb174-1071"><a href="rna-seq-mkdata.html#cb174-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1072"><a href="rna-seq-mkdata.html#cb174-1072" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res4Ordered)</span>
<span id="cb174-1073"><a href="rna-seq-mkdata.html#cb174-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1074"><a href="rna-seq-mkdata.html#cb174-1074" aria-hidden="true" tabindex="-1"></a><span class="co"># Save values in a file. </span></span>
<span id="cb174-1075"><a href="rna-seq-mkdata.html#cb174-1075" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;xlsx&quot;</span>)</span>
<span id="cb174-1076"><a href="rna-seq-mkdata.html#cb174-1076" aria-hidden="true" tabindex="-1"></a><span class="co"># Add another data set..... I AM ADDING THIS AS A NEW SHEET TO AN EXISTING FILE FROM THE PREVIOUS PCA ANALISYS.</span></span>
<span id="cb174-1077"><a href="rna-seq-mkdata.html#cb174-1077" aria-hidden="true" tabindex="-1"></a><span class="fu">write.xlsx</span>(res4Ordered, <span class="at">file =</span> <span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Top10DEgenes_prcomp.xlsx&quot;</span>,</span>
<span id="cb174-1078"><a href="rna-seq-mkdata.html#cb174-1078" aria-hidden="true" tabindex="-1"></a>           <span class="at">sheetName =</span> <span class="st">&quot;diff2ENMU.001&quot;</span>, <span class="at">row.names =</span> T, <span class="at">append =</span> <span class="cn">TRUE</span>) <span class="co"># to add as a new sheet.</span></span>
<span id="cb174-1079"><a href="rna-seq-mkdata.html#cb174-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1080"><a href="rna-seq-mkdata.html#cb174-1080" aria-hidden="true" tabindex="-1"></a><span class="co"># TAKES A LONG TIME TO SAVE... BE PATIENT. *****************************************</span></span>
<span id="cb174-1081"><a href="rna-seq-mkdata.html#cb174-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1082"><a href="rna-seq-mkdata.html#cb174-1082" aria-hidden="true" tabindex="-1"></a><span class="co"># PlotMA</span></span>
<span id="cb174-1083"><a href="rna-seq-mkdata.html#cb174-1083" aria-hidden="true" tabindex="-1"></a><span class="fu">plotMA</span>(ddsDE,</span>
<span id="cb174-1084"><a href="rna-seq-mkdata.html#cb174-1084" aria-hidden="true" tabindex="-1"></a>       <span class="at">colSig =</span> <span class="st">&quot;red&quot;</span>,)</span>
<span id="cb174-1085"><a href="rna-seq-mkdata.html#cb174-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1086"><a href="rna-seq-mkdata.html#cb174-1086" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PCA</span></span>
<span id="cb174-1087"><a href="rna-seq-mkdata.html#cb174-1087" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply a variance stabilizing transformation (VST) to the count data</span></span>
<span id="cb174-1088"><a href="rna-seq-mkdata.html#cb174-1088" aria-hidden="true" tabindex="-1"></a>vsd <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds4, <span class="at">blind =</span> F)</span>
<span id="cb174-1089"><a href="rna-seq-mkdata.html#cb174-1089" aria-hidden="true" tabindex="-1"></a>vsd</span>
<span id="cb174-1090"><a href="rna-seq-mkdata.html#cb174-1090" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(vsd)</span>
<span id="cb174-1091"><a href="rna-seq-mkdata.html#cb174-1091" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPCA</span>(vsd, <span class="at">intgroup =</span> <span class="fu">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Genotype&quot;</span>))</span>
<span id="cb174-1092"><a href="rna-seq-mkdata.html#cb174-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1093"><a href="rna-seq-mkdata.html#cb174-1093" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample to sample distribution</span></span>
<span id="cb174-1094"><a href="rna-seq-mkdata.html#cb174-1094" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb174-1095"><a href="rna-seq-mkdata.html#cb174-1095" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb174-1096"><a href="rna-seq-mkdata.html#cb174-1096" aria-hidden="true" tabindex="-1"></a>sampleDist <span class="ot">&lt;-</span> <span class="fu">dist</span>(<span class="fu">t</span>(<span class="fu">assay</span>(vsd)))</span>
<span id="cb174-1097"><a href="rna-seq-mkdata.html#cb174-1097" aria-hidden="true" tabindex="-1"></a>sampleDist</span>
<span id="cb174-1098"><a href="rna-seq-mkdata.html#cb174-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1099"><a href="rna-seq-mkdata.html#cb174-1099" aria-hidden="true" tabindex="-1"></a>sampleDistMatrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(sampleDist)</span>
<span id="cb174-1100"><a href="rna-seq-mkdata.html#cb174-1100" aria-hidden="true" tabindex="-1"></a>sampleDistMatrix</span>
<span id="cb174-1101"><a href="rna-seq-mkdata.html#cb174-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1102"><a href="rna-seq-mkdata.html#cb174-1102" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sampleDistMatrix) <span class="ot">&lt;-</span> vsd<span class="sc">$</span>Genotype</span>
<span id="cb174-1103"><a href="rna-seq-mkdata.html#cb174-1103" aria-hidden="true" tabindex="-1"></a>sampleDistMatrix</span>
<span id="cb174-1104"><a href="rna-seq-mkdata.html#cb174-1104" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sampleDistMatrix) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb174-1105"><a href="rna-seq-mkdata.html#cb174-1105" aria-hidden="true" tabindex="-1"></a>sampleDistMatrix</span>
<span id="cb174-1106"><a href="rna-seq-mkdata.html#cb174-1106" aria-hidden="true" tabindex="-1"></a><span class="co">#colors &lt;- colorRampPalette(rev(brewer.pal(9, &quot;Blues&quot;))), (225))</span></span>
<span id="cb174-1107"><a href="rna-seq-mkdata.html#cb174-1107" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(sampleDistMatrix,</span>
<span id="cb174-1108"><a href="rna-seq-mkdata.html#cb174-1108" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_rows =</span> sampleDist,</span>
<span id="cb174-1109"><a href="rna-seq-mkdata.html#cb174-1109" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_distance_cols =</span> sampleDist,</span>
<span id="cb174-1110"><a href="rna-seq-mkdata.html#cb174-1110" aria-hidden="true" tabindex="-1"></a>         <span class="co">#col=colors</span></span>
<span id="cb174-1111"><a href="rna-seq-mkdata.html#cb174-1111" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb174-1112"><a href="rna-seq-mkdata.html#cb174-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1113"><a href="rna-seq-mkdata.html#cb174-1113" aria-hidden="true" tabindex="-1"></a><span class="co"># Gene expression plotting</span></span>
<span id="cb174-1114"><a href="rna-seq-mkdata.html#cb174-1114" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb174-1115"><a href="rna-seq-mkdata.html#cb174-1115" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;meltt&quot;)</span></span>
<span id="cb174-1116"><a href="rna-seq-mkdata.html#cb174-1116" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape)</span>
<span id="cb174-1117"><a href="rna-seq-mkdata.html#cb174-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1118"><a href="rna-seq-mkdata.html#cb174-1118" aria-hidden="true" tabindex="-1"></a><span class="co"># Expression file (Ndds)</span></span>
<span id="cb174-1119"><a href="rna-seq-mkdata.html#cb174-1119" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Ndds)  <span class="co"># Is a matrix</span></span>
<span id="cb174-1120"><a href="rna-seq-mkdata.html#cb174-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1121"><a href="rna-seq-mkdata.html#cb174-1121" aria-hidden="true" tabindex="-1"></a><span class="co"># DE results file</span></span>
<span id="cb174-1122"><a href="rna-seq-mkdata.html#cb174-1122" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res4Ordered) <span class="co"># Is not a matrix. but was saved in a file </span></span>
<span id="cb174-1123"><a href="rna-seq-mkdata.html#cb174-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1124"><a href="rna-seq-mkdata.html#cb174-1124" aria-hidden="true" tabindex="-1"></a><span class="co"># Load DE results file </span></span>
<span id="cb174-1125"><a href="rna-seq-mkdata.html#cb174-1125" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb174-1126"><a href="rna-seq-mkdata.html#cb174-1126" aria-hidden="true" tabindex="-1"></a>statsDE <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Top10DEgenes_prcomp.xlsx&quot;</span>, </span>
<span id="cb174-1127"><a href="rna-seq-mkdata.html#cb174-1127" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sheet =</span> <span class="st">&quot;diff2ENMU.01&quot;</span>)</span>
<span id="cb174-1128"><a href="rna-seq-mkdata.html#cb174-1128" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(statsDE)</span>
<span id="cb174-1129"><a href="rna-seq-mkdata.html#cb174-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1130"><a href="rna-seq-mkdata.html#cb174-1130" aria-hidden="true" tabindex="-1"></a><span class="co"># Change column of GeneID to row names Method 3 </span></span>
<span id="cb174-1131"><a href="rna-seq-mkdata.html#cb174-1131" aria-hidden="true" tabindex="-1"></a>statsDE <span class="ot">&lt;-</span> statsDE <span class="sc">%&gt;%</span> <span class="fu">column_to_rownames</span>(<span class="at">var=</span><span class="st">&quot;...1&quot;</span>) </span>
<span id="cb174-1132"><a href="rna-seq-mkdata.html#cb174-1132" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(statsDE)</span>
<span id="cb174-1133"><a href="rna-seq-mkdata.html#cb174-1133" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(statsDE)</span>
<span id="cb174-1134"><a href="rna-seq-mkdata.html#cb174-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1135"><a href="rna-seq-mkdata.html#cb174-1135" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if there are NA values in the df. If true then omit all NA rows. </span></span>
<span id="cb174-1136"><a href="rna-seq-mkdata.html#cb174-1136" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(statsDE, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(<span class="fu">is.na</span>(x))) <span class="co"># check by columns</span></span>
<span id="cb174-1137"><a href="rna-seq-mkdata.html#cb174-1137" aria-hidden="true" tabindex="-1"></a><span class="co"># baseMean log2FoldChange          lfcSE           stat         pvalue           padj </span></span>
<span id="cb174-1138"><a href="rna-seq-mkdata.html#cb174-1138" aria-hidden="true" tabindex="-1"></a><span class="co"># FALSE          FALSE          FALSE          FALSE          FALSE           TRUE </span></span>
<span id="cb174-1139"><a href="rna-seq-mkdata.html#cb174-1139" aria-hidden="true" tabindex="-1"></a>statsDE <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(statsDE)</span>
<span id="cb174-1140"><a href="rna-seq-mkdata.html#cb174-1140" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(statsDE)</span>
<span id="cb174-1141"><a href="rna-seq-mkdata.html#cb174-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1142"><a href="rna-seq-mkdata.html#cb174-1142" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter Significant values. 0.05 or 0.01 or 0.001</span></span>
<span id="cb174-1143"><a href="rna-seq-mkdata.html#cb174-1143" aria-hidden="true" tabindex="-1"></a>statsDE<span class="sc">$</span>sig <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(statsDE<span class="sc">$</span>padj <span class="sc">&lt;=</span> <span class="fl">0.01</span>, <span class="st">&quot;sig&quot;</span>, <span class="st">&quot;not&quot;</span>)</span>
<span id="cb174-1144"><a href="rna-seq-mkdata.html#cb174-1144" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(statsDE)</span>
<span id="cb174-1145"><a href="rna-seq-mkdata.html#cb174-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1146"><a href="rna-seq-mkdata.html#cb174-1146" aria-hidden="true" tabindex="-1"></a>plotMA <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(statsDE, <span class="fu">aes</span>(<span class="at">x=</span> <span class="fu">log10</span>(baseMean), <span class="at">y=</span> log2FoldChange, <span class="at">color=</span>sig)) <span class="sc">+</span> </span>
<span id="cb174-1147"><a href="rna-seq-mkdata.html#cb174-1147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb174-1148"><a href="rna-seq-mkdata.html#cb174-1148" aria-hidden="true" tabindex="-1"></a>plotMA</span>
<span id="cb174-1149"><a href="rna-seq-mkdata.html#cb174-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1150"><a href="rna-seq-mkdata.html#cb174-1150" aria-hidden="true" tabindex="-1"></a><span class="co"># Volcano Plot</span></span>
<span id="cb174-1151"><a href="rna-seq-mkdata.html#cb174-1151" aria-hidden="true" tabindex="-1"></a>volcanoplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(statsDE, <span class="fu">aes</span>(<span class="at">x=</span> log2FoldChange, <span class="at">y=</span> <span class="sc">-</span><span class="fu">log10</span>(padj), <span class="at">color =</span> sig)) <span class="sc">+</span></span>
<span id="cb174-1152"><a href="rna-seq-mkdata.html#cb174-1152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb174-1153"><a href="rna-seq-mkdata.html#cb174-1153" aria-hidden="true" tabindex="-1"></a>volcanoplot</span>
<span id="cb174-1154"><a href="rna-seq-mkdata.html#cb174-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1155"><a href="rna-seq-mkdata.html#cb174-1155" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the top 10  differentially expressed genes. </span></span>
<span id="cb174-1156"><a href="rna-seq-mkdata.html#cb174-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1157"><a href="rna-seq-mkdata.html#cb174-1157" aria-hidden="true" tabindex="-1"></a>topTen <span class="ot">&lt;-</span> statsDE[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,]</span>
<span id="cb174-1158"><a href="rna-seq-mkdata.html#cb174-1158" aria-hidden="true" tabindex="-1"></a>topTen</span>
<span id="cb174-1159"><a href="rna-seq-mkdata.html#cb174-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1160"><a href="rna-seq-mkdata.html#cb174-1160" aria-hidden="true" tabindex="-1"></a>all_raw_count00 <span class="ot">&lt;-</span> all_raw_count <span class="sc">%&gt;%</span> <span class="fu">column_to_rownames</span>(<span class="at">var=</span><span class="st">&quot;GeneID&quot;</span>) <span class="co"># For all data columns</span></span>
<span id="cb174-1161"><a href="rna-seq-mkdata.html#cb174-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1162"><a href="rna-seq-mkdata.html#cb174-1162" aria-hidden="true" tabindex="-1"></a>all_raw_count00[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb174-1163"><a href="rna-seq-mkdata.html#cb174-1163" aria-hidden="true" tabindex="-1"></a>topTenMerg <span class="ot">&lt;-</span> <span class="fu">merge</span>(topTen, all_raw_count00, <span class="at">by=</span><span class="dv">0</span>) </span>
<span id="cb174-1164"><a href="rna-seq-mkdata.html#cb174-1164" aria-hidden="true" tabindex="-1"></a>topTenMerg [<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb174-1165"><a href="rna-seq-mkdata.html#cb174-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1166"><a href="rna-seq-mkdata.html#cb174-1166" aria-hidden="true" tabindex="-1"></a><span class="co"># Save values in a file. </span></span>
<span id="cb174-1167"><a href="rna-seq-mkdata.html#cb174-1167" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;xlsx&quot;</span>)</span>
<span id="cb174-1168"><a href="rna-seq-mkdata.html#cb174-1168" aria-hidden="true" tabindex="-1"></a><span class="co"># Add another data set..... I AM ADDING THIS AS A NEW SHEET TO AN EXISTING FILE FROM THE PREVIOUS PCA ANALISYS.</span></span>
<span id="cb174-1169"><a href="rna-seq-mkdata.html#cb174-1169" aria-hidden="true" tabindex="-1"></a><span class="fu">write.xlsx</span>(topTenMerg, <span class="at">file =</span> <span class="st">&quot;~/Box Sync/Niigata Uni Box/Kakenhi/2020-22 Kakenhi/Raw data/Top10DEgenes_prcomp.xlsx&quot;</span>,</span>
<span id="cb174-1170"><a href="rna-seq-mkdata.html#cb174-1170" aria-hidden="true" tabindex="-1"></a>           <span class="at">sheetName =</span> <span class="st">&quot;top100MergENMU&quot;</span>, <span class="at">row.names =</span> T, <span class="at">append =</span> <span class="cn">TRUE</span>) <span class="co"># to add as a new sheet.</span></span>
<span id="cb174-1171"><a href="rna-seq-mkdata.html#cb174-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1172"><a href="rna-seq-mkdata.html#cb174-1172" aria-hidden="true" tabindex="-1"></a><span class="co"># Heat Map of top10 genes.</span></span>
<span id="cb174-1173"><a href="rna-seq-mkdata.html#cb174-1173" aria-hidden="true" tabindex="-1"></a><span class="co"># Cunstruct Matrix.</span></span>
<span id="cb174-1174"><a href="rna-seq-mkdata.html#cb174-1174" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract column names.</span></span>
<span id="cb174-1175"><a href="rna-seq-mkdata.html#cb174-1175" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(topTenMerg)</span>
<span id="cb174-1176"><a href="rna-seq-mkdata.html#cb174-1176" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">shQuote</span>(<span class="fu">colnames</span>(topTenMerg)), <span class="at">collapse=</span><span class="st">&quot;, &quot;</span>) <span class="co"># with quotes.</span></span>
<span id="cb174-1177"><a href="rna-seq-mkdata.html#cb174-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1178"><a href="rna-seq-mkdata.html#cb174-1178" aria-hidden="true" tabindex="-1"></a>include_var <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Row.names&#39;</span>, <span class="st">&#39;mPDL_RNA14D_Ko1&#39;</span>, <span class="st">&#39;mPDL_RNA14D_Ko2&#39;</span>, <span class="st">&#39;mPDL_RNA14D_Ko3&#39;</span>, <span class="st">&#39;mPDL_RNA14D_Ko4&#39;</span>, <span class="st">&#39;mPDL_RNA14D_WT1&#39;</span>, <span class="st">&#39;mPDL_RNA14D_WT2&#39;</span>, <span class="st">&#39;mPDL_RNA14D_WT3&#39;</span>, <span class="st">&#39;mPDL_RNA14D_WT4&#39;</span>, <span class="st">&#39;mPDL_RNA7D_Ko1&#39;</span>, <span class="st">&#39;mPDL_RNA7D_Ko2&#39;</span>, <span class="st">&#39;mPDL_RNA7D_Ko3&#39;</span>, <span class="st">&#39;mPDL_RNA7D_Ko4&#39;</span>, <span class="st">&#39;mPDL_RNA7D_WT1&#39;</span>, <span class="st">&#39;mPDL_RNA7D_WT2&#39;</span>, <span class="st">&#39;mPDL_RNA7D_WT3&#39;</span>, <span class="st">&#39;mPDL_RNA7D_WT4&#39;</span> )</span>
<span id="cb174-1179"><a href="rna-seq-mkdata.html#cb174-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1180"><a href="rna-seq-mkdata.html#cb174-1180" aria-hidden="true" tabindex="-1"></a><span class="co"># Top10heat &lt;- topTenMerg[,names(topTenMerg)] %in% include_var #Not working, gives T/F vector instead of matrix.</span></span>
<span id="cb174-1181"><a href="rna-seq-mkdata.html#cb174-1181" aria-hidden="true" tabindex="-1"></a><span class="co"># Top10heat</span></span>
<span id="cb174-1182"><a href="rna-seq-mkdata.html#cb174-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1183"><a href="rna-seq-mkdata.html#cb174-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1184"><a href="rna-seq-mkdata.html#cb174-1184" aria-hidden="true" tabindex="-1"></a>Top10heat <span class="ot">&lt;-</span> <span class="fu">select</span>(topTenMerg, <span class="fu">all_of</span>(include_var)) <span class="co">#exclude all variables in excluded_vars</span></span>
<span id="cb174-1185"><a href="rna-seq-mkdata.html#cb174-1185" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Top10heat)</span>
<span id="cb174-1186"><a href="rna-seq-mkdata.html#cb174-1186" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(Top10heat)</span>
<span id="cb174-1187"><a href="rna-seq-mkdata.html#cb174-1187" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(Top10heat)</span>
<span id="cb174-1188"><a href="rna-seq-mkdata.html#cb174-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1189"><a href="rna-seq-mkdata.html#cb174-1189" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb174-1190"><a href="rna-seq-mkdata.html#cb174-1190" aria-hidden="true" tabindex="-1"></a><span class="co"># col1 to rownames</span></span>
<span id="cb174-1191"><a href="rna-seq-mkdata.html#cb174-1191" aria-hidden="true" tabindex="-1"></a>Top10heat <span class="ot">&lt;-</span> Top10heat <span class="sc">%&gt;%</span> <span class="fu">column_to_rownames</span>(<span class="at">var=</span><span class="st">&quot;Row.names&quot;</span>) </span>
<span id="cb174-1192"><a href="rna-seq-mkdata.html#cb174-1192" aria-hidden="true" tabindex="-1"></a><span class="co"># Source: https://www.geeksforgeeks.org/convert-values-in-column-into-row-names-of-dataframe-in-r/</span></span>
<span id="cb174-1193"><a href="rna-seq-mkdata.html#cb174-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1194"><a href="rna-seq-mkdata.html#cb174-1194" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Top10heat)</span>
<span id="cb174-1195"><a href="rna-seq-mkdata.html#cb174-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1196"><a href="rna-seq-mkdata.html#cb174-1196" aria-hidden="true" tabindex="-1"></a><span class="co"># reorder  columns according to the experimental design file</span></span>
<span id="cb174-1197"><a href="rna-seq-mkdata.html#cb174-1197" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Metadata2)</span>
<span id="cb174-1198"><a href="rna-seq-mkdata.html#cb174-1198" aria-hidden="true" tabindex="-1"></a>Top10heatord <span class="ot">&lt;-</span> Top10heat[,Metadata2<span class="sc">$</span>SampleName]</span>
<span id="cb174-1199"><a href="rna-seq-mkdata.html#cb174-1199" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Top10heatord [<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]) </span>
<span id="cb174-1200"><a href="rna-seq-mkdata.html#cb174-1200" aria-hidden="true" tabindex="-1"></a>Top10heatord</span>
<span id="cb174-1201"><a href="rna-seq-mkdata.html#cb174-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1202"><a href="rna-seq-mkdata.html#cb174-1202" aria-hidden="true" tabindex="-1"></a><span class="co"># Heat plot</span></span>
<span id="cb174-1203"><a href="rna-seq-mkdata.html#cb174-1203" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(Top10heatord, <span class="at">main =</span> <span class="st">&quot;heatmap top 10 genes try1&quot;</span>)</span>
<span id="cb174-1204"><a href="rna-seq-mkdata.html#cb174-1204" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(<span class="fu">log2</span>(Top10heatord<span class="sc">+</span><span class="dv">1</span>), <span class="at">main =</span> <span class="st">&quot;heatmap top 100 genes try2&quot;</span>)</span>
<span id="cb174-1205"><a href="rna-seq-mkdata.html#cb174-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1206"><a href="rna-seq-mkdata.html#cb174-1206" aria-hidden="true" tabindex="-1"></a><span class="co"># Individual expression values of the DE genes</span></span>
<span id="cb174-1207"><a href="rna-seq-mkdata.html#cb174-1207" aria-hidden="true" tabindex="-1"></a><span class="co"># Only for the top 10 genes. </span></span>
<span id="cb174-1208"><a href="rna-seq-mkdata.html#cb174-1208" aria-hidden="true" tabindex="-1"></a>newtop10 <span class="ot">&lt;-</span> Top10heatord[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb174-1209"><a href="rna-seq-mkdata.html#cb174-1209" aria-hidden="true" tabindex="-1"></a>newtop10</span>
<span id="cb174-1210"><a href="rna-seq-mkdata.html#cb174-1210" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(newtop10)</span>
<span id="cb174-1211"><a href="rna-seq-mkdata.html#cb174-1211" aria-hidden="true" tabindex="-1"></a><span class="co"># construct  appropiate df</span></span>
<span id="cb174-1212"><a href="rna-seq-mkdata.html#cb174-1212" aria-hidden="true" tabindex="-1"></a>newtop10 <span class="ot">&lt;-</span> <span class="fu">melt</span>(<span class="fu">as.matrix</span>(newtop10))</span>
<span id="cb174-1213"><a href="rna-seq-mkdata.html#cb174-1213" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb174-1214"><a href="rna-seq-mkdata.html#cb174-1214" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(newtop10) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GeneID&quot;</span>, <span class="st">&quot;Sample&quot;</span>, <span class="st">&quot;count&quot;</span>) <span class="co"># maybe better use exp (expression) instead of count. </span></span>
<span id="cb174-1215"><a href="rna-seq-mkdata.html#cb174-1215" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(newtop10)</span>
<span id="cb174-1216"><a href="rna-seq-mkdata.html#cb174-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1217"><a href="rna-seq-mkdata.html#cb174-1217" aria-hidden="true" tabindex="-1"></a><span class="co"># Add new columns Genetype and Time</span></span>
<span id="cb174-1218"><a href="rna-seq-mkdata.html#cb174-1218" aria-hidden="true" tabindex="-1"></a>newtop10<span class="sc">$</span>Genetype <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;WT&quot;</span>, newtop10<span class="sc">$</span>Sample), <span class="st">&quot;WT&quot;</span>, <span class="st">&quot;Ko&quot;</span>)</span>
<span id="cb174-1219"><a href="rna-seq-mkdata.html#cb174-1219" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(newtop10)</span>
<span id="cb174-1220"><a href="rna-seq-mkdata.html#cb174-1220" aria-hidden="true" tabindex="-1"></a>newtop10<span class="sc">$</span>Time <span class="ot">&lt;-</span> <span class="fu">as.factor</span>( <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;7&quot;</span>, newtop10<span class="sc">$</span>Sample), <span class="st">&quot;7&quot;</span>, <span class="st">&quot;14&quot;</span>))</span>
<span id="cb174-1221"><a href="rna-seq-mkdata.html#cb174-1221" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(newtop10)</span>
<span id="cb174-1222"><a href="rna-seq-mkdata.html#cb174-1222" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(newtop10)</span>
<span id="cb174-1223"><a href="rna-seq-mkdata.html#cb174-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1224"><a href="rna-seq-mkdata.html#cb174-1224" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(newtop10, <span class="fu">aes</span>(<span class="at">x=</span> Genetype, <span class="at">y=</span> <span class="fu">log2</span>(count<span class="sc">+</span><span class="dv">1</span>), <span class="at">color=</span> Genetype)) <span class="sc">+</span></span>
<span id="cb174-1225"><a href="rna-seq-mkdata.html#cb174-1225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb174-1226"><a href="rna-seq-mkdata.html#cb174-1226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Time<span class="sc">~</span>GeneID) <span class="sc">+</span></span>
<span id="cb174-1227"><a href="rna-seq-mkdata.html#cb174-1227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()</span>
<span id="cb174-1228"><a href="rna-seq-mkdata.html#cb174-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1229"><a href="rna-seq-mkdata.html#cb174-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1230"><a href="rna-seq-mkdata.html#cb174-1230" aria-hidden="true" tabindex="-1"></a><span class="co"># Extremely quick tutorial on DESequ analysis  ***** -----------------------------</span></span>
<span id="cb174-1231"><a href="rna-seq-mkdata.html#cb174-1231" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb174-1232"><a href="rna-seq-mkdata.html#cb174-1232" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DESeq2)</span>
<span id="cb174-1233"><a href="rna-seq-mkdata.html#cb174-1233" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb174-1234"><a href="rna-seq-mkdata.html#cb174-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1235"><a href="rna-seq-mkdata.html#cb174-1235" aria-hidden="true" tabindex="-1"></a><span class="co">#setwd()</span></span>
<span id="cb174-1236"><a href="rna-seq-mkdata.html#cb174-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1237"><a href="rna-seq-mkdata.html#cb174-1237" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Data -&gt; construct appropiate df.</span></span>
<span id="cb174-1238"><a href="rna-seq-mkdata.html#cb174-1238" aria-hidden="true" tabindex="-1"></a>all_raw_count02</span>
<span id="cb174-1239"><a href="rna-seq-mkdata.html#cb174-1239" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_raw_count02)</span>
<span id="cb174-1240"><a href="rna-seq-mkdata.html#cb174-1240" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Metadata -&gt; construct appropiate df. </span></span>
<span id="cb174-1241"><a href="rna-seq-mkdata.html#cb174-1241" aria-hidden="true" tabindex="-1"></a>Metadata2</span>
<span id="cb174-1242"><a href="rna-seq-mkdata.html#cb174-1242" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Metadata2)</span>
<span id="cb174-1243"><a href="rna-seq-mkdata.html#cb174-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1244"><a href="rna-seq-mkdata.html#cb174-1244" aria-hidden="true" tabindex="-1"></a><span class="co"># Contruct DESeqDataSet object</span></span>
<span id="cb174-1245"><a href="rna-seq-mkdata.html#cb174-1245" aria-hidden="true" tabindex="-1"></a>dds210721 <span class="ot">&lt;-</span> <span class="fu">DESeqDataSetFromMatrix</span>(<span class="at">countData =</span> all_raw_count02,</span>
<span id="cb174-1246"><a href="rna-seq-mkdata.html#cb174-1246" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">colData =</span> Metadata2,</span>
<span id="cb174-1247"><a href="rna-seq-mkdata.html#cb174-1247" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">design =</span> <span class="sc">~</span> Genotype <span class="sc">+</span>Time, </span>
<span id="cb174-1248"><a href="rna-seq-mkdata.html#cb174-1248" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">tidy =</span> F) <span class="co">#If the 1st column of countData is the rownames for the count matrix then TRUE</span></span>
<span id="cb174-1249"><a href="rna-seq-mkdata.html#cb174-1249" aria-hidden="true" tabindex="-1"></a>dds210721</span>
<span id="cb174-1250"><a href="rna-seq-mkdata.html#cb174-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1251"><a href="rna-seq-mkdata.html#cb174-1251" aria-hidden="true" tabindex="-1"></a><span class="co">#Run DESeq function for the differentiation Expression Table</span></span>
<span id="cb174-1252"><a href="rna-seq-mkdata.html#cb174-1252" aria-hidden="true" tabindex="-1"></a>dds210721 <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds210721)</span>
<span id="cb174-1253"><a href="rna-seq-mkdata.html#cb174-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1254"><a href="rna-seq-mkdata.html#cb174-1254" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the results of the differentiation expression analysis and define alpha.</span></span>
<span id="cb174-1255"><a href="rna-seq-mkdata.html#cb174-1255" aria-hidden="true" tabindex="-1"></a>res210721 <span class="ot">&lt;-</span> <span class="fu">results</span>(dds210721, <span class="at">alpha =</span> <span class="fl">0.001</span>)</span>
<span id="cb174-1256"><a href="rna-seq-mkdata.html#cb174-1256" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res210721, <span class="at">tidy=</span>F)</span>
<span id="cb174-1257"><a href="rna-seq-mkdata.html#cb174-1257" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(res210721)</span>
<span id="cb174-1258"><a href="rna-seq-mkdata.html#cb174-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1259"><a href="rna-seq-mkdata.html#cb174-1259" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res210721)</span>
<span id="cb174-1260"><a href="rna-seq-mkdata.html#cb174-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1261"><a href="rna-seq-mkdata.html#cb174-1261" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort/order summary list with  padj values from smallest to largest</span></span>
<span id="cb174-1262"><a href="rna-seq-mkdata.html#cb174-1262" aria-hidden="true" tabindex="-1"></a>res210721Rank <span class="ot">&lt;-</span> res210721[<span class="fu">order</span>(res210721<span class="sc">$</span>padj),]</span>
<span id="cb174-1263"><a href="rna-seq-mkdata.html#cb174-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1264"><a href="rna-seq-mkdata.html#cb174-1264" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res210721Rank)</span>
<span id="cb174-1265"><a href="rna-seq-mkdata.html#cb174-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1266"><a href="rna-seq-mkdata.html#cb174-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-1267"><a href="rna-seq-mkdata.html#cb174-1267" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PCA</span></span>
<span id="cb174-1268"><a href="rna-seq-mkdata.html#cb174-1268" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply a variance stabilizing transformation (VST) to the count data</span></span>
<span id="cb174-1269"><a href="rna-seq-mkdata.html#cb174-1269" aria-hidden="true" tabindex="-1"></a>vsd210721 <span class="ot">&lt;-</span> <span class="fu">vst</span>(dds210721, <span class="at">blind =</span> F)</span>
<span id="cb174-1270"><a href="rna-seq-mkdata.html#cb174-1270" aria-hidden="true" tabindex="-1"></a>vsd210721</span>
<span id="cb174-1271"><a href="rna-seq-mkdata.html#cb174-1271" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(vsd210721)</span>
<span id="cb174-1272"><a href="rna-seq-mkdata.html#cb174-1272" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPCA</span>(vsd210721, <span class="at">intgroup =</span> <span class="fu">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Genotype&quot;</span>))</span></code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="rna-seq-differentially-expressed-go-enrichment-and-pathway-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wgcna-rna-seq-blog.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Bioinformatics_RNA-seq.pdf", "Bioinformatics_RNA-seq.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
