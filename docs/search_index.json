[["index.html", "Bioinformatics_RNA-seq Chapter 1 Downloading and setting up conda environments. 1.1 Install Miniconda, or Anaconda. 1.2 Introduction to RNA sequencing (RNA_seq) 1.3 Alignment", " Bioinformatics_RNA-seq J. Marcelo Rosales R. Created: 2021-08-10; Update: 2021-08-20; Date: 2021-08-22 Chapter 1 Downloading and setting up conda environments. Benefit: You can install all your tools in “Conda” and export as yml and you can share that environment or create a new one base on it, and by doing so, you can have all those tools automatically installed. 1.1 Install Miniconda, or Anaconda. Choose Anaconda if you: - Are new to conda or Python - Like the convenience of having Python and over 1500 scientific packages automatically installed at once - Have the time and disk space (a few minutes and 3 GB), and/or - Don’t want to install each of the packages you want to use individually. Choose Miniconda if you: - Do not mind installing each of the packages you want to use individually. - Do not have time or disk space to install over 1500 packages at once, and/or - Just want fast access to Python and the conda commands, and wish to sort out the other programs later. Mind that Windows and Mac installation and procedures are different. Does Windows need Linux to be intalled? Yes, a version of Linux kernell for window is available for download. Install Anaconda or Miniconda. brew install --cask anaconda brew install --cask miniconda # To check the version of conda installed. conda --version Quick video tutorial on how to use conda. * (Master) Conda environment. * Set up a data Science environment with Conda-Forge. To create an environment. The easy way: Open the anaconda app &gt; Environment &gt; New &gt; Name… Ok To access environment and open in terminal: anaconda app &gt; Environment &gt; Select environment &gt; rna-seq_test ^ &gt; »Open in Terminal. In Terminal # To see all the environment created. conda env list # To create a new environment in conda in terminal: conda create --name rna-seq_test # To activate environment. conda activate rna-seq_test # To see if we activated the environment and where (path) we are. echo $path # To exit the environment and return to base/root. Check with echo $path. conda deactivate # To see packages installed in env.: conda config --show channels # To see the url location of packages (repository): conda info # To add packages to the environment. (only to this environment: --env). conda config --env --add channels conda-forge conda config --env --add channels bioconda # If a package is repeated in the environment, Conda will always install the package of higher version. If you dont want that, and specifically need a version originally configured at creation of the environment.. type: conda config --env --set channel_priority strict. # To install fastqc conda install fastqc #To make and export a list of the required environment/ conda list --export &gt; requirements.txt #To make and export an yml file to share with others. conda env export &gt; rna-seq_test.yml conda env export --file rna-seq_test.yml # To quickly check the yml file. less rna-seq_test.yml #To see the content of a .yml file. head rna-seq_test.yml #To clear the terminal screen. clear # To run a Jupyter Notebook. jupyter notebook # To Keep Anaconda updated. conda update conda # To Uninstall Anaconda. [Uninstall page]() 1.1.1 Summary of Steps. Install anaconda/miniconda for your OS from the website. Prevent the base environment from automatically activating. conda config --set auto_activate_base false Create an empty environment. conda create -n rna-seq_test. Activate the environment conda activate rna-seq_test. Add conda-forge as first channel conda config --env --add channels conda-forge. Ensure that conda-forge is used if the package is available. conda config --env --set channel_priority strict Install packages conda install .... Install packages not in conda-forge. Search in conda webpage search. conda install -c .... Verify Jupyter Notebooks in correct environment …!?… In jupyter: sys.executable Video reference: ![](https://youtu.be/ePS6lII4SEg){width=\"500\" height=\"300\"} does not really work. Bioinformatics - Downloading and Setting Up Conda Environments. ![](https://youtu.be/ef_-BtMtDG0?list=PL-0fKymgD8L8qW7SQDaEf3lrSyUkEkR1k){width=\"40%\"} neither. 1.2 Introduction to RNA sequencing (RNA_seq) An over simplification of the Process. Holds 4 main sections. Sample and sample analysis. Samples are taken, prepared and send to a company for analysis. (Illumina !?). Raw data (FASTQ) - Expression quantification. Differential expression analysis. Pathway and Enrichment analysis. Each of this section are subdivided in other steps, that. Download or acquire the files 2021/07/02 Copy Trial data from MK/土橋 to folder HD-PCFSU3-A/Experiments Data/Genewiz : The Report file is here. The Summary file is here. 1.3 Alignment We need something to map our reads against once we get to the results. Files for mouse (Mus musculus) are available for download at Johns Hopkins University Center for Computational Biology (CCB) at TopHat. A spliced read mapper for RNA-Seq. To download: 1. Look for the Mus musculus Build37.2 from the NCBI. 1. Right click the link and copy the link address. 1. go back to the conda environment and type wget and the paste the link. wget ftp://igenome:G3nom3s4u@ussd-ftp.illumina.com/Mus_musculus/NCBI/build37.2/Mus_musculus_NCBI_build37.2.tar.gz 1.3.1 Using Tophat Not Working!!! Tophat can be installed using the same conda install conda install \\-c bioconda tophat When this is finished installing, then we will need to get the mouse genome from the Johns Hopkins Univeristy Center for computational BIology. The version of the mouse genome that I am using here is the NCBI build37.2. Instead of downloading this from the website and having to move it to the cluser, I will just download it using wget into the folder that has the raw reads, trimmed reads, and the FastQC files. wget ftp://igenome:G3nom3s4u@ussd-ftp.illumina.com/Mus_musculus/NCBI/build37.2/Mus_musculus_NCBI_build37.2.tar.gz This will take a long time to download because the file is a little less than 16GB zipped. Installation of TopHat failed.!!!!!!!!!!!!!!!!!!!!!!! Try STAR 1.3.2 Using STAR Complicated!!! STAR can be installed the same way as the previous programs with conda install (conda install -c bioconda star). In order to run STAR, we need to creaate indices just like with tophat, but STAR has this built in. I’m going to be using the same genome and GTF file as previously downloaded, but Dr. Ge uses a different zipped genome from the gencode database. ~/miniconda2/bin/STAR \\ --runThreadN 80 \\ --runMode genomeGenerate \\ --genomeDir starIndex \\ --genomeFastaFiles Index/genome.fa \\ #same when we made the bowtie indices --sjdbGTFfile Mus_musculus/NCBI/build37.2/Annotation/Archives/archive-2015-07-17-14-32-40/Genes/genes.gtf With the index files made, we can start aligning with STAR. It’s important here than we only pick the paired end reads and not use all of the reads. Tophat is able to use all 4 reads but STAR doesn’t allow that, so we need to make sure that we feed in the large files from trimming. ~/miniconda2/bin/STAR --runThreadN 80 --genomeDir starIndex --readFilesIn 770_fp.fq 770_rp.fq --outFilterIntronMotifs RemoveNoncanonical --outFileNamePrefix 2121770 --outSAMtype BAM SortedByCoordinate [here]() Complicated.!!!!!!!!!!!!!!!!!!!!!!! 1.3.3 Downloading the Mus_musculus_NCBI_build37.2.tar.gz file my way. Esaest so far. Go to the iGenomes Ready-To-Use Reference Sequences and Annotations from illumina.. Copy the Mus musculus (Mouse) NCBI build37.2 link. Paste the link in a new tab/window on a web browser (chrome) and click enter. Popup window will ask where to save the file, choose folder and save. File is 23Gb so it will take about 3 to 4 hrs to download. 1.3.4 Get the Sample files. Samples files come as “x_1.fastq.gz” or “x_2.fastq.gz,” where x is the name of the file, 1 is for forward and 2 for reverse pair reads. example: we will place them in a folder (00_Rawdata) mPDL_RNA7D_Ko1_S1_L001_R1_001.fastq.gz mPDL_RNA7D_Ko1_S1_L001_R2_001.fastq.gz mPDL_RNA7D_Ko2_S1_L001_R1_001.fastq.gz mPDL_RNA7D_Ko2_S1_L001_R2_001.fastq.gz mPDL_RNA7D_Ko3_S1_L001_R1_001.fastq.gz mPDL_RNA7D_Ko3_S1_L001_R2_001.fastq.gz… etc…. Download multiqc conda install multiqc 1.3.5 Starting to analize fastq.gz files Initialize fastqc fastqc Make an output directory named rawFastQC mkdir rawFastQC Now we have to process all fastq files contained in the folder (00_Rawdata) and place the results in the directory we just made “rawFastQC.” fastqc rawFastQC/*.fastq.gz -o rawFastQC/ Once analysis is finished. Go to the results folder (rawFastQC) cd rawFastQC Create a report by read all the files contained in the results folder (rawFastQC) and combine them in one multiqc_report.html file. rawFastQC multiqc # check if file was created. ls 1.3.6 Trimming with Trimmomatic conda install trimmomatic # parallel my also be required for task piping. conda install parallel 24:40 Conda was used again to run Trimmomatic. This isn’t as easy as using the wildcard like with FastQC because each output has to be personalized for the read files that are input into Trimmomatic. Also, we have to make sure that the adapter sequences are in the same folder that we are running so we can refer to them easily when calling the Trimmomatic program. In this case, we are using the TruSeq3-PE-2.fa adapter sequences For example: ~/miniconda2/bin/trimmomatic PE SRR2121770_1.fastq.gz SRR2121770_2.fastq.gz 770_fp.fq.gz 770_fu.fq.gz 770_rp.fq.gz 770_ru.fq.gz ILLUMINACLIP:TruSeq3-PE-2.fa:2:30:10:2keepBothReads LEADING:3 TRALING:3 MINLEN:36 &amp; This would be repeated for each of the pairs (12 in total). We are trimming paired-end reads with the TruSeq3-PE-2 adapters. We are chopping off the first and last 3 bases and if we end up with a sequence less than 36 bases, we get rid of it. We want to make sure that there are enough bases in a read to work with. These parameters can be tweaked for possibly better end results with less being discarded. When Trimmomatic is finished running, it will out put the total number of reads, the total number from both the forward and reverse reads that are kept, the number of only forward reads kept, the number of only reverse reads kept, and the number of discarded reads. The trimmed reads can be analyzed again with FastQC to see how well the trimming worked to make the file better quality. After running FastQC on the trimmed files we see that the quality of those that were really bad quality were improved. There were a few different metrics throughout all of the files that bounced from a warning before the failing, or from passing before to a warning, and so forth, overall creating better quality read files. Read Check Undrstantig Trimmomatic tutorial for this section !!!!!! after trimmomatic, files will be created, .gz and .log files. Use multiqc to merge all logs in one report file. Then check the timmomatic survival Reads. If all samples are over 55M (million) reads then samples are valid for further analysis. Check the order again. Trimmomatic &gt; alligment -&gt; w/ TopHap or STAR 1.3.7 Using STAR to map genes Using the Mus_musculus files we will compare our samples and find where in the genome our reads are. &gt; Build Genome Indexing and useful STAR Flags (quick). See also: novocraft aling. *Opens only on safari. Analyzind RNA-Seq data using Python3 Snakemake. File Snake file. Look for more information with rRNA and Microbial Contamination. Bioinformatics - Contamination QC and FeatureCounts Quick Look at Counts and Setting Up R Project "],["WGCNA.html", "Chapter 2 Introduction to the WGCNA Rpackage 2.1 WGCNA Rpackage Installation procedure. 2.2 Final installation workflow: 2.3 WGCNA tutorial.", " Chapter 2 Introduction to the WGCNA Rpackage 2.1 WGCNA Rpackage Installation procedure. Installing and re-installing new versions or R and Studio. In Terminal (or Rstudio &gt; Terminal). brew reinstall --cask r brew reinstall --cask rstudio Installing WGCNA: and R package for weighted correlation network analysis. To install the package, go to Tab: Packages &gt; Install …[]… -Repository: (CRAN); -Packages: WGCNA; *Install. In R code: install.packages(&quot;WGCNA&quot;) Installation (Failed). Unfortunately, it could not install correctly. Error was: install.packages(&quot;WGCNA&quot;) Warning in install.packages : dependencies ‘Biobase’, ‘impute’, ‘preprocessCore’, ‘GO.db’, ‘AnnotationDbi’ are not available Package which is only available in source form, and may need compilation of C/C++/Fortran: ‘WGCNA’ Do you want to attempt to install these from sources? (Yes/no/cancel) y Warning in install.packages : installation of package ‘WGCNA’ had non-zero exit status Dependencies are old and require special installation. From this page, installed several packages. (Failed). install.packages(c(&quot;dynamicTreeCut&quot;, &quot;cluster&quot;, &quot;flashClust&quot;, &quot;Hmisc&quot;, &quot;reshape&quot;, &quot;foreach&quot;, &quot;doParallel&quot;) ) source(&quot;http://bioconductor.org/biocLite.R&quot;) biocLite(&quot;impute&quot;) install.packages(&quot;WGCNA&quot;) Install most of the packages, but not “impute,” result: could not install WGCNA. Tried to install dependencies independently from here: (Failed) You&#39;re using R-3.6.0, but trying to install Bioconductor version 3.8. Try using BiocManager::install(&quot;Biobase&quot;). If that works, then try BiocManager::install(&quot;GO.db&quot;). If you have success, make sure your installation is valid with BiocManager::valid(). BiocManager::install(&quot;Biobase&quot;) BiocManager::install(&quot;GO.db&quot;) BiocManager::valid() No resutl Decided to install the complete “BiocManager” pack. ** BiocManager: (OK); (WGCNA:(Failed)** &gt; install.packages(&quot;BiocManager&quot;) downloaded 315 KB &gt; install.packages(&quot;WGCNA&quot;) Warning in install.packages : dependencies ‘impute’, ‘preprocessCore’ are not available Search ‘preprocessCore,’ in this page. PreprocessCore:(OK); (WGCNA:(Failed) To install this package, start R (version “4.1”) and enter: if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE)) install.packages(&quot;BiocManager&quot;) BiocManager::install(&quot;preprocessCore&quot;) For ‘impute,’ found install in this page. Impute:(OK); WGCNA:( OK) To install this package, start R (version “4.1”) enter: if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE)) install.packages(&quot;BiocManager&quot;) BiocManager::install(&quot;impute&quot;) Then install WGCNA install.packages(&quot;WGCNA&quot;) 2.2 Final installation workflow: # Set working directory getwd() setwd(&quot;/Users/marcelorosales/Box Sync/Documents/R/Rmarkdown&quot;) getwd() # Load list of packages and install. load(&quot;Rpackages&quot;) for (p in setdiff(packages, installed.packages()[,&quot;Package&quot;])) install.packages(p) Check &lt;- installed.packages() BiocManager::install(&quot;Biobase&quot;) BiocManager::install(&quot;GO.db&quot;) BiocManager::valid() &gt; install.packages(&quot;BiocManager&quot;) if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE)) install.packages(&quot;BiocManager&quot;) BiocManager::install(&quot;preprocessCore&quot;) BiocManager::install(&quot;WGCNA&quot;) install.packages(c(&quot;dynamicTreeCut&quot;, &quot;cluster&quot;, &quot;flashClust&quot;, &quot;Hmisc&quot;, &quot;reshape&quot;, &quot;foreach&quot;, &quot;doParallel&quot;) ) source(&quot;http://bioconductor.org/biocLite.R&quot;) biocLite(&quot;impute&quot;) if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE)) install.packages(&quot;BiocManager&quot;) BiocManager::install(&quot;impute&quot;) install.packages(&quot;WGCNA&quot;) Checking the packages for WGCNA installed previously for OS Catalina. Warning in install.packages : package ‘anRichment’ is not available for this version of R A version of this package for your version of R might be available elsewhere, see the ideas at https://cran.r-project.org/doc/manuals/r-patched/R-admin.htmlInstalling-packages Warning in install.packages : package ‘anRichment’ is not available for this version of R package ‘anRichmentMethods’ is not available for this version of R package ‘BiocFileCache’ is not available for this version of R package ‘BiocParallel’ is not available for this version of R package ‘biomaRt’ is not available for this version of R package ‘DelayedArray’ is not available for this version of R package ‘GenomicAlignments’ is not available for this version of R package ‘GenomicFeatures’ is not available for this version of R package ‘GenomicRanges’ is not available for this version of R package ‘inserttable’ is not available for this version of R package ‘lorem’ is not available for this version of R package ‘org.Hs.eg.db’ is not available for this version of R package ‘org.Mm.eg.db’ is not available for this version of R package ‘Rhtslib’ is not available for this version of R package ‘Rsamtools’ is not available for this version of R package ‘rtracklayer’ is not available for this version of R package ‘SummarizedExperiment’ is not available for this version of R package ‘TxDb.Hsapiens.UCSC.hg19.knownGene’ is not available for this version of R package ‘TxDb.Mmusculus.UCSC.mm10.knownGene’ is not available for this version of R A version of this package for your version of R might be available elsewhere, see the ideas at https://cran.r-project.org/doc/manuals/r-patched/R-admin.htmlInstalling-packages 2.3 WGCNA tutorial. This code has been adapted from the tutorials available at WGCNA website (this page does no longer exist). WGCNA: an R package for weighted correlation network analysis site. Tutorials for the WGCNA package. R tutorial Steps Required for this process are: 1. Data input and cleaning: PDF document, R script. 1. Network construction and module detection a. Automatic, one-step network construction and module detection: PDF document, R script b. Step-by-step network construction and module detection: PDF document, R script c. Dealing with large datasets: block-wise network construction and module detection: PDF document, R script 1. Relating modules to external clinical traits and identifying important genes: PDF document, R script 1. Interfacing network analysis with other data such as functional annotation and gene ontology PDF document, R script 1. Network visualization using WGCNA functions: PDF document, R script 1. Export of networks to external software: PDF document, R script 2.3.1 3.4 Gene expression analysis The level of gene expression is measured by read density, the higher the read density, the higher the level of gene expression. Gene expression calculation was performed with the formula below, which calculates FPKM (Fragments per kilo bases per million reads) based on read counts from HT-seq (V 0.6.1) (Mortazavi, 2008). The formula is: Figure 3.4.1 The ratio of (total exon fragments / mapped reads [millions]) is the read count mapped to the gene normalized to total read counts. The value is then normalized to gene length (exon length [KB]), so that the expression of genes with different sequencing depths and length are comparable. The numbers of genes with different expression levels are summarized in Table 3.7.1. In general, FPKM threshold for gene expression is set between 0.1-1, although there is no absolute standard and various thresholds have been used in the literature. "],["literature.html", "Chapter 3 Literature", " Chapter 3 Literature Here is a review of existing methods. "],["methods.html", "Chapter 4 Methods", " Chapter 4 Methods We describe our methods in this chapter. "],["applications.html", "Chapter 5 Applications 5.1 Example one 5.2 Example two", " Chapter 5 Applications Some significant applications are demonstrated in this chapter. 5.1 Example one 5.2 Example two "],["final-words.html", "Chapter 6 Final Words", " Chapter 6 Final Words We have finished a nice book. "],["references.html", "References", " References "]]
